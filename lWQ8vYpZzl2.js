if (self.CavalryLogger) { CavalryLogger.start_js(["6NrJK"]); }

__d("MessengerWebDeltasTypedLoggerBootloader.bs",["Bootload.bs","Bootloader"],(function(a,b,c,d,e,f){"use strict";function a(a){b("Bootloader").loadModules(["MessengerWebDeltasTypedLogger"],a,"MessengerWebDeltasTypedLoggerBootloader.bs");return 0}c={doLoad:a};d=b("Bootload.bs").Create(c);f.BootloadableMessengerWebDeltasTypedLogger=c;f.LoadableMessengerWebDeltasTypedLogger=d}),null);
__d("MessengerDeltaTransformer.bs",["Promise","FBID.bs","bs_block","bs_curry","gkx","bs_js_dict","bs_js_json","bs_caml_obj","FBIDCheck","bs_belt_Array","bs_caml_array","DateConsts","LogHistory","MercuryIDs","bs_belt_Option","bs_caml_option","MessagingTag","MessengerState.bs","MontageActions","bs_js_null_undefined","MercuryActionType","MercuryDispatcher","MSuggestionActions","MercuryThreadIDMap","PageCommItemStatus","MercuryPayloadSource","MercuryProfileRanges","MercuryLogMessageType","MercuryServerRequests","MercurySyncDeltaTypes","MessagingThreadAction","MessageThreadReadState","MessengerThreadFetcher.bs","bs_caml_builtin_exceptions","MercuryGlobalActionType","MessengerWebDeltaEvents","PagesMessagingEventType","MessengerGroupsSyncStatus","MessengerGroupsSyncStatus.bs","MessageUnsendabilityStatus.bs","MessengerApprovalModeTypes","IrisProtocolMessageLifetime","MessengerApprovalQueueTypes","MessengerGroupRequestSource","MercuryMessageCustomizations","MessageThreadReadStateEffect","MessengerParticipantsFetcher.bs","MessengerWebDeltasTypedLogger","ChatReliabilityInstrumentation","RepliedToMessageStatusForGraphQL","ClientSyncProtocol_GroupsSyncAction","MessengerRealtimeAttachmentTransformer.bs","MessengerWebDeltasTypedLoggerBootloader.bs","MessageLiveLocationClientSyncProtocolStopReason"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function g(a){try{return JSON.parse(a)}catch(a){return{}}}c=b("gkx")("780647");var h=c?0:1;function i(a,c){__p&&__p();var d=b("bs_belt_Option").map(b("bs_caml_option").nullable_to_opt(c.otherUserFbId),function(a){return a.toString()});c=b("bs_belt_Option").map(b("bs_caml_option").nullable_to_opt(c.threadFbId),function(a){return a.toString()});a=b("MercuryThreadIDMap").getForFBID(a);if(d!==void 0){d=d;d=[b("bs_caml_option").some(b("MercuryIDs").getThreadIDFromUserID(b("FBID.bs").ofStringExn(d))),d]}else if(c!==void 0){c=c;d=[b("bs_caml_option").some(b("MercuryIDs").getThreadIDFromThreadFBID(b("FBID.bs").ofStringExn(c))),c]}else d=[void 0,void 0];c=d[1];d=d[0];if(c!==void 0&&d!==void 0){c=c;var e=a.hasClientIDForServerID(c);if(e)return b("bs_caml_option").nullable_to_opt(a.getClientIDFromServerIDNow(c));else return b("bs_caml_option").valFromOption(d)}}function j(a,c){__p&&__p();var d=parseInt(c.messageMetadata.timestamp,10),e=b("MessageThreadReadStateEffect").extractThreadStateEffectFromDelta(a,c),f=c.messageMetadata.actorFbId.toString(),h=b("bs_caml_obj").caml_equal(e,b("MessageThreadReadState").MARK_UNREAD)&&a!==f,j=!b("FBIDCheck").isUser_deprecated(a),k=c.attachments;k=k==null?[]:b("bs_belt_Array").keepMapU(k,function(e){__p&&__p();var c=e.mercury;if(c==null){e=e.mercuryJSON;e=e==null?null:g(e)}else e=c;if(e==null)return;else{c=e.extensible_attachment;var d=e.blob_attachment;e=e.sticker_attachment;e=c==null?d==null?e==null?[]:b("MessengerRealtimeAttachmentTransformer.bs").transform(a,{extensible_attachment:null,blob_attachments:null,sticker:e},j):b("MessengerRealtimeAttachmentTransformer.bs").transform(a,{extensible_attachment:null,blob_attachments:[d],sticker:null},j):b("MessengerRealtimeAttachmentTransformer.bs").transform(a,{extensible_attachment:b("bs_js_null_undefined").fromOption(c==null?void 0:b("bs_caml_option").some(c)),blob_attachments:null,sticker:null},j);return b("bs_belt_Array").get(e,0)}});var l=c.messageMetadata.tags;l=l==null?void 0:b("bs_js_null_undefined").fromOption(b("bs_belt_Array").get(l,0));var m=c.data,n;if(m==null)n=null;else{var o=b("bs_js_dict").get(m,"adminSignatureCreatorID");n=o!==void 0?{creatorID:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(m,"adminSignatureCreatorID")),creatorName:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(m,"adminSignatureCreatorName")),creatorType:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(m,"adminSignatureCreatorType")),labelType:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(m,"adminSignatureLabelType")),pageID:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(m,"adminSignaturePageID")),profileURI:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(m,"adminSignatureProfileURI"))}:null}o=i(a,c.messageMetadata.threadKey);if(o!==void 0){m=c.ttl;var p=c.messageMetadata.threadKey.threadFbId,q=c.messageMetadata.threadKey.otherUserFbId,r=c.body,s=c.data;if(s==null){var t=c.untypedData;t=t==null?!1:b("bs_belt_Option").getWithDefault(b("bs_js_dict").get(t,"is_sponsored"),"false")==="true"}else t=b("bs_belt_Option").getWithDefault(b("bs_js_dict").get(s,"is_sponsored"),"false")==="true";s=c.data;var u=c.data,v;if(u==null)v=null;else{u=b("bs_js_dict").get(u,"customization");v=u!==void 0?b("MercuryMessageCustomizations").parseCustomizations(u):null}u=c.data;var w=c.data,x=c.data,y;if(x==null)y=null;else{x=b("bs_js_dict").get(x,"mib_direct_message_data");y=x!==void 0?g(x):null}x=c.data;var z;if(x==null)z=null;else{x=b("bs_js_dict").get(x,"message_source_data");if(x!==void 0){x=g(x);x=b("bs_js_json").classify(x);if(typeof x==="number"||x.tag!==2)z=null;else{x=b("bs_js_dict").get(x[0],"message_source");z=x!==void 0?b("bs_js_null_undefined").fromOption(x):null}}else z=null}x=c.messageMetadata.skipBumpThread;var A=c.data,B;if(A==null)B=null;else{A=b("bs_js_dict").get(A,"montage_reply_data");B=A!==void 0?g(A):null}A=c.data;var C;if(A==null)C=null;else{A=b("bs_js_dict").get(A,"meta_ranges");C=A!==void 0?g(A):null}return{message_id:c.messageMetadata.messageId,threading_id:null,offline_threading_id:c.messageMetadata.offlineThreadingId,author:b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(f)),author_email:f+"@facebook.com",ephemeral_ttl_mode:m==null?0:b("bs_belt_Option").getWithDefault(b("bs_js_dict").get(b("IrisProtocolMessageLifetime"),m),0),timestamp:d,is_unread:h,is_filtered_content:!1,is_filtered_content_bh:!1,is_filtered_content_account:!1,is_filtered_content_quasar:!1,is_filtered_content_invalid_app:!1,is_one_way_sent:b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(c.messageMetadata.tags),[]).some(function(a){return a===b("MessagingTag").ONE_WAY_MESSAGE}),is_forwarded:b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(c.messageMetadata.tags),[]).some(function(a){if(a===b("MessagingTag").ACTION_COPIED_MESSAGE||a===b("MessagingTag").ACTION_COPIED_SELF_MESSAGE||a===b("MessagingTag").ACTION_COPIED_ATTACHMENT)return!0;else return a===b("MessagingTag").ACTION_COPIED_SELF_ATTACHMENT}),source:l,tags:c.messageMetadata.tags,is_spoof_warning:!1,folder:null,thread_fbid:p==null?null:p.toString(),other_user_fbid:q==null?null:q.toString(),body:r==null?"":r,html_body:null,subject:null,has_attachment:k.length!==0,attachments:k,ranges:void 0,thread_id:o,action_type:b("MercuryActionType").USER_GENERATED_MESSAGE,is_from_iris:!0,is_sponsored:t,commerce_message_type:s==null?null:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(s,"commerce_message_type")),customizations:v,platform_xmd:u==null?null:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(u,"platform_xmd")),profile_ranges:b("MercuryProfileRanges").extractFromDelta(c),verse_group_role_xmd:w==null?null:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(w,"verse_group_role_id")),mib_direct_message_data:y,message_source:z,skip_bump_thread:x==null?!1:x,thread_read_state_effect:e,montage_reply_data:B,meta_ranges:C,creator_info:n,message_unsendability_status:b("MessageUnsendabilityStatus.bs").fromNullableString(c.messageMetadata.unsendType),comm_status:j?b("PageCommItemStatus").TODO:null}}else throw[b("bs_caml_builtin_exceptions").invalid_argument,"invalid thread id"]}function k(a,c){b("LogHistory").getInstance("MessengerDeltaTransformer").debug(a,c);return 0}function l(a,c,d,e){return b("bs_curry")._1(b("MessengerWebDeltasTypedLoggerBootloader.bs").LoadableMessengerWebDeltasTypedLogger.load,function(f){f=new(b("MessengerWebDeltasTypedLogger"))();f=f.setDeltaEvent(a).setDeltaType(c).setIgnoreReason(d).setSyncSeqID(e);f.log();return 0})}function m(a){return l(b("MessengerWebDeltaEvents").DELTA_RECEIVED,a,null,null)}function n(a,c){l(b("MessengerWebDeltaEvents").DELTA_IGNORED,a,c,null);return k("DeltaIgnored",a)}function o(a,c,d,e,f){return b("MessengerThreadFetcher.bs").$$fetch(a,c,d,function(c){if(c){b("MercuryDispatcher").getForFBID(a).handleUpdate({actions:[e],pinned_thread_ids:[],newlyAddedClientIDs:{},preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});return m(f)}else return n(f,"thread fetch failed")})}function p(a,c,d,e){__p&&__p();var f=c.other_user_fbid;if(f==null){var g=c.thread_fbid;if(g==null)throw[b("bs_caml_builtin_exceptions").invalid_argument,"invalid thread id"];else g=[g,!1]}else g=[f,!0];f=g[1];g=g[0];var h=b("MercuryThreadIDMap").getForFBID(a);h=h.getClientIDFromServerIDNow(g);var i=h==null?null:b("MessengerState.bs").getThreadMetaNow(a,h),j=b("gkx")("1143875");if(h==null)if(e)return o(a,g,f,c,d);else return n(d,"thread not already loaded, not required to be loaded");else if(i==null)if(e){if(j){o(a,g,f,c,d);k("ThreadMetaMissing",g);b("ChatReliabilityInstrumentation").logTHREAD_INFO_MISSING(b("LogHistory").formatEntries(b("LogHistory").getEntries()));return 0}else if(j)return n(d,"thread not already loaded, not required to be loaded")}else if(j)return n(d,"thread not already loaded, not required to be loaded");b("MercuryDispatcher").getForFBID(a).handleUpdate({actions:[c],pinned_thread_ids:[],newlyAddedClientIDs:{},preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});return m(d)}function q(a,c){__p&&__p();var d=c.threadKey.threadFbId,e=d==null?void 0:b("bs_caml_option").some(d);if(d==null){d=c.threadKey.otherUserFbId;var f=d==null?void 0:b("bs_caml_option").some(d);d=d==null?[void 0,void 0]:[f,{otherUserFbId:b("bs_js_null_undefined").fromOption(f),threadFbId:null}]}else d=[e,{otherUserFbId:null,threadFbId:b("bs_js_null_undefined").fromOption(e)}];f=d[1];e=d[0];if(e!==void 0&&f!==void 0){d=i(a,b("bs_caml_option").valFromOption(f));if(d!==void 0)return{thread_id:d,action_type:b("MercuryActionType").REACTION_UPDATE,messageId:c.messageId,offlineThreadingId:c.offlineThreadingId,reaction:c.reaction,senderId:c.senderId.toString(),thread_fbid:e.toString(),other_user_fbid:null,userId:c.userId.toString()};else return}}function r(a){return a/Math.pow(10,8)}function s(a,c){__p&&__p();var d=c.threadKey.threadFbId,e=d==null?void 0:b("bs_caml_option").some(d),f=c.threadKey.otherUserFbId,g=f==null?void 0:b("bs_caml_option").some(f);d=d==null?f==null?[void 0,void 0]:[g,{otherUserFbId:null,threadFbId:b("bs_js_null_undefined").fromOption(g)}]:[e,{otherUserFbId:b("bs_js_null_undefined").fromOption(e),threadFbId:null}];f=d[1];g=d[0];if(g!==void 0&&f!==void 0){e=i(a,b("bs_caml_option").valFromOption(f));if(e!==void 0&&c.messageLiveLocations.length===1){d=b("bs_caml_array").caml_array_get(c.messageLiveLocations,0);a=d.expirationTime;f=d.stopReason;c=f==null?Date.now()/b("DateConsts").MS_PER_SEC>a:!0;f=d.coordinate;f=f==null?null:{latitude:r(f.latitude),longitude:r(f.longitude)};var h=d.destination;h=h==null?null:{latitude:r(h.latitude),longitude:r(h.longitude),label:h.label};var j=d.stopReason;j=j==null?null:j===b("MessageLiveLocationClientSyncProtocolStopReason").EXPIRED||j===b("MessageLiveLocationClientSyncProtocolStopReason").CANCELED?"EXPIRED":j===b("MessageLiveLocationClientSyncProtocolStopReason").ARRIVED?"ARRIVED":null;return{thread_id:e,action_type:b("MercuryActionType").LIVE_LOCATION_UPDATE,thread_fbid:g.toString(),other_user_fbid:null,messageId:d.messageId,liveLocation:{live_location_id:d.id.toString(),is_expired:c,expiration_time:a,sender:{id:d.senderId.toString()},coordinate:f,location_title:d.locationTitle,sender_destination:h,stop_reason:j}}}else return}}function t(a,c){var d=c.threadKey.threadFbId;if(d==null)return;else{a=i(a,{otherUserFbId:null,threadFbId:d});if(a!==void 0)return{action_type:b("MercuryActionType").EVENT_RSVP_CHANGED,actor_fbid:c.actorFbId.toString(),rsvp_status:c.rsvpStatus,thread_fbid:d.toString(),other_user_fbid:null,thread_id:a};else return}}function u(a,c){__p&&__p();var d=c.threadKey.otherUserFbId;if(d==null)return;else{a=i(a,{otherUserFbId:d,threadFbId:null});if(a!==void 0){c=c.isFollowUp;return{action_type:b("MercuryActionType").UPDATE_COMM_STATUS,comm_status:c?b("PageCommItemStatus").FOLLOW_UP:b("PageCommItemStatus").TODO,thread_fbid:d.toString(),other_user_fbid:null,thread_id:a}}else return}}function v(a,c){__p&&__p();var d=[];c.forEach(function(a){a=b("MercuryIDs").getUserIDFromParticipantID(a);if(a==null)return 0;else{d.push(a);return 0}});return b("MessengerParticipantsFetcher.bs").$$fetch({ids:d}).then(function(c){__p&&__p();var d=[],e=[];c.forEach(function(a){var b=a.id;if(a.is_messenger_blocked||a.is_facebook_blocked){d.push(b);return 0}else{e.push(b);return 0}});b("MercuryDispatcher").getForFBID(a).handleUpdate({from_client:!0,message_blocked_ids:d,message_unblocked_ids:e});return b("Promise").resolve(0)})["catch"](function(a){return b("Promise").resolve(0)})}function w(a,c){__p&&__p();var d=c.actorFbid.toString(),e=b("FBID.bs").ofStringExn(d);if(b("bs_caml_obj").caml_notequal(e,a))e=b("bs_caml_option").some(b("MercuryIDs").getParticipantIDFromUserID(a));else{var f=c.threadKey.otherUserFbId;if(f==null)e=void 0;else{f=b("FBID.bs").ofString(f.toString());e=f!==void 0?b("bs_caml_option").some(b("MercuryIDs").getParticipantIDFromUserID(b("bs_caml_option").valFromOption(f))):void 0}}if(e!==void 0){f=b("bs_caml_option").valFromOption(e);e=c.threadKey.otherUserFbId;if(e==null)return;else{v(a,[f]);a=i(a,{otherUserFbId:e,threadFbId:null});if(a!==void 0)return{action_type:b("MercuryActionType").BLOCK_STATUS_CHANGED,actorFbid:d,canViewerReply:c.canViewerReply,reason:c.reason,message_blocked_ids:[f],other_user_fbid:e.toString(),thread_fbid:null,thread_id:a};else return}}}function x(a,c){__p&&__p();var d=c.threadKey.threadFbId;if(d==null){var e=c.threadKey.otherUserFbId;e=e==null?[void 0,void 0]:[e.toString(),{otherUserFbId:e,threadFbId:null}]}else e=[d.toString(),{otherUserFbId:null,threadFbId:d}];d=e[1];e=e[0];if(e!==void 0&&d!==void 0){a=i(a,b("bs_caml_option").valFromOption(d));if(a!==void 0)return{action_type:b("MercuryActionType").MONTAGE_DIRECT_EXPIRE,messageId:c.messageId,timestamp:c.timestamp,thread_fbid:e,other_user_fbid:null,keep_expiry_timestamp:c.keepExpiryTimestamp,thread_id:a};else return}}function y(a,c){__p&&__p();var d=j(a,c.message),e=c.repliedToMessage;if(e==null)return b("bs_caml_option").some(d);else{a=j(a,e);e=c.status;var f;if(e==null)f=void 0;else switch(e){case 0:f=b("bs_caml_option").some(b("RepliedToMessageStatusForGraphQL").VALID);break;case 1:f=b("bs_caml_option").some(b("RepliedToMessageStatusForGraphQL").DELETED);break;case 2:f=b("bs_caml_option").some(b("RepliedToMessageStatusForGraphQL").TEMPORARILY_UNAVAILABLE);break;default:f=void 0}if(f!==void 0)return b("bs_caml_option").some(Object.assign(d,{replied_to_message:{status:b("bs_caml_option").valFromOption(f),message:a}}));else return}}function z(a,c){__p&&__p();var d=c.threadKey.threadFbId,e=d==null?void 0:b("bs_caml_option").some(d);if(d==null){d=c.threadKey.otherUserFbId;var f=d==null?void 0:b("bs_caml_option").some(d);d=d==null?[void 0,void 0]:[f,{otherUserFbId:b("bs_js_null_undefined").fromOption(f),threadFbId:null}]}else d=[e,{otherUserFbId:null,threadFbId:b("bs_js_null_undefined").fromOption(e)}];f=d[1];e=d[0];if(e!==void 0&&f!==void 0){d=i(a,b("bs_caml_option").valFromOption(f));if(d!==void 0)return{action_type:b("MercuryActionType").GROUPS_SYNC_STATUS_CHANGED,thread_fbid:e.toString(),other_user_fbid:null,actor_fbid:c.actorFbid.toString(),groups_sync_status_string:b("MessengerGroupsSyncStatus.bs").fromNullableString(c.groupsSyncStatus),thread_id:d};else return}}function A(a,c){__p&&__p();var d=c.threadKey.threadFbId,e=d==null?void 0:b("bs_caml_option").some(d);if(d==null){d=c.threadKey.otherUserFbId;var f=d==null?void 0:b("bs_caml_option").some(d);d=d==null?[void 0,void 0]:[f,{otherUserFbId:b("bs_js_null_undefined").fromOption(f),threadFbId:null}]}else d=[e,{otherUserFbId:null,threadFbId:b("bs_js_null_undefined").fromOption(e)}];f=d[1];e=d[0];d=c.syncAction===b("ClientSyncProtocol_GroupsSyncAction").OPT_IN?b("bs_caml_option").some(b("MessengerGroupsSyncStatus").OPT_IN):c.syncAction===b("ClientSyncProtocol_GroupsSyncAction").OPT_OUT?b("bs_caml_option").some(b("MessengerGroupsSyncStatus").OPT_OUT):void 0;if(e!==void 0&&d!==void 0&&f!==void 0){a=i(a,b("bs_caml_option").valFromOption(f));if(a!==void 0){f=c.syncedFbGroupId;return{action_type:b("MercuryActionType").GROUPS_SYNC_METADATA_UPDATE,thread_fbid:e.toString(),other_user_fbid:null,actor_fbid:c.actorFbid.toString(),groups_sync_action:b("bs_caml_option").valFromOption(d),source_surface:c.sourceSurface,fb_group_id:f==null?null:f.toString(),thread_id:a}}else return}}function B(a,c){var d=c.threadKey.threadFbId;if(d==null)return;else{a=i(a,{otherUserFbId:null,threadFbId:d});if(a!==void 0)return{action_type:b("MercuryActionType").DESCRIPTION_CHANGED,thread_fbid:d.toString(),other_user_fbid:null,group_thread_description_string:c.threadDescription,thread_id:a};else return}}function C(a){return"#"+a.slice(2)}function D(a,c){__p&&__p();var d=c.threadKey.threadFbId,e=d==null?void 0:b("bs_caml_option").some(d);if(d==null){d=c.threadKey.otherUserFbId;var f=d==null?void 0:b("bs_caml_option").some(d);d=d==null?[void 0,void 0]:[f,{otherUserFbId:b("bs_js_null_undefined").fromOption(f),threadFbId:null}]}else d=[e,{otherUserFbId:null,threadFbId:b("bs_js_null_undefined").fromOption(e)}];f=d[1];e=d[0];if(e!==void 0&&f!==void 0){d=e;e=i(a,b("bs_caml_option").valFromOption(f));if(e!==void 0){a=e;f=c.fallbackColor!==""?C(c.fallbackColor):"";e=c.gradientColors;if(!(e==null)&&e.length!==0){e=b("bs_belt_Array").map(e,C);return{action_type:b("MercuryActionType").UPDATE_THREAD_THEME,thread_fbid:d.toString(),other_user_fbid:null,theme_id:c.themeId,solid_color:f,header_color:b("bs_caml_array").caml_array_get(e,0),footer_color:b("bs_caml_array").caml_array_get(e,e.length-1|0),gradient_colors:e,thread_id:a}}return{action_type:b("MercuryActionType").UPDATE_THREAD_THEME,thread_fbid:d.toString(),other_user_fbid:null,theme_id:c.themeId,solid_color:f,header_color:f,footer_color:f,gradient_colors:[],thread_id:a}}else return}}function E(a,c){__p&&__p();var d=c.threadKey.threadFbId;if(d==null){var e=c.threadKey.otherUserFbId;e=e==null?[void 0,void 0]:[e.toString(),{otherUserFbId:e,threadFbId:null}]}else e=[d.toString(),{otherUserFbId:null,threadFbId:d}];d=e[1];e=e[0];if(e!==void 0&&d!==void 0){a=i(a,b("bs_caml_option").valFromOption(d));if(a!==void 0)return{action_type:b("MercuryActionType").CHANGE_PINNED_STATUS,thread_fbid:e,other_user_fbid:null,is_pinned:c.isPinned,thread_id:a,thread_pin_timestamp:c.timestamp};else return}}function F(a,c){__p&&__p();var d=c.threadKey.threadFbId,e=c.threadKey.otherUserFbId;e=d==null?e==null?[void 0,void 0]:[e.toString(),{otherUserFbId:e,threadFbId:null}]:[d.toString(),{otherUserFbId:null,threadFbId:d}];d=e[1];e=e[0];if(e!==void 0&&d!==void 0){a=i(a,b("bs_caml_option").valFromOption(d));if(a!==void 0){d=c.isSaved;var f=c.isSaved;return{action_type:b("MercuryActionType").MUTATE_TAGS,thread_fbid:e,other_user_fbid:null,thread_id:a,messageId:c.messageId,tags_to_add:d?["message:save"]:[],tags_to_delete:f?[]:["message:save"]}}else return}}function G(a,c){var d=c.threadKey.threadFbId;if(d==null)return;else{a=i(a,{otherUserFbId:null,threadFbId:d});if(a!==void 0)return{action_type:b("MercuryActionType").UPDATE_JOINABLE_LINK,joinable_link:c.privateGroupLink,thread_fbid:d.toString(),other_user_fbid:null,thread_id:a};else return}}function H(a){__p&&__p();a=a.directives;if(a==null)return;else{a=b("bs_belt_Array").get(a,0);if(a!==void 0){a=b("bs_caml_option").valFromOption(a).data;if(a==null)return;else{a=a.add_actions;if(a==null)return;else{var c=a.actions;if(c==null)return;else{c=b("bs_belt_Array").get(c,0);if(c!==void 0){c=b("bs_caml_option").valFromOption(c).thread_key;if(c==null)return;else{var d=c.thread_fbid;c=c.other_user_fbid;if(d==null)if(c==null)return;else c=c;else c=d;return{action_type:b("MercuryActionType").CREATE_OMNI_M_SUGGESTIONS,thread_fbid:b("MercuryIDs").getThreadIDFromThreadFBID(b("FBID.bs").ofStringExn(c)),other_user_fbid:null,thread_id:c,suggestions:a}}}else return}}}}else return}}function I(a,c){var d=c.threadKey.threadFbId;if(d==null)return;else{a=i(a,{otherUserFbId:null,threadFbId:d});if(a!==void 0)return{action_type:b("MercuryActionType").PROMOTE_GROUP_ADMINS,thread_fbid:d.toString(),other_user_fbid:null,promoted_admins:b("bs_belt_Array").map(c.promotedAdmins,function(a){return{admin_fbid:a.adminFbId.toString(),admin_type:a.adminType}}),thread_id:a};else return}}function J(a,c){__p&&__p();var d=c.threadKey.threadFbId,e=c.threadKey.otherUserFbId;if(d==null)if(e==null)return;else{var f=i(a,{otherUserFbId:e,threadFbId:null});if(f!==void 0)return{action_type:b("MercuryActionType").REMOVE_MESSAGE,thread_fbid:null,messageId:c.messageID,other_user_fbid:e.toString(),removed_timestamp:c.deletionTimestamp,thread_id:f,author:b("MercuryIDs").getParticipantIDFromUserID(c.senderID)};else return}else{e=i(a,{otherUserFbId:null,threadFbId:d});if(e!==void 0)return{action_type:b("MercuryActionType").REMOVE_MESSAGE,thread_fbid:d.toString(),messageId:c.messageID,other_user_fbid:null,removed_timestamp:c.deletionTimestamp,thread_id:e,author:b("MercuryIDs").getParticipantIDFromUserID(c.senderID)};else return}}function K(a,c){var d=c.threadKey.otherUserFbId;if(d==null)return;else{a=i(a,{otherUserFbId:d,threadFbId:null});if(a!==void 0)return{action_type:b("MercuryActionType").UNSUBSCRIBE_STATUS_UPDATE,page_unsubscribe_status:c.unSubscribeStatus,thread_fbid:d.toString(),other_user_fbid:null,thread_id:a};else return}}function L(a,c){var d=c.threadKey.otherUserFbId;if(d==null)return;else{a=i(a,{otherUserFbId:d,threadFbId:null});if(a!==void 0)return{action_type:b("MercuryActionType").BLURRED_IMAGE_STATUS,blurred_image_uri:c.blurredImageUri,image_message_id:c.messageId,image_id:c.imageId,should_show:c.shouldShow,thread_fbid:d.toString(),other_user_fbid:null,thread_id:a};else return}}function M(a,c){var d=c.threadKey.otherUserFbId;if(d==null)return;else{a=i(a,{otherUserFbId:d,threadFbId:null});if(a!==void 0)return{action_type:b("MercuryActionType").IS_PIN_PROTECTED,thread_fbid:d.toString(),other_user_fbid:null,is_pin_protected:c.isPinProtected,thread_id:a};else return}}function N(a,c){var d=c.threadKey.otherUserFbId;if(d==null)return;else{a=i(a,{otherUserFbId:d,threadFbId:null});if(a!==void 0)return{action_type:b("MercuryActionType").UPDATE_CONNECTIVITY_STATUS,other_user_fbid:d.toString(),subtitle_type:c.subtitleType,thread_connectivity_status:c.threadConnectivityStatus,thread_fbid:d.toString(),thread_id:a};else return}}var O=function(a){return String.fromCharCode.apply(null,a)};function P(a,c){__p&&__p();c=JSON.parse(O(c.payload));c=b("bs_js_json").classify(c);if(typeof c==="number"||c.tag!==2)return b("bs_block").__(1,["DeltaClientDelta","malformed payload"]);else{c=b("bs_js_dict").get(c[0],"deltas");if(c!==void 0){c=b("bs_js_json").classify(b("bs_caml_option").valFromOption(c));if(typeof c==="number"||c.tag!==3)return b("bs_block").__(1,["DeltaClientDelta","delta is not an array"]);else{c=b("bs_belt_Array").get(c[0],0);if(c!==void 0){c=b("bs_js_json").classify(b("bs_caml_option").valFromOption(c));if(typeof c==="number"||c.tag!==2)return b("bs_block").__(1,["DeltaClientDelta","client delta is not an object"]);else{c=c[0];var d=!1,e=0,f=b("bs_js_dict").get(c,"deltaMessageReaction");if(f!==void 0){d=!0;f=q(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaMessageReaction",h):e=b("bs_block").__(1,["DeltaClientDelta.deltaMessageReaction","transform failed"])}f=b("bs_js_dict").get(c,"liveLocationData");if(f!==void 0&&!d){d=!0;f=s(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.liveLocationData",h):e=b("bs_block").__(1,["DeltaClientDelta.liveLocationData","transform failed"])}f=b("bs_js_dict").get(c,"deltaUpdateGroupEventRSVPStatus");if(f!==void 0&&!d){d=!0;f=t(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaUpdateGroupEventRSVPStatus",h):e=b("bs_block").__(1,["DeltaClientDelta.deltaUpdateGroupEventRSVPStatus","transform failed"])}f=b("bs_js_dict").get(c,"deltaPageThreadFollowUpData");if(f!==void 0&&!d){d=!0;f=u(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaPageThreadFollowUpData",h):e=b("bs_block").__(1,["DeltaClientDelta.deltaPageThreadFollowUpData","transform failed"])}f=b("bs_js_dict").get(c,"deltaChangeViewerStatus");if(f!==void 0&&!d){d=!0;f=w(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaChangeViewerStatus",h):e=b("bs_block").__(1,["DeltaClientDelta.deltaChangeViewerStatus","transform failed"])}f=b("bs_js_dict").get(c,"deltaMontageDirectExpire");if(f!==void 0&&!d){d=!0;f=x(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaMontageDirectExpire",h):e=b("bs_block").__(1,["DeltaClientDelta.deltaMontageDirectExpire","transform failed"])}f=b("bs_js_dict").get(c,"deltaMessageReply");if(f!==void 0&&!d){d=!0;f=y(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaMessageReply",h):e=b("bs_block").__(1,["DeltaClientDelta.deltaMessageReply","transform failed"])}f=b("bs_js_dict").get(c,"deltaUpdateGroupsSyncStatus");if(f!==void 0&&!d){d=!0;f=z(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaUpdateGroupsSyncStatus",h):e=b("bs_block").__(1,["DeltaClientDelta.deltaUpdateGroupsSyncStatus","transform failed"])}f=b("bs_js_dict").get(c,"deltaUpdateGroupsSyncMetadata");if(f!==void 0&&!d){d=!0;f=A(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaUpdateGroupsSyncMetadata",h):e=b("bs_block").__(1,["DeltaClientDelta.deltaUpdateGroupsSyncMetadata","transform failed"])}f=b("bs_js_dict").get(c,"deltaGroupThreadDescription");if(f!==void 0&&!d){d=!0;f=B(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaGroupThreadDescription",h):e=b("bs_block").__(1,["DeltaClientDelta.deltaGroupThreadDescription","transform failed"])}f=b("bs_js_dict").get(c,"deltaUpdateThreadTheme");if(f!==void 0&&!d){d=!0;f=D(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaUpdateThreadTheme",h):e=b("bs_block").__(1,["DeltaClientDelta.deltaUpdateThreadTheme","transform failed"])}f=b("bs_js_dict").get(c,"deltaUpdateSavedMessage");if(f!==void 0&&!d){d=!0;f=F(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaUpdateSavedMessage",h):e=b("bs_block").__(1,["DeltaClientDelta.deltaUpdateSavedMessage","transform failed"])}f=b("bs_js_dict").get(c,"deltaUpdatePinnedThread");if(f!==void 0&&!d){d=!0;f=E(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaUpdatePinnedThread",h):e=b("bs_block").__(1,["DeltaClientDelta.deltaUpdatePinnedThread","transform failed"])}f=b("bs_js_dict").get(c,"deltaUpdatePrivateGroupJoinableLink");if(f!==void 0&&!d){d=!0;f=G(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaUpdatePrivateGroupJoinableLink",h):e=b("bs_block").__(1,["DeltaClientDelta.deltaUpdatePrivateGroupJoinableLink","transform failed"])}f=b("bs_js_dict").get(c,"deltaOmniMDirectivesV2");if(f!==void 0&&!d){d=!0;f=H(b("bs_caml_option").valFromOption(f));if(f!==void 0){f=b("bs_caml_option").valFromOption(f);e=b("bs_block").__(0,["DeltaClientDelta.deltaOmniMDirectivesV2"]);b("MSuggestionActions").saveAllSuggestions(f.thread_id,f.suggestions)}else e=b("bs_block").__(1,["DeltaClientDelta.deltaOmniMDirectivesV2","transform failed"])}f=b("bs_js_dict").get(c,"deltaPromoteGroupThreadAdmin");if(f!==void 0&&!d){d=!0;f=I(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaPromoteGroupThreadAdmin",h):e=b("bs_block").__(1,["DeltaClientDelta.deltaPromoteGroupThreadAdmin","transform failed"])}f=b("bs_js_dict").get(c,"deltaRecallMessageData");if(f!==void 0&&!d){d=!0;f=J(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaRecallMessageData",h):e=b("bs_block").__(1,["DeltaClientDelta.deltaRecallMessageData","transform failed"])}f=b("bs_js_dict").get(c,"deltaPageUnSubscribeStatus");if(f!==void 0&&!d){d=!0;f=K(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaPageUnSubscribeStatus",h):e=b("bs_block").__(1,["DeltaClientDelta.deltaPageUnSubscribeStatus","transform failed"])}f=b("bs_js_dict").get(c,"deltaPageBlurredImageStatus");if(f!==void 0&&!d){d=!0;f=L(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaPageBlurredImageStatus",h):e=b("bs_block").__(1,["DeltaClientDelta.deltaPageBlurredImageStatus","transform failed"])}f=b("bs_js_dict").get(c,"deltaPaymentPinProtectionStatusData");if(f!==void 0){if(!d){d=!0;f=M(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaPaymentPinProtectionStatusData",h):e=b("bs_block").__(1,["DeltaClientDelta.deltaPaymentPinProtectionStatusData","transform failed"])}}else d||(e=b("bs_block").__(1,["DeltaClientDelta","unknown delta type: "+Object.keys(c).join(",")]));f=b("bs_js_dict").get(c,"deltaThreadConnectivityStatusUpdate");if(f!==void 0){if(!d){d=!0;f=N(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaThreadConnectivityStatusUpdateData",h):e=b("bs_block").__(1,["DeltaClientDelta.deltaThreadConnectivityStatusUpdateData","transform failed"])}}else d||(e=b("bs_block").__(1,["DeltaClientDelta","unknown delta type: "+Object.keys(c).join(",")]));return e}}else return b("bs_block").__(1,["DeltaClientDelta","client delta is missing"])}}else return b("bs_block").__(1,["DeltaClientDelta","client delta has no deltas"])}}function Q(a,c){__p&&__p();var d=[],e=[],f=c.folders,g=0;f==null||f.length===0?g=1:b("bs_belt_Array").forEachU(f,function(a){d.push({action_type:b("MercuryGlobalActionType").MARK_ALL_READ,action_id:null,folder:b("bs_js_dict").get(b("MessagingTag").IRIS_MAPPING,a),timestamp:parseInt(c.watermarkTimestamp,10)});return 0});g===1&&b("bs_belt_Array").forEachU(c.threadKeys,function(f){var d=i(a,f);if(d!==void 0){var g=parseInt(c.watermarkTimestamp,10);b("MercuryServerRequests").getForFBID(a).updateLastActionTimestamp(g);e.push({thread_id:d,action_type:b("MercuryActionType").CHANGE_READ_STATUS,other_user_fbid:f.otherUserFbId,thread_fbid:f.threadFbId,mark_as_read:!0,timestamp:g,folder:b("MessagingTag").INBOX});return 0}else return 0});return[d,e]}function R(a){if(a==null)return null;else return a.toString()}function S(a){a=a.skipBumpThread;if(!(a==null)&&a)return h;else return 1}function T(a,c){__p&&__p();var d;switch(c.tag|0){case 0:var e=c[0],f=j(a,e);p(a,f,"deltaNewMessage",S(e.messageMetadata));d=0;break;case 1:f=c[0];p(a,Object.assign(j(a,f.newMessage),{action_type:b("MercuryActionType").REPLACE_MESSAGE,replaced_message_id:f.replacedMessageId}),"deltaReplaceMessage",h);d=0;break;case 2:e=c[0];f=e.threadKey.otherUserFbId;var g;if(f==null){var k=e.threadKey.threadFbId;if(k==null)g=void 0;else{var l=b("MercuryThreadIDMap").getForFBID(a);l=l.getClientIDFromServerIDNow(k.toString());g=l==null?void 0:b("bs_caml_option").some(l)}}else{k=b("FBID.bs").ofString(f.toString());g=k!==void 0?b("bs_caml_option").some(b("MercuryIDs").getThreadIDFromUserID(b("bs_caml_option").valFromOption(k))):void 0}if(g!==void 0){l={};l[b("bs_caml_option").valFromOption(g)]=parseInt(e.deliveredWatermarkTimestampMs,10);b("MercuryDispatcher").getForFBID(a).handleUpdate({delivery_receipts:l,pinned_thread_ids:[],newlyAddedClientIDs:{},actions:[],preprocessed:!0});d=b("bs_block").__(0,["DeltaDeliveryReceipt"])}else d=b("bs_block").__(1,["DeltaDeliveryReceipt","no thread id"]);break;case 3:f=Q(a,c[0]);k=f[1];g=f[0];g.length!==0&&b("MercuryDispatcher").getForFBID(a).handleUpdate({actions:[],global_actions:g,pinned_thread_ids:[],newlyAddedClientIDs:{},preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});k.length!==0&&b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:k,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=g.length===0&&k.length===0?b("bs_block").__(1,["DeltaMarkRead","no local or global action"]):b("bs_block").__(0,["DeltaMarkRead"]);break;case 4:var o=c[0];e=b("bs_belt_Array").keepMapU(o.threadKeys,function(c){var d=i(a,c);if(d!==void 0){var e=parseInt(o.watermarkTimestamp,10);b("MercuryServerRequests").getForFBID(a).updateLastActionTimestamp(e);return{thread_id:d,action_type:b("MercuryActionType").CHANGE_READ_STATUS,other_user_fbid:c.otherUserFbId,thread_fbid:c.threadFbId,mark_as_read:!1,timestamp:e,folder:b("MessagingTag").INBOX}}});b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:e,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=b("bs_block").__(0,["DeltaMarkUnread"]);break;case 5:l=c[0];p(a,Object.assign(j(a,l),{action_type:b("MercuryActionType").LOG_MESSAGE,log_message_body:l.messageMetadata.adminText,log_message_data:{removed_participants:[b("MercuryIDs").getParticipantIDFromUserID(l.leftParticipantFbId)]},log_message_type:b("MercuryLogMessageType").UNSUBSCRIBE}),"DeltaParticipantLeftGroupThread",S(l.messageMetadata));d=0;break;case 6:f=c[0];p(a,Object.assign(j(a,f),{action_type:b("MercuryActionType").LOG_MESSAGE,log_message_body:f.messageMetadata.adminText,log_message_data:{added_participants:b("bs_belt_Array").map(f.addedParticipants,function(a){return b("MercuryIDs").getParticipantIDFromUserID(a.userFbId)})},log_message_type:b("MercuryLogMessageType").SUBSCRIBE}),"DeltaParticipantsAddedToGroupThread",S(f.messageMetadata));d=0;break;case 7:g=c[0];p(a,Object.assign(j(a,g),{action_type:b("MercuryActionType").LOG_MESSAGE,log_message_body:g.messageMetadata.adminText,log_message_data:{name:g.name},log_message_type:b("MercuryLogMessageType").THREAD_NAME}),"DeltaThreadName",S(g.messageMetadata));d=0;break;case 8:k=c[0];e={watermark:parseInt(k.watermarkTimestampMs,10),action:parseInt(k.actionTimestampMs,10)};l=k.threadKey.otherUserFbId;f=l==null?b("bs_caml_option").nullable_to_opt(k.actorFbId):l.toString();g=k.threadKey.otherUserFbId;if(g==null){l=k.threadKey.threadFbId;k=l==null?void 0:l.toString()}else k=g.toString();if(f!==void 0)if(k!==void 0){l=k;g=b("MercuryThreadIDMap").getForFBID(a);k=g.getClientIDFromServerIDNow(l);if(k==null)d=b("bs_block").__(1,["DeltaReadReceipt","No clientID for serverID: "+l]);else{g={};l={};f=b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(f));l[f]=e;g[k]=l;b("MercuryDispatcher").getForFBID(a).handleUpdate({roger:g,pinned_thread_ids:[],newlyAddedClientIDs:{},actions:[],preprocessed:!0});d=b("bs_block").__(0,["DeltaReadReceipt"])}}else d=b("bs_block").__(1,["DeltaReadReceipt","serverID is invalid"]);else d=b("bs_block").__(1,["DeltaReadReceipt","userID is invalid"]);break;case 9:f=c[0];p(a,Object.assign(j(a,f),{action_type:b("MercuryActionType").LOG_MESSAGE,log_message_body:f.messageMetadata.adminText,log_message_data:{message_type:f.type,untypedData:f.untypedData},log_message_type:b("MercuryLogMessageType").GENERIC_ADMIN_TEXT,message_unsendability_status:b("MessageUnsendabilityStatus.bs").fromNullableString(f.messageMetadata.unsendType)}),"DeltaAdminTextMessage",S(f.messageMetadata));d=0;break;case 10:e=c[0];k=i(a,{otherUserFbId:e.threadKey.otherUserFbId,threadFbId:e.threadKey.threadFbId});l=k!==void 0?{action_type:b("MercuryActionType").DELETE_MESSAGES,message_ids:e.messageIds,other_user_fbid:R(e.threadKey.otherUserFbId),thread_fbid:R(e.threadKey.threadFbId),thread_id:k}:void 0;g=e.threadKey.threadFbId;f=e.folder;if(l!==void 0){k=b("bs_caml_option").valFromOption(l);g==null||f==null?(p(a,k,"DeltaMessageDelete",h),d=0):(f==="FOLDER_MONTAGE"?b("MontageActions").requestUpdate(g.toString()):p(a,k,"DeltaMessageDelete",h),d=0)}else d=b("bs_block").__(1,["DeltaMessageDelete","transform failed"]);break;case 11:e=c[0];l=i(a,{otherUserFbId:e.threadKey.otherUserFbId,threadFbId:e.threadKey.threadFbId});if(l!==void 0){f=e.action;p(a,{action_type:b("MercuryActionType").CHANGE_ARCHIVED_STATUS,thread_fbid:R(e.threadKey.threadFbId),other_user_fbid:R(e.threadKey.otherUserFbId),archived:f==null?!1:f===b("MessagingThreadAction").ACTION_ARCHIVED,thread_id:l},"DeltaThreadAction",h);d=0}else d=b("bs_block").__(1,["DeltaThreadAction","transform failed"]);break;case 12:g=b("bs_belt_Array").keepMapU(c[0].threadKeys,function(c){var d=i(a,c);if(d!==void 0)return{thread_id:d,action_type:b("MercuryActionType").DELETE_THREAD,other_user_fbid:c.otherUserFbId,thread_fbid:c.threadFbId}});b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:g,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=b("bs_block").__(0,["DeltaThreadDelete"]);break;case 13:k=c[0];e=i(a,{otherUserFbId:null,threadFbId:k.messageMetadata.threadKey.threadFbId});e!==void 0?(p(a,{action_type:b("MercuryActionType").REMOVE_GROUP_ADMINS,action_id:null,thread_fbid:R(k.messageMetadata.threadKey.threadFbId),other_user_fbid:null,removed_admin_ids:k.removedAdminFbIds,thread_id:e},"DeltaAdminRemovedFromGroupThread",h),d=0):d=b("bs_block").__(1,["DeltaAdminRemovedFromGroupThread","transform failed"]);break;case 14:f=c[0];l=i(a,f.threadKey);if(l!==void 0){g=[{thread_id:l,action_type:b("MercuryActionType").CHANGE_MUTE_SETTINGS,thread_fbid:f.threadKey.threadFbId,other_user_fbid:f.threadKey.otherUserFbId,mute_until:parseInt(f.expireTime,10)}];b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:g,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=b("bs_block").__(0,["DeltaThreadMuteSettings"])}else d=b("bs_block").__(1,["DeltaThreadMuteSettings","invalid thread ID"]);break;case 15:k=c[0];e=k.jsonBlob;if(e==null)d=b("bs_block").__(1,["DeltaPagesManagerEvent","no jsonBlob"]);else{try{l=JSON.parse(e)}catch(a){l={}}f=b("bs_js_json").classify(l);if(typeof f==="number"||f.tag!==2)d=b("bs_block").__(1,["DeltaPagesManagerEvent","jsonBlob is not an object"]);else{g=f[0];e=b("bs_js_dict").get(g,"type");if(e!==void 0){l=b("bs_js_json").classify(b("bs_caml_option").valFromOption(e));if(typeof l==="number"||l.tag!==1)d=b("bs_block").__(1,["DeltaPagesManagerEvent","type is not a number"]);else if(l[0]===b("PagesMessagingEventType").FLAG){f=b("bs_js_dict").get(g,"flagData");if(f!==void 0){e=b("bs_js_json").classify(b("bs_caml_option").valFromOption(f));if(typeof e==="number"||e.tag!==2)l=!1;else{g=b("bs_js_dict").get(e[0],"state");if(g!==void 0){f=b("bs_js_json").classify(b("bs_caml_option").valFromOption(g));l=typeof f==="number"?f===1:!1}else l=!1}}else l=!1;e=i(a,k.threadKey);if(e!==void 0){g=[{thread_id:e,action_type:b("MercuryActionType").CHANGE_FLAG,mark_as_flag:l,other_user_fbid:k.threadKey.otherUserFbId,thread_fbid:k.threadKey.threadFbId}];b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:g,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=b("bs_block").__(0,["DeltaPagesManagerEvent"])}else d=b("bs_block").__(1,["DeltaPagesManagerEvent","threadID is invalid"])}else d=b("bs_block").__(1,["DeltaPagesManagerEvent","type is not pagesFlag"])}else d=b("bs_block").__(1,["DeltaPagesManagerEvent","no type on jsonBlob"])}}break;case 16:f=c[0];e=i(a,{otherUserFbId:null,threadFbId:f.messageMetadata.threadKey.threadFbId});e!==void 0?(p(a,{action_type:b("MercuryActionType").APPROVAL_MODE,action_id:null,thread_fbid:R(f.messageMetadata.threadKey.threadFbId),other_user_fbid:null,approval_mode:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("MessengerApprovalModeTypes"),f.mode)),thread_id:e},"DeltaApprovalMode",h),d=0):d=b("bs_block").__(1,["DeltaApprovalMode","transform failed"]);break;case 17:l=c[0];k=i(a,{otherUserFbId:l.messageMetadata.threadKey.otherUserFbId,threadFbId:l.messageMetadata.threadKey.threadFbId});if(k!==void 0){g=k;f=l.inviterFbId;if(f==null){e=l.recipientFbId;if(!(e==null)){k=b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(e));e=l.action===b("MessengerApprovalQueueTypes").REMOVED;var q=l.action===b("MessengerApprovalQueueTypes").REQUESTED;p(a,{action_type:b("MercuryActionType").APPROVAL_QUEUE,action_id:null,thread_fbid:R(l.messageMetadata.threadKey.threadFbId),other_user_fbid:R(l.messageMetadata.threadKey.otherUserFbId),removed_id:e?k:null,added_id:q?k:null,thread_id:g},"DeltaApprovalQueue",h)}}else{e=l.action===b("MessengerApprovalQueueTypes").REMOVED;q=l.action===b("MessengerApprovalQueueTypes").REQUESTED;if(q){k=l.requestSource;var r;if(k==null)r=b("MessengerGroupRequestSource").ADD;else switch(k){case"ADD":r=b("MessengerGroupRequestSource").ADD;break;case"JOIN_THROUGH_LINK":r=b("MessengerGroupRequestSource").JOIN_THROUGH_LINK;break;default:r=b("MessengerGroupRequestSource").ADD}q={requester:{id:l.recipientFbId},inviter:{id:f},request_source:r,request_timestamp:l.requestTimestamp}}else q=null;p(a,{action_type:b("MercuryActionType").APPROVAL_QUEUE,action_id:null,thread_fbid:R(l.messageMetadata.threadKey.threadFbId),other_user_fbid:R(l.messageMetadata.threadKey.otherUserFbId),removed_group_id:e?l.recipientFbId:null,added_group_id:q,thread_id:g},"DeltaApprovalQueue",h)}d=0}else d=b("bs_block").__(1,["DeltaApprovalQueue","transform failed"]);break;case 18:k=c[0];p(a,j(a,k.deltaNewMessage),"DeltaGenieMessage",S(k.deltaNewMessage.messageMetadata));d=0;break;case 19:f=c[0];e=f.messageMetadata.threadKey;if(e==null)l=void 0;else{q=e.threadFbId;l=q==null?void 0:q}g=f.initiator;if(g==null)k=void 0;else{e=g.userFbId;k=e==null?void 0:e.toString()}q=i(a,{otherUserFbId:null,threadFbId:l});q!==void 0?(p(a,{action_type:b("MercuryActionType").UPDATE_RTC_CALL_DATA,thread_fbid:R(l),other_user_fbid:null,call_state:f.callState,server_info_data:f.serverInfoData,initiator_fbid:k,thread_id:q},"DeltaRTCCallData",h),d=0):d=b("bs_block").__(1,["DeltaRTCCallData","transform failed"]);break;case 20:g=c[0];e=i(a,g.threadKey);if(e!==void 0){l=[{thread_id:e,action_type:b("MercuryActionType").CHANGE_FOLDER,other_user_fbid:g.threadKey.otherUserFbId,new_folder:b("bs_js_dict").get(b("MessagingTag").IRIS_MAPPING,g.folder)}];b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:l,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=b("bs_block").__(0,["DeltaThreadFolder"])}else d=b("bs_block").__(1,["DeltaThreadFolder","threadID is invalid"]);break;case 21:f=c[0];k=i(a,f.threadKey);if(k!==void 0){q=[{thread_id:k,action_type:b("MercuryActionType").MUTATE_TAGS,messageId:f.messageId,tags_to_add:f.tagsToAdd,tags_to_delete:f.tagsToDelete}];b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:q,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=b("bs_block").__(0,["DeltaMutateMessageTags"])}else d=b("bs_block").__(1,["DeltaMutateMessageTags","threadID is invalid"]);break;case 22:d=P(a,c[0]);break}if(typeof d==="number")return 0;else if(d.tag)return n(d[0],d[1]);else return m(d[0])}function a(a,c){__p&&__p();if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").NewMessage))return T(a,b("bs_block").__(0,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ReplaceMessage))return T(a,b("bs_block").__(1,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").DeliveryReceipt))return T(a,b("bs_block").__(2,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").MarkRead))return T(a,b("bs_block").__(3,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").MarkUnread))return T(a,b("bs_block").__(4,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ParticipantLeftGroupThread))return T(a,b("bs_block").__(5,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ParticipantsAddedToGroupThread))return T(a,b("bs_block").__(6,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ThreadName))return T(a,b("bs_block").__(7,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ReadReceipt))return T(a,b("bs_block").__(8,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").AdminTextMessage))return T(a,b("bs_block").__(9,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").MessageDelete))return T(a,b("bs_block").__(10,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ThreadAction))return T(a,b("bs_block").__(11,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ThreadDelete))return T(a,b("bs_block").__(12,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").AdminRemovedFromGroupThread))return T(a,b("bs_block").__(13,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ThreadMuteSettings))return T(a,b("bs_block").__(14,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").PagesManagerEvent))return T(a,b("bs_block").__(15,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ApprovalMode))return T(a,b("bs_block").__(16,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ApprovalQueue))return T(a,b("bs_block").__(17,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ClientPayload))return T(a,b("bs_block").__(22,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").GenieMessage))return T(a,b("bs_block").__(18,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").RtcCallData))return T(a,b("bs_block").__(19,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").MarkFolderSeen)){m("DeltaMarkFolderSeen");return b("bs_curry")._2(b("MessengerState.bs").send,b("bs_caml_option").some(a),[b("bs_block").__(0,[b("bs_block").__(64,[c])])])}else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ThreadFolder))return T(a,b("bs_block").__(20,[c]));else return 0}f.transform=a}),null);
__d("EmojiLikeConstants",["EmojiStaticConfig"],(function(a,b,c,d,e,f){"use strict";a=b("EmojiStaticConfig").sizeMap;c=Object.freeze({XSMALL:"xsmall",SMALL:"small",MEDIUM:"medium",LARGE:"large"});d={dp16:"xsmall",dp32:"small",dp64:"medium",db64:"medium",dp128:"large"};f=Object.freeze({PICKER:"picker",HOT_LIKE:"hot_like"});b=[983040];var g="hot_emoji_source",h="hot_emoji_size",i="emoji_like",j="\ud83d\udc4d",k=[128077];e.exports={FB_THUMBS_UP_EMOJI:b,size:c,sizeMap:a,sizeMapTransfer:d,source:f,SOURCE_TAG_PREFIX:g,TAG_PREFIX_NEW:h,TAG_PREFIX_OLD:i,THUMBS_UP_EMOJI:j,THUMBS_UP_EMOJI_CODES:k}}),null);
__d("EmojiLikeUtils",["EmojiLikeConstants","MercuryTagHelper"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a,b){!a.tags?a.tags=[g(b)]:a.tags.push(g(b));return a}function g(a){var c=b("EmojiLikeConstants").TAG_PREFIX_NEW;return c+":"+a}function c(a,b){!a.tags?a.tags=[h(b)]:a.tags.push(h(b));return a}function h(a){return b("EmojiLikeConstants").SOURCE_TAG_PREFIX+":"+a}function d(a){return i(a)!=null}function i(a){if(!a.tags)return null;var c=b("MercuryTagHelper").get(a.tags,b("EmojiLikeConstants").TAG_PREFIX_NEW);return c?c:b("MercuryTagHelper").get(a.tags,b("EmojiLikeConstants").TAG_PREFIX_OLD)}e.exports={getEmojiSize:i,isEmojiLike:d,setEmojiSize:a,setEmojiSource:c}}),null);
__d("MercuryMessageClientState",[],(function(a,b,c,d,e,f){a=Object.freeze({DO_NOT_SEND_TO_SERVER:"do_not_send_to_server",SEND_TO_SERVER:"send_to_server"});e.exports=a}),null);
__d("MessageRequestUtils",["CurrentUser","MercuryIDs","MessagingTag","ThreadConnectivityStatusGraphQLType.re","getPageIDFromThreadID"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={isMessageRequest:function(a){return(a.folder===b("MessagingTag").PENDING||a.folder===b("MessagingTag").OTHER)&&a.can_reply},isFiltered:function(a){return a.folder===b("MessagingTag").OTHER},shouldShowComposerPendingActions:function(a){return this.isMessageRequest(a)&&(b("MercuryIDs").isGroupChat(a.thread_id)||!!b("getPageIDFromThreadID")(a.thread_id)||b("CurrentUser").isWorkUser())},shouldShowThreadlistPendingActions:function(a){return a.folder===b("MessagingTag").PENDING&&a.can_reply&&(b("MercuryIDs").isGroupChat(a.thread_id)||!!b("getPageIDFromThreadID")(a.thread_id)||b("CurrentUser").isWorkUser())},shouldShowUnconnectedThreadInfoText:function(a){var c;return!b("CurrentUser").isWorkUser()&&b("CurrentUser").getID()!==a.other_user_fbid&&((c=a.thread_connectivity_data)==null?void 0:c.connectivity_status)===b("ThreadConnectivityStatusGraphQLType.re").unconnected&&((c=a.thread_connectivity_data)==null?void 0:c.first_sender_id)===a.other_user_fbid},shouldSendTypingIndicators:function(a){if(!a)return!1;if(this.isMessageRequest(a))return!1;return b("CurrentUser").isWorkUser()||b("MercuryIDs").isGroupChat(a.thread_id)?!0:((a=a.thread_connectivity_data)==null?void 0:a.connectivity_status)===b("ThreadConnectivityStatusGraphQLType.re").implicitOrTwoWayMessaging}};e.exports=a}),null);
__d("MessengerPersistantViewerKeyedSubscriptionComponent.bs",["bs_curry","React","bs_js_dict","bs_caml_option","CurrentUser","RemoteAction.bs"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a){__p&&__p();var c=[0],d={},e=function(a,c){a=a!==void 0?b("bs_caml_option").valFromOption(a):b("CurrentUser").getID();var e=b("bs_js_dict").get(d,a);if(e!==void 0)return b("RemoteAction.bs").send(e[0],c);else{e=f(a,void 0,0);return b("RemoteAction.bs").send(e[0],c)}},f=function(f,g,h){__p&&__p();h=g!==void 0?b("bs_caml_option").valFromOption(g):b("RemoteAction.bs").create(0);var i=new Set(),j=[b("bs_curry")._1(a.initialState,f)];b("RemoteAction.bs").subscribe(function(c){var d=j[0];j[0]=b("bs_curry")._2(a.reducer,c,d);if(j[0]!==d){i.forEach(function(a){return b("bs_curry")._1(a[1],0)});return 0}else return 0},h);g=function(a,d){__p&&__p();var e=b("React").useState(function(){return j[0]}),f=e[1],g=e[0],k=b("React").useCallback(function(c){if(a!==void 0)if(b("bs_curry")._2(a,g,j[0]))return b("bs_curry")._1(f,function(a){return j[0]});else return 0;else return b("bs_curry")._1(f,function(a){return j[0]})},[a,g,j[0]]);b("React").useEffect(function(){c[0]=c[0]+1|0;var a=c[0],d=[a,k];i.add(d);b("bs_curry")._1(k,0);return function(a){i["delete"](d);return 0}},[k]);return b("bs_curry")._1(d,g)};h=[h,g];d[f]=h;var k=b("bs_caml_option").some(f);b("bs_curry")._2(a.onFirstMount,f,function(a){return e(k,a)});return h},g=function(a){var c=a.shouldUpdate,e=a.remoteAction,g=a.fbid;g=g!==void 0?b("bs_caml_option").valFromOption(g):b("CurrentUser").getID();a=a.children;var h=b("bs_js_dict").get(d,g);if(h!==void 0)return b("bs_curry")._2(h[1],c,a);else return b("bs_curry")._2(f(g,e,0)[1],c,a)};g.displayName="MessengerPersistantViewerKeyedSubscriptionComponent("+(a.displayName+")");return{make:g,send:e}}f.Make=a}),null);
__d("MessengerState.bs",["invariant","URI","FBID.bs","bs_array","bs_block","bs_curry","JSSet.bs","Utils.bs","FBJSON","Arbiter","gkx","bs_js_dict","qex","bs_belt_Map","bs_belt_Set","bs_caml_obj","JSLogger","ThreadId.bs","FBIDCheck","immutable","bs_belt_Array","bs_caml_array","ChatConfig","LogHistory","MercuryIDs","bs_pervasives","bs_belt_Option","bs_caml_option","AsyncRequest","MessagingTag","TypingStates","MercuryAssert","MercuryViewer","ParticipantId.bs","bs_belt_MapString","bs_caml_primitive","MercuryFilters.bs","ImmutableObject","MercuryLocalIDs","ChannelConstants","MessengerFolders.bs","MessengerMessage.bs","bs_js_null_undefined","MercuryActionType","MercuryAttachment","MercuryDispatcher","MercuryMessageIDs.bs","MercuryThreadInfo","MessengerPersonas.bs","XGroupsController","MercuryThreadIDMap","PageCommItemStatus","MercuryActionStatus","MessageRequestUtils","MessagingThreadType","MercuryPayloadSource","MessengerEnvironment","MessengerThreadUtils.bs","MercuryLogMessageType","MercuryServerRequests","MercuryThreadInformer","MercurySyncEventsProxy","MercuryGlobalActionType","MessageProfileRangeType","ThreadConnectivityStatus.bs","MercuryMessageClientState","MessengerGroupsSyncStatus","MercuryThreadlistConstants","MessageUnsendabilityStatus","setTimeoutAcrossTransitions","MessagingGenericAdminTextType","MessengerDesktopNotifications","ChatReliabilityInstrumentation","RemovedMessageTombstoneContent","MessengerThreadCannotReplyReason.bs","RepliedToMessageStatusForGraphQL","XMercuryThreadLikeIconController","MessengerSharedMediaActionsLoader","MessengerSharedPhotosVideosBaseData.bs","MercuryDisplayTimeFilterMessageRenderer","MessengerPersistantViewerKeyedSubscriptionComponent.bs"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h;function i(a){var c={};b("bs_belt_Map").forEach(a,function(b,a){c[b]=a;return 0});return c}function a(a){return i(a[7])}function j(a,c){return b("bs_js_null_undefined").fromOption(b("bs_belt_Map").get(a[7],c))}function c(a){return a[0]}function d(a){return a[1]}function e(a){return a[2]}function k(a){return a[3]}function l(a){return a[4]}function m(a){return a[5]}function aa(a){return a[6]}function ba(a){return a[8]}function ca(a){return a[9]}function da(a){return a[10]}function n(a){return a[11]}function o(a){return a[12]}function p(a){return a[13]}function q(a){return a[14]}function ea(a){return a[15]}function fa(a){return a[16]}function ga(a){return a[17]}function ha(a){return a[18]}function r(a){b("ChatReliabilityInstrumentation").logMESSAGE_RECEIVED(b("FBJSON").stringify({otid:a.offline_threading_id,message_id:a.message_id,other_user_fbid:a.other_user_fbid}));return 0}function ia(a,c,d){d=d.reduce(b("bs_belt_Set").remove,c.reduce(b("bs_belt_Set").add,a[3]));if(d===a[3])return a;else return[a[0],a[1],a[2],d,a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15],a[16],a[17],a[18]]}var ja=function(a,b){delete a[b];return 0};function ka(a,c,d){var e=b("bs_belt_MapString").get(a,c);if(e!==void 0){e=b("bs_caml_option").valFromOption(e);var f=b("bs_belt_Map").get(e,d);if(f!==void 0)return b("bs_belt_MapString").set(a,c,b("bs_belt_Map").remove(e,d));else return a}else return a}function la(a,c){__p&&__p();var d=c.thread_fbid;if(d==null)if(c.type==="typ"||c.type==="page_typing"){c=b("FBID.bs").ofString(c.from.toString());if(c!==void 0)return b("MercuryIDs").getThreadIDFromUserID(b("bs_caml_option").valFromOption(c));else return null}else return null;else{c=b("MercuryThreadIDMap").getForFBID(a);return c.getClientIDFromServerIDNow(d.toString())}}var ma=b("MercuryFilters.bs").getSupportedFilters(0).concat([b("MercuryFilters.bs").all,b("MercuryFilters.bs").groups]),na=b("MessengerFolders.bs").getSupportedFolders(0).concat([b("MessagingTag").SPAM,b("MessagingTag").PAGE_BACKGROUND]);function oa(a){var b={};na.forEach(function(a){var c={};ma.forEach(function(a){c[a]={threadlist:[],reachedEnd:!1,existingIDs:new Set()};return 0});b[a]=c;return 0});return b}function pa(a,c){a=b("MercuryThreadInformer").getForFBID(a);a.invalidatedThread(c);return 0}function s(a,c){a=b("MercuryThreadInformer").getForFBID(a);a.updatedThread(c);return 0}function qa(a,c){a=b("MercuryThreadInformer").getForFBID(a);a.deletedThread(c);return 0}function ra(a,c,d,e){a=b("MercuryThreadInformer").getForFBID(a);a.changedThreadReadState(c,d,e);return 0}function sa(a,c){__p&&__p();var d=new Map();c.forEach(function(a,b){d.set(a,b);return 0});return c.sort(function(c,e){__p&&__p();var f=b("bs_belt_Map").get(a[7],c),g=b("bs_belt_Map").get(a[7],e);if(f!==void 0&&g!==void 0){g=b("bs_caml_option").valFromOption(g).timestamp-b("bs_caml_option").valFromOption(f).timestamp;if(g>0)return 1;else if(g<0)return-1;else return 0}f=d.get(c);g=d.get(e);return b("bs_belt_Option").getExn(f==null?void 0:b("bs_caml_option").some(f))-b("bs_belt_Option").getExn(g==null?void 0:b("bs_caml_option").some(g))|0})}function ta(a,c,d,e){__p&&__p();a=b("bs_js_dict").get(a[12],d);if(a!==void 0){d=b("bs_js_dict").get(b("bs_caml_option").valFromOption(a),e);if(d!==void 0){var f=b("bs_caml_option").valFromOption(d);c.forEach(function(a){if(f.existingIDs.has(a)){f.existingIDs["delete"](a);a=f.threadlist.indexOf(a);f.threadlist.splice(a,1);return 0}else return 0});return 0}else return 0}else return 0}function t(a,c,d,e){__p&&__p();a=a!==void 0?a:function(a){return!0};var f=b("bs_belt_Map").get(c[7],d);if(f!==void 0){f=b("bs_caml_option").valFromOption(f);if(b("bs_curry")._1(a,f)){a=b("ImmutableObject").set(f,e);f=b("bs_belt_Map").set(c[7],d,a);s(c[0],d);return[c[0],c[1],c[2],c[3],c[4],c[5],c[6],f,c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15],c[16],c[17],c[18]]}else return c}else return c}function ua(c,a,d){__p&&__p();var e=new Set(a.participants);Object.assign(a,{participants:Array.from(a.participants)});d.forEach(function(d){if(e.has(d))return 0;else{a.participants.push(d);if(b("bs_caml_obj").caml_equal(d,c)){Object.assign(a,{is_subscribed:!0,can_reply:!0,cannot_reply_reason:null});return 0}else return 0}});return 0}function va(a,c,d,e){__p&&__p();na.forEach(function(b){if(b!==d)return ta(a,c,b,e);else return 0});var f=b("bs_js_dict").get(a[12],d);if(f!==void 0){f=b("bs_js_dict").get(b("bs_caml_option").valFromOption(f),e);if(f!==void 0){f=b("bs_caml_option").valFromOption(f);f=[f.threadlist,f.existingIDs]}else f=[[],new Set()]}else f=[[],new Set()];var g=f[1],h=f[0];c.forEach(function(a){if(g.has(a))return 0;else{g.add(a);h.push(a);return 0}});return[sa(a,h),g]}function wa(a,c,d){__p&&__p();if(d!==void 0){var e=b("bs_js_dict").get(a[16],c);if(e!==void 0){b("bs_caml_option").valFromOption(e).add(b("bs_caml_option").valFromOption(d));e=b("MercuryThreadInformer").getForFBID(a[0]);e.updatedUnreadState();return 0}else{d=b("MercuryServerRequests").getForFBID(a[0]);d.fetchUnreadThreadIDs(c);return 0}}else return 0}var xa=b("MessengerFolders.bs").getSupportedFolders(0).filter(function(a){return a!==b("MessagingTag").ACTION_ARCHIVED});function ya(a,c,d){__p&&__p();if(d!==void 0){var e=b("bs_js_dict").get(a[16],c);if(e!==void 0){b("bs_caml_option").valFromOption(e)["delete"](b("bs_caml_option").valFromOption(d));e=b("MercuryThreadInformer").getForFBID(a[0]);e.updatedUnreadState();return 0}else{d=b("MercuryServerRequests").getForFBID(a[0]);d.fetchUnreadThreadIDs(c);return 0}}else return 0}function za(c,a,d){var e=b("MessengerFolders.bs").getFromMeta(a);if(d!==e){xa.includes(e)&&a.unread_count>0&&wa(c,e,b("bs_caml_option").some(a.thread_id));if(xa.includes(d))return ya(c,d,b("bs_caml_option").some(a.thread_id));else return 0}else return 0}function Aa(c,a){__p&&__p();var d=b("MessengerFolders.bs").getFromMeta(a);if(na.includes(d)){ma.forEach(function(e){var f=c[12][d][e],g=f.existingIDs.has(a.thread_id);va(c,[a.thread_id],d,e);var h=b("bs_caml_obj").caml_equal(b("bs_caml_array").caml_array_get(f.threadlist,f.threadlist.length-1|0),a.thread_id);if(!f.reachedEnd&&!g&&h)return ta(c,[a.thread_id],d,e);else return 0});return 0}else return 0}function Ba(a,c,d,e){__p&&__p();var f=b("bs_belt_Map").get(a[7],c);if(f!==void 0){f=b("bs_caml_option").valFromOption(f);var g=b("MessengerFolders.bs").getFromMeta(f);if(g!==d){if(e){e=f.comm_status;e=e==null?b("ImmutableObject").set(f,{folder:d}):d===b("MessagingTag").OTHER?b("ImmutableObject").set(f,{folder:d,comm_status:b("PageCommItemStatus").SPAM}):d===b("MessagingTag").INBOX?b("ImmutableObject").set(f,{folder:d,comm_status:b("PageCommItemStatus").TODO}):b("ImmutableObject").set(f,{folder:d})}else e=f;var h=f.other_user_fbid;h=h==null?[]:d===b("MessagingTag").OTHER?[b("MercuryIDs").getParticipantIDFromUserID(h)]:[];var i=f.other_user_fbid;d=i==null?[]:d===b("MessagingTag").OTHER?[]:[b("MercuryIDs").getParticipantIDFromUserID(i)];i=ia(a,h,d);h=b("bs_belt_Map").set(i[7],c,e);za(i,e,g);Aa(i,e);s(i[0],c);return[i[0],i[1],i[2],i[3],i[4],i[5],i[6],h,i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15],i[16],i[17],i[18]]}else{Aa(a,f);return a}}else return a}function u(a,c,d){__p&&__p();d=c.is_filtered_content?b("MercuryDisplayTimeFilterMessageRenderer").renderFilteredContent(c):d!==void 0?d:c.body;var e=c.raw_attachments;e=!(e==null)&&e.length!==0?b("MercuryAttachment").convertRaw(e):c.attachments;var f=c.removed_timestamp;if(f==null){f=c.log_message_type;d={snippet:d,snippet_attachments:e,snippet_sender:f==null?c.author:null}}else d={snippet:b("RemovedMessageTombstoneContent").getTombstoneContentForSnippet(c.author),snippet_attachments:null,snippet_sender:null};return Object.assign(a,d)}function Ca(a,c,d){var e=a.event_title,f=a.event_time;a=a.event_location_name;return{creator_id:null,latitude:null,location_address:null,longitude:null,note:"",related_event:{id:""},repeat_mode:null,seconds_to_notify_before:0,status:null,track_rsvp:c.track_rsvp,title:e==null?c.title:e,event_time:f==null?c.event_time:parseInt(f,10),location_name:a==null?c.location_name:a,event_members:d!==void 0?b("bs_caml_option").valFromOption(d):c.event_members,oid:c.oid,event_type:c.event_type}}function v(b,a){var c={};Object.keys(b).forEach(function(a){c[a]=b[a];return 0});c[a.guest_id]=a.guest_status;return c}var Da=function(a,b){delete a[b];return 0},Ea=function(a,b){delete a[b];return 0};function Fa(a){__p&&__p();var c=[-1],d=[null],e=Math.floor(Date.now()/1e3);b("bs_js_dict").entries(a).forEach(function(a){a=a[1];var b=a.event_time;if(b>e&&(c[0]<0||c[0]>b)){c[0]=b;d[0]=a;return 0}else return 0});return d[0]}function Ga(a,c,d){d=b("XMercuryThreadLikeIconController").getURIBuilder().setString("emoji",d).getURI();new(b("AsyncRequest"))(d).setHandler(function(d){var e=b("MercuryDispatcher").getForFBID(a);e.handleUpdate({actions:[{action_type:b("MercuryActionType").UPDATE_CUSTOM_LIKE,thread_id:c,custom_like:d.getPayload()}],from_client:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANGE_CUSTOM_LIKE});return 0}).send();return 0}function Ha(d,a,c,e){__p&&__p();c=c.log_message_data;if(c==null)return 0;else{var f=c.untypedData;if(c.message_type===b("MessagingGenericAdminTextType").CHANGE_THREAD_NICKNAME){var g=a.custom_nickname;if(!(g==null)){g=b("bs_js_dict").fromArray(b("bs_js_dict").entries(g));var h=f.nickname;h.trim().length>0?g[f.participant_id]=h:b("bs_curry")._2(Ea,g,f.participant_id);Object.assign(a,{custom_nickname:g})}s(d,e)}else if(c.message_type===b("MessagingGenericAdminTextType").CHANGE_THREAD_ICON)Ga(d,e,f.thread_icon);else if(c.message_type===b("MessagingGenericAdminTextType").CHANGE_THREAD_THEME){if(!b("ChatConfig").get("chat_tab_has_gradients")){h=f.theme_color;if(h==null)Object.assign(a,{solid_color:null,header_color:null,footer_color:null,gradient_colors:[]});else if(h.length>0){g="#"+h.slice(2);Object.assign(a,{solid_color:g,header_color:g,footer_color:g,gradient_colors:[g]})}else Object.assign(a,{solid_color:null,header_color:null,footer_color:null,gradient_colors:[]});s(d,e)}}else if(f!==void 0)if(c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_CREATE){var i={},k=f.event_creator_id;a.participants.forEach(function(a){a=b("MercuryIDs").getUserIDFromParticipantID(a);if(a==null)return 0;else{var c=b("bs_caml_obj").caml_equal(a,k);i[a]=c?"GOING":"INVITED";return 0}});h=b("bs_js_dict").fromArray(b("bs_js_dict").entries(a.lightweight_events));g=f.event_time;g={track_rsvp:f.event_track_rsvp,title:f.event_title,event_time:g==null?0:parseInt(g,10),location_name:f.event_location_name,event_members:i,oid:f.event_id,event_type:f.event_type};Object.assign(a,{lightweight_event:g});h[f.event_id]=Object.assign({},g);Object.assign(a,{lightweight_events:h});s(d,e)}else if(c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE||c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_TIME||c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_TITLE||c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_LOCATION){g=a.lightweight_event;if(!(g==null)){h=b("bs_js_dict").fromArray(b("bs_js_dict").entries(a.lightweight_events));g.oid===f.event_id&&Object.assign(a,{lightweight_event:Ca(f,g,b("bs_caml_option").some(g.event_members))});g=b("bs_js_dict").get(h,f.event_id);g!==void 0&&(h[f.event_id]=Ca(f,b("bs_caml_option").valFromOption(g),void 0),Object.assign(a,{lightweight_events:h}))}s(d,e)}else if(c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_RSVP){g=b("bs_js_dict").fromArray(b("bs_js_dict").entries(a.lightweight_events));h=a.lightweight_event;if(!(h==null)&&h.oid===f.event_id){var l=v(h.event_members,f);Object.assign(a,{lightweight_event:Ca(f,h,b("bs_caml_option").some(l))})}h=b("bs_js_dict").get(g,f.event_id);if(h!==void 0){l=b("bs_caml_option").valFromOption(h);h=v(l.event_members,f);g[f.event_id]=Ca(f,l,b("bs_caml_option").some(h));Object.assign(a,{lightweight_events:g})}s(d,e)}else if(c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_DELETE||c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_NOTIFY){l=b("bs_js_dict").fromArray(b("bs_js_dict").entries(a.lightweight_events));b("bs_curry")._2(Da,l,f.event_id);Object.assign(a,{lightweight_event:Fa(l),lightweight_events:l});s(d,e)}return 0}}function Ia(a,c,d,e){a=b("MercuryThreadInformer").getForFBID(a);a.updatedMessage(c,d,b("bs_js_null_undefined").fromOption(e));return 0}function w(c,a){c=b("MercuryThreadInformer").getForFBID(c);c.receivedMessage(a);return 0}function Ja(a,c,d){a=b("MercuryThreadInformer").getForFBID(a);a.reorderedMessages(c,d);return 0}function Ka(a,c,d,e,f){a=b("MercuryThreadInformer").getForFBID(a);f=b("bs_belt_Option").getWithDefault(b("bs_belt_Option").map(f==null?void 0:b("bs_caml_option").some(f),function(a){return b("bs_belt_Array").keepMap(a,function(a){return b("bs_caml_option").nullable_to_opt(a.message_file_fbid)})}),[]);a.deletedMessage(c,d,b("bs_js_null_undefined").fromOption(e),f);return 0}function La(a,c,d,e){a=b("MercuryThreadInformer").getForFBID(a);a.deletedMessage(c,d,b("bs_js_null_undefined").fromOption(e),null);return 0}var Ma=function(a,b){delete a[b];return 0};function Na(a,c){var d=a[10].get(c);return b("bs_caml_option").nullable_to_opt(a[9].get(b("bs_belt_Option").getWithDefault(d==null?void 0:b("bs_caml_option").some(d),c)))}function Oa(a,c,d){a=a!==void 0?a:!1;d=b("bs_belt_Array").keepMap(d,function(a){return Na(c,a)});if(a)return d.slice().reverse();else return d}function Pa(a,c){return b("bs_belt_Array").keepMap(c,function(b){return Na(a,b)}).sort(function(a,c){return b("MessengerMessage.bs").compare(c,a)}).map(function(a){return a.message_id})}function Qa(a,b){return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9].set(b[0],b[1]),a[10],a[11],a[12],a[13],a[14],a[15],a[16],a[17],a[18]]}function x(b,a){b[10].set(a.message_id,a.message_id);return[b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12],b[13],b[14],b[15],b[16],b[17],b[18]]}var Ra=function(a,b){delete a[b];return 0};function y(c,d){__p&&__p();var a=c[15];Object.keys(d).forEach(function(e){__p&&__p();var f=b("bs_js_dict").get(d,e);if(f!==void 0){f=f;var g=f[0],h=g[2],i=g[1];g=a.get(g[0]);if(g==null)return 0;else{g=g[1];if(g.length>=(i+h|0)){b("bs_curry")._2(Ra,d,e);return b("bs_curry")._1(f[1],Oa(!0,c,g.slice(i,i+h|0)))}else return 0}}else return 0});return 0}function Sa(d,c,e){__p&&__p();var a=e[1],f=e[0];b("MessengerMessage.bs").finalizeRanges(a);var g=a.offline_threading_id;if(!(g==null)&&g!==a.message_id){d[10].set(g,a.message_id);b("MercuryMessageIDs.bs").addServerID(g,a.message_id);g=a.threading_id;g==null||b("MercuryMessageIDs.bs").addServerID(g,a.message_id)}g=d[9].has(f);var h=d[0],i=d[1],j=d[2],k=d[3],l=d[4],m=d[5],aa=d[6],ba=d[7],ca=d[8],da=d[9].set(f,a),n=d[10],o=d[11],p=d[12],q=d[13],ea=d[14],fa=d[15],ga=d[16],ha=d[17];d=d[18];h=[h,i,j,k,l,m,aa,ba,ca,da,n,o,p,q,ea,fa,ga,ha,d];if(!g&&e[2]===1){i=b("MercuryIDs").isLocalThread(a.thread_id);j=b("bs_belt_Option").getWithDefault(b("bs_belt_Option").flatMap(b("bs_caml_option").nullable_to_opt(a.thread_id),function(a){return b("bs_caml_option").nullable_to_opt(fa.get(a))}),[i?1:0,[]]);k=a.thread_id;if(!(k==null)){l=Pa(h,[f].concat(j[1].filter(function(c){return b("bs_caml_obj").caml_notequal(c,a.offline_threading_id)})));fa.set(k,[j[0],l])}y(h,c[3][0])}return h}function Ta(b,c,a){b[11].set(c,a);return[b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12],b[13],b[14],b[15],b[16],b[17],b[18]]}function Ua(a,c){var d=c[1];c=c[0];var e=a[11].get(c);b("bs_belt_Option").isSome(e==null?void 0:b("bs_caml_option").some(e))||g(0,1777);a[11]["delete"](c);if(e==null)return b("bs_pervasives").failwith("Message must exist to update");else return Object.assign(e,{image_ids:d.image_ids,file_ids:d.file_ids,audio_ids:d.audio_ids,gif_ids:d.gif_ids,video_ids:d.video_ids,client_state:b("MercuryMessageClientState").SEND_TO_SERVER})}function Va(a,c){__p&&__p();var d=c[0],e=a[15].get(d);if(e==null)return a;else{var f=b("bs_belt_Array").keepMap(c[1],function(b){return Na(a,b)}).map(function(a){return a.message_id}),g=Pa(a,e[1].filter(function(a){return f.indexOf(a)===-1}));a[15].set(d,[e[0],g]);Ja(a[0],d,b("bs_js_null_undefined").fromOption(c[2]));return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15],a[16],a[17],a[18]]}}function Wa(c,d){__p&&__p();var e={snippet:"...",snippet_attachments:null,snippet_sender:null};d=b("bs_belt_Option").flatMap(b("bs_caml_option").nullable_to_opt(c[15].get(d)),function(a){return b("bs_belt_Array").get(Oa(void 0,c,a[1]),0)});if(d!==void 0){var a=b("bs_caml_option").valFromOption(d);a=a.is_filtered_content?b("MercuryDisplayTimeFilterMessageRenderer").renderFilteredContent(a):a.body}else a=null;if(d!==void 0){d=b("bs_caml_option").valFromOption(d);var f=d.removed_timestamp;if(f==null)if(a==null)return e;else{f=d.log_message_type;return{snippet:a,snippet_attachments:d.attachments,snippet_sender:f==null?d.author:null}}else return{snippet:b("RemovedMessageTombstoneContent").getTombstoneContentForSnippet(d.author),snippet_attachments:null,snippet_sender:null}}else return e}function Xa(c,a){__p&&__p();var d=a.attachments;if(d==null)return 0;else{var e=b("bs_belt_Array").keepMap(d,function(a){if(b("MercuryAttachment").isPhotoAttachment(a)&&b("MercuryAttachment").isVideoAttachment(a)){a=a.metadata;if(a==null)return;else return b("bs_caml_option").nullable_to_opt(a.fbid)}});b("MessengerSharedMediaActionsLoader").deletePhotos(b("MercuryIDs").getThreadFBIDFromThreadID(a.thread_id),e);if(c!==void 0)return b("MessengerSharedPhotosVideosBaseData.bs").localRemove(b("bs_caml_option").valFromOption(c),b("bs_belt_Array").keepMap(d,function(a){if(b("MercuryAttachment").isPhotoAttachment(a)||b("MercuryAttachment").isVideoAttachment(a)){a=a.metadata;if(a==null)return;else return b("bs_caml_option").nullable_to_opt(a.fbid)}}));else return 0}}function Ya(a,c,d){__p&&__p();d=a[15].get(d);if(d==null)return a;else{d=d[1];var e=[!0];return b("bs_belt_Array").reduce(d,a,function(a,d){__p&&__p();if(e[0]){var f=a[10].get(d);f=b("bs_belt_Option").getWithDefault(f==null?void 0:b("bs_caml_option").some(f),d);if(f===c){e[0]=!1;return a}else{d=Na(a,f);if(d!==void 0){d=b("bs_caml_option").valFromOption(d);var g=d.replied_to_message,h;if(g==null)h=void 0;else{g=g.message;if(g==null)h=void 0;else{var i=a[10].get(g.message_id);h=b("bs_belt_Option").getWithDefault(i==null?void 0:b("bs_caml_option").some(i),g.message_id)}}if(h!==void 0&&h===c){i={status:b("RepliedToMessageStatusForGraphQL").DELETED,message:null};g=Object.assign(Object.assign({},d),{replied_to_message:i});return Qa(a,[f,g])}else return a}else return a}}else return a})}}function Za(a,c){__p&&__p();if(!(a==null)&&a.length!==0){a=a;var d=c;c=b("bs_array").map(function(a){var c=a.type;if(b("bs_caml_obj").caml_equal(c,b("MessageProfileRangeType").THREAD_ACTIVE)||b("bs_caml_obj").caml_equal(c,b("MessageProfileRangeType").THREAD))return b("gkx")("678578");else{c=a.id;if(c==null)return!1;else return b("bs_caml_obj").caml_equal(b("FBID.bs").ofStringExn(c),d)}},a);return b("bs_array").fold_left(function(a,b){if(a)return!0;else return b},!1,c)}else return!1}function $a(d,c,e,f){__p&&__p();var g=e.client_message_id,h;if(g==null)h=d;else{var i=Na(d,g);if(i!==void 0){i=b("bs_caml_option").valFromOption(i);var j=e.message_id,k=e.status;if(b("bs_caml_obj").caml_equal(i.status,b("MercuryActionStatus").SUCCESS))h=d;else if(d[9].has(j)){var a=Object.assign(Object.assign({},i),e);Ia(d[0],a.thread_id,a.message_id,f);h=Qa(d,[j,a])}else{a=b("bs_caml_obj").caml_equal(e.status,b("MercuryActionStatus").SUCCESS);a=a?e.error_data:null;b("MercuryMessageIDs.bs").addServerID(g,j);d[10].set(g,j);i=Object.assign(Object.assign({},i),{status:k,error_data:a,timestamp:e.timestamp,log_message_data:e.log_message_data,ranges:e.ranges,attachments:e.attachments,is_one_way_sent:e.is_one_way_sent,is_forwarded:e.is_forwarded});b("MessengerMessage.bs").finalizeRanges(i);k=Qa(d,[j,i]);k[9].set(g,{});k[9]["delete"](g);a=i.thread_id;var l=k[15].get(a);if(!(l==null)){var m=Pa(k,l[1]);k[15].set(a,[l[0],m])}Ia(k[0],i.thread_id,i.message_id,f);a=b("MessengerMessage.bs").isTitanMessage(i);l=c[2].get(i.thread_id);a&&(l==null||c[2].set(i.thread_id,l-1|0));h=[k[0],k[1],k[2],k[3],k[4],k[5],k[6],k[7],k[8],k[9],k[10].set(g,j),k[11],k[12],k[13],k[14],k[15],k[16],k[17],k[18]]}}else h=d}m={};f=e.log_message_type;if(f==null)Object.assign(m,{snippet_attachments:e.attachments});else{if(b("bs_caml_obj").caml_equal(f,b("MercuryLogMessageType").THREAD_IMAGE)){a=e.log_message_data;if(a==null)c=null;else{i=a.image;c=i==null?null:i.preview_url}Object.assign(m,{image_src:c});s(h[0],e.thread_id)}b("bs_caml_obj").caml_notequal(f,b("MercuryLogMessageType").SUBSCRIBE)&&b("bs_caml_obj").caml_notequal(f,b("MercuryLogMessageType").UNSUBSCRIBE)&&Object.assign(m,{snippet_attachments:e.attachments})}return t(void 0,h,e.thread_id,m)}function ab(c,a,d,e){__p&&__p();if(b("bs_caml_obj").caml_equal(d.action_type,b("MercuryActionType").SEND_MESSAGE))return $a(c,a,d,e);else{var f=d.offline_threading_id;f=b("bs_belt_Option").flatMap(f==null?void 0:b("bs_caml_option").some(f),function(a){return b("bs_caml_option").nullable_to_opt(c[10].get(a))});var g=Na(c,d.message_id);if(f!==void 0)if(g!==void 0){f=b("bs_caml_option").valFromOption(g);if(b("bs_caml_option").nullable_to_opt(f.sticker_id)!==void 0){var h=Object.assign(f,{attachments:d.attachments});return Qa(c,[f.message_id,h])}else return c}else return c;else if(g!==void 0)return c;else{f=b("bs_caml_obj").caml_equal(e,b("bs_caml_option").some(b("MercuryPayloadSource").CLIENT_SEND_MESSAGE))?x(c,d):c;h=b("bs_caml_obj").caml_equal(d.client_state,b("MercuryMessageClientState").DO_NOT_SEND_TO_SERVER);g=d.upload_id;e=h&&!(g==null)?Ta(f,g,d):f;h=b("MessengerMessage.bs").isErrorLogMessage(d);g=d.thread_id;h&&(g==null||(a[6][0][g]=!0));f=d.manual_retry_cnt;h=d.thread_id;f==null||!(h==null)&&f>0&&Ja(e[0],h,b("MercuryPayloadSource").CLIENT_SEND_MESSAGE);g=Sa(e,a,[d.message_id,d,1]);w(g[0],d);return g}}}function bb(a,c,d,e){__p&&__p();if(c!==void 0){c=b("bs_caml_obj").caml_equal(b("bs_caml_option").valFromOption(c),b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE);var f=d.thread_id;if(c&&!(f==null)){c=b("MercuryThreadInformer").getForFBID(a);return b("bs_curry")._3(e,c,f,d)}else return 0}else return 0}function cb(a,b){var c=a.participants.indexOf(b);if(c>0){Object.assign(a,{participants:[b].concat(a.participants.slice(0,c),a.participants.slice(c+1|0))});return 0}else return 0}function db(a,c,d,e){__p&&__p();var f=c.thread_id;if(f==null)return a;else{var g=b("bs_belt_Map").get(a[7],f);if(g!==void 0){g=b("bs_caml_option").valFromOption(g);var h={};if(!c.skip_bump_thread&&b("bs_caml_obj").caml_notequal(d,b("bs_caml_option").some(b("MercuryPayloadSource").SERVER_FETCH_THREAD_INFO))){u(h,c,b("bs_caml_option").nullable_to_opt(c.log_message_body));if(c.timestamp>g.timestamp){Object.assign(h,{timestamp:c.timestamp});if(c.is_unread){Object.assign(h,{unread_count:g.unread_count+1|0});d=Za(c.profile_ranges,a[0]);d&&Object.assign(h,{unread_mentions_count:g.unread_mentions_count+1|0})}}Object.assign(h,{message_count:g.message_count+1|0,is_archived:!1})}e!==!0&&(c.timestamp>h.server_timestamp&&Object.assign(h,{server_timestamp:c.timestamp}));if(b("bs_caml_obj").caml_notequal(h,{}))return t(void 0,a,f,h);else return a}else return a}}function eb(b,a,c){var d=new Set(c);Object.assign(a,{participants:a.participants.filter(function(a){return!d.has(a)})});if(d.has(b)){Object.assign(a,{can_reply:!1,is_subscribed:!1});return 0}else return 0}function fb(c,a,d){a=a.specific_to_list;if(a==null){d=b("MercuryIDs").tokenize(d);if(d.type!=="user"||d.value.length===0)return[c];else return[b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(d.value)),c]}else return a}function gb(c,a,d){var e=b("MercuryIDs").tokenize(d),f=e.type==="user",g=a.specific_to_list;g=f?!0:g==null?!1:b("MessengerThreadUtils.bs").isCanonicalFromInitialParticipants(c,g);if(g||f)c=fb(c,a,d);else{var h=a.specific_to_list;c=h==null?[]:h}return new(b("ImmutableObject"))({admins:{},admin_model_status:null,approval_mode:0,approval_queue_ids:[],associated_object:null,can_reply:!0,cannot_reply_reason:null,can_viewer_report:!1,comm_item_owners:null,comm_source_id:null,comm_status:null,comm_icon_type:[],custom_like_icon:null,custom_nickname:null,customization_enabled:!1,description:null,ephemeral_ttl_mode:0,footer_color:null,game_id:null,gradient_colors:[],group_approval_queue:null,group_thread_subtype:null,work_associated_group:null,pinned_messages:null,groups_sync_status:null,has_email_participant:!1,has_montage:!1,unread_mentions_count:0,header_color:null,is_canonical_neo_user:!1,is_from_weak_entry_point:!1,is_pin_protected:!1,is_pinned:!1,is_thread_queue_enabled:!1,joinable_mode:{link:"",mode:0},last_message_timestamp:0,last_message_type:null,last_message_id:null,last_read_timestamp:0,lightweight_event:null,lightweight_events:{},marketplace_thread_data:null,mentions_mute_mode:0,mute_until:null,page_comm_item_id:null,page_thread_info:null,page_unsubscribe_status:!1,participant_add_mode:null,participants_event_status:null,reactions_mute_mode:0,read_only:!1,recipients_loadable:!0,rtc_call_data:null,server_timestamp:0,solid_color:null,subtitle:null,theme_id:null,thread_associated_job_applications:null,thread_associated_page_admin:null,thread_connectivity_data:null,thread_fbid:null,thread_type:null,thread_pin_timestamp:null,thread_id:d,participants:c,name:"",snippet:a.body,snippet_attachments:[],snippet_sender:a.author,unread_count:0,message_count:0,image_src:null,timestamp:a.timestamp,other_user_fbid:f?b("FBID.bs").ofStringExn(e.value):null,is_canonical_user:f,is_canonical:g,is_subscribed:!0,folder:b("MessagingTag").INBOX,is_archived:!1,is_page_follow_up:!1,is_page_unresponded_thread:!1,object_association_type:null,joinable_link:null,linked_mentorship_programs:null,thread_unsendability_status:null,is_business_page_active:!1,graphql_token:null})}function hb(c,d,a,e){__p&&__p();e=b("MessengerMessage.bs").hasServerTimestamp(a,e);var f=a.thread_id;if(f==null)return;else{b("MercuryAssert").isThreadID(f);d=b("bs_belt_Map").get(d,f);if(d!==void 0)return b("bs_caml_option").some(b("bs_caml_option").valFromOption(d));else if(b("bs_caml_obj").caml_equal(a.action_type,b("MercuryActionType").USER_GENERATED_MESSAGE)&&!e)return b("bs_caml_option").some(gb(b("MercuryIDs").getParticipantIDFromUserID(c),a,f));else return}}function ib(a,c){__p&&__p();var d=c.other_user_fbid;if(d==null){var e=c.thread_fbid;e=e==null?void 0:b("bs_caml_option").some(b("MercuryIDs").getThreadIDFromThreadFBID(e))}else e=b("bs_caml_option").some(b("MercuryIDs").getThreadIDFromUserID(d));d=c.thread_id;e=d==null?e:d==null?void 0:b("bs_caml_option").some(d);d=c.thread_id;var f;if(d==null)f="";else{d=b("bs_belt_Map").get(a[7],d);f=d!==void 0?b("MessengerFolders.bs").getFromMeta(b("bs_caml_option").valFromOption(d)):c.folder}xa.includes(f)&&((b("bs_caml_obj").caml_equal(c.action_type,b("MercuryActionType").USER_GENERATED_MESSAGE)||b("bs_caml_obj").caml_equal(c.action_type,b("MercuryActionType").LOG_MESSAGE))&&c.is_unread&&wa(a,f,e));return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15],a[16],a[17],a[18]]}var jb=function(a,b){delete a[b];return 0};function kb(a,c){__p&&__p();Object.keys(c).forEach(function(d){__p&&__p();var e=b("bs_js_dict").get(c,d);if(e!==void 0){e=e;var f=e[0],g=i(f.reduce(function(d,e){var c=b("bs_belt_Map").get(a,e);if(c!==void 0)return b("bs_belt_Map").set(d,e,b("bs_caml_option").valFromOption(c));else return d},b("bs_belt_Map").make(b("ThreadId.bs"))));if(Object.keys(g).length===f.length){b("bs_curry")._2(jb,c,d);return b("bs_curry")._1(e[1],g)}else return 0}else return 0});return 0}function lb(c,a,d,e,f){__p&&__p();d!==0&&ra(c,a.thread_id,f,d);if(a.timestamp===0){b("ChatReliabilityInstrumentation").logERROR("thread timestamp is 0");e.add(a.thread_id);return}else{d=a.unread_count===0;if(d===f)return;else{s(c,a.thread_id);return{unread_count:f?0:1,unread_mentions_count:0}}}}function mb(a){var c=[b("MercuryFilters.bs").all];a.unread_count>0&&c.push(b("MercuryFilters.bs").unread);a.is_canonical||c.push(b("MercuryFilters.bs").groups);return c}function z(c,a){var d;if(a.is_archived)d=b("MessagingTag").ACTION_ARCHIVED;else{var e=a.thread_type;d=e==null||e!==b("MessagingThreadType").MARKETPLACE?a.folder:b("MessagingTag").MARKETPLACE_FOLDER}e=b("bs_js_dict").get(c[12],d);if(e!==void 0)return d}function nb(a,c){__p&&__p();var d={};na.forEach(function(a){var b={};ma.forEach(function(a){b[a]=[];return 0});d[a]=b;return 0});c.forEach(function(c){__p&&__p();var e=b("bs_belt_Map").get(a[7],c.thread_id);if(e!==void 0){var f=b("bs_caml_option").valFromOption(e);e=z(a,f);if(e!==void 0){var g=e;mb(f).forEach(function(a){if(f.timestamp!==0){d[g][a].push(c.thread_id);return 0}else return 0});return 0}else return 0}else return 0});na.forEach(function(b){ma.forEach(function(c){var e=d[b][c];va(a,e,b,c);return 0});return 0});return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15],a[16],a[17],a[18]]}function ob(a){__p&&__p();b("bs_belt_Map").map(a[7],function(c){__p&&__p();c=b("bs_belt_Map").get(a[7],c.thread_id);if(c!==void 0){c=b("bs_caml_option").valFromOption(c);if(b("bs_caml_option").nullable_to_opt(c.thread_type)===b("MessagingThreadType").MARKETPLACE){c=b("ImmutableObject").set(c,{folder:"marketplace_folder"});nb(a,[c]);return 0}else return 0}else return 0});return 0}function pb(c,a,d){__p&&__p();var e=function(a){return a.timestamp>(d?b("bs_caml_primitive").caml_float_max(c[18],a.last_read_timestamp):c[18])},f=function(a){var d;return(d=b("bs_belt_Option")).mapWithDefault(d.flatMap(d.map(d.map(b("bs_caml_option").nullable_to_opt(c[15].get(a.thread_id)),function(a){return b("bs_caml_array").caml_array_get(a[1],0)}),function(a){return b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(c[10].get(a)),a)}),function(a){return b("bs_caml_option").nullable_to_opt(c[9].get(a))}),!1,function(a){return a.author===b("MercuryIDs").getParticipantIDFromUserID(c[0])})},g=function(a,c){if(e(a)&&!b("MercuryThreadInfo").isMuted(a)&&!f(a))return c+1|0;else return c};return b("bs_belt_Option").getWithDefault(b("bs_belt_Option").map(b("bs_belt_Option").flatMap(b("bs_js_dict").get(c[12],b("MessagingTag").INBOX),function(a){return b("bs_js_dict").get(a,b("MercuryFilters.bs").all)}),function(d){__p&&__p();d=d.threadlist;if(d.length!==0)return d.reduce(function(a,d){d=b("bs_belt_Map").get(c[7],d);if(d!==void 0)return g(b("bs_caml_option").valFromOption(d),a);else return a},0);else if(b("bs_belt_Map").isEmpty(c[7]))return a[7][0];else return b("bs_belt_Map").reduce(c[7],0,function(d,e,a){e=z(c,a);if(e!==void 0&&e===b("MessagingTag").INBOX)return g(a,d);else return d})}),a[7][0])}function A(c,a){__p&&__p();return b("bs_belt_Option").getWithDefault(b("bs_belt_Option").map(b("bs_belt_Option").flatMap(b("bs_js_dict").get(c[12],b("MessagingTag").INBOX),function(a){return b("bs_js_dict").get(a,b("MercuryFilters.bs").all)}),function(d){__p&&__p();if(d.threadlist.length===0)if(b("bs_belt_Map").isEmpty(c[7]))return a[7][0];else return b("bs_belt_Map").reduce(c[7],0,function(d,e,a){__p&&__p();var f=z(c,a);if(f!==void 0&&f===b("MessagingTag").INBOX&&a.timestamp>c[18]&&!b("MercuryThreadInfo").isMuted(a)){f=b("bs_js_dict").get(c[16],b("MessagingTag").INBOX);if(f!==void 0){a=b("bs_caml_option").valFromOption(f).has(e);if(a)return d+1|0;else return d}else return d}else return d});else return d.threadlist.reduce(function(a,d){__p&&__p();var e=b("bs_belt_Map").get(c[7],d);if(e!==void 0){e=b("bs_caml_option").valFromOption(e);if(e.timestamp>c[18]&&!b("MercuryThreadInfo").isMuted(e)){e=b("bs_js_dict").get(c[16],b("MessagingTag").INBOX);if(e!==void 0){e=b("bs_caml_option").valFromOption(e).has(d);if(e)return a+1|0;else return a}else return a}else return a}else return a},0)}),a[7][0])}function qb(c,a,d){if(d===b("MessagingTag").PENDING)return[c[0],c[1],c[2],c[3],c[4],0,c[6],c[7],c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15],c[16],c[17],c[18]];else{if(b("gkx")("969964")){d=b("MercuryThreadInformer").getForFBID(c[0]);d.updatedUnseenTimestamp()}return[c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15],c[16],c[17],a]}}function B(a){var c=[b("MercurySyncEventsProxy").getArbiterTypeForFBID(a,"TYP")];b("FBIDCheck").isUser_deprecated(a)||c.push(b("ChannelConstants").getArbiterType("page_typing"));return c}function C(a){return[a,b("bs_belt_MapString").empty,b("bs_belt_MapString").empty,b("bs_belt_Set").make(b("ParticipantId.bs")),b("bs_belt_Set").make(b("ParticipantId.bs")),0,b("bs_belt_MapString").empty,b("bs_belt_Map").make(b("ThreadId.bs")),new Set(),new Map(),new Map(),new Map(),oa(0),[],{},new Map(),{},{},0]}var rb=[{}],sb=[0],tb=new Map(),D=[{}],E=[0],F=new Set(),G=[{}],H=[0],ub=[rb,sb,tb,D,E,F,G,H];function I(a,c){__p&&__p();var d=ub;a=a;c=c;var e=[];c=b("bs_array").fold_left(function(f,g){__p&&__p();switch(g.tag|0){case 0:e.push(g[0].tag|0);break;case 1:case 2:break}switch(g.tag|0){case 0:var k=g[0];if(typeof k==="number"){var l=f,m=d;m[0][0]={};m[1][0]=m[1][0];m[6][0]={};m[2].clear();b("bs_belt_Map").keysToArray(l[7]).forEach(function(a){return pa(l[0],a)});return[l[0],l[1],b("bs_belt_MapString").empty,l[3],l[4],l[5],l[6],b("bs_belt_Map").make(b("ThreadId.bs")),new Set(),new Map(),new Map(),l[11],oa(0),l[13],l[14],new Map(),l[16],l[17],l[18]]}else switch(k.tag|0){case 0:m=f;var ba=k[0],ca=[!1],da=[m[1]];Object.keys(ba).forEach(function(a){var c=ba[a],d=b("bs_belt_Option").getWithDefault(b("bs_belt_MapString").get(da[0],a),0);if(c>d){ca[0]=!0;da[0]=b("bs_belt_MapString").set(da[0],a,c);return 0}else return 0});if(ca[0])return[m[0],da[0],m[2],m[3],m[4],m[5],m[6],m[7],m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15],m[16],m[17],m[18]];else return m;case 1:return ia(f,k[0],[]);case 2:m=f;var n=k[0],o=k[1];o=o.reduce(b("bs_belt_Set").remove,n.reduce(b("bs_belt_Set").add,m[4]));if(o===m[4])return m;else return[m[0],m[1],m[2],m[3],o,m[5],m[6],m[7],m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15],m[16],m[17],m[18]];case 3:n=f;o=k[0];m=o.reduce(function(c,d){var a=d.is_messenger_ignored;if(a==null)return c;else if(a)return b("bs_belt_Set").add(c,b("MercuryIDs").getParticipantIDFromUserID(d.fbid));else return b("bs_belt_Set").remove(c,b("MercuryIDs").getParticipantIDFromUserID(d.fbid))},n[3]);if(m===n[3])return n;else return[n[0],n[1],n[2],m,n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15],n[16],n[17],n[18]];case 4:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("SetInitialPendingFolderUnseenCount");o=f;m=k[0];return[o[0],o[1],o[2],o[3],o[4],m,o[6],o[7],o[8],o[9],o[10],o[11],o[12],o[13],o[14],o[15],o[16],o[17],o[18]];case 5:n=f;m=k[0];o=la(n[0],m);if(o==null)return n;else{var p=b("FBID.bs").ofString(m.from.toString());if(p!==void 0){b("MessengerPersonas.bs").addPersona(m.persona);var q=m.persona;p=q==null?b("MercuryIDs").getParticipantIDFromUserID(b("bs_caml_option").valFromOption(p)):b("MercuryIDs").getParticipantIDFromUserID(q.id);if(m.st===b("TypingStates").TYPING){q=b("bs_belt_MapString").get(n[6],o);if(q!==void 0)return[n[0],n[1],n[2],n[3],n[4],n[5],b("bs_belt_MapString").set(n[6],o,b("bs_belt_Map").set(b("bs_caml_option").valFromOption(q),p,Date.now())),n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15],n[16],n[17],n[18]];else{q=b("bs_belt_Map").set(b("bs_belt_Map").make(b("ParticipantId.bs")),p,Date.now());return[n[0],n[1],n[2],n[3],n[4],n[5],b("bs_belt_MapString").set(n[6],o,q),n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15],n[16],n[17],n[18]]}}else if(m.st===b("TypingStates").INACTIVE){q=ka(n[6],o,p);if(q!==n[6])return[n[0],n[1],n[2],n[3],n[4],n[5],q,n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15],n[16],n[17],n[18]];else return n}else return n}else return n}case 6:m=f;var ea=k[0],fa=[!1],ga=[m[2]];Object.keys(ea).forEach(function(c){__p&&__p();Object.keys(ea[c]).forEach(function(d){var a=b("bs_belt_MapString").get(ga[0],c);a=a!==void 0?b("bs_caml_option").valFromOption(a):b("immutable").OrderedMap();var e=a.get(d),f=ea[c][d];if(!(e==null)&&f.watermark<=e.watermark)return 0;fa[0]=!0;ga[0]=b("bs_belt_MapString").set(ga[0],c,a.set(d,f));return 0});var a=b("bs_belt_MapString").get(ga[0],c);if(a!==void 0){fa[0]=!0;ga[0]=b("bs_belt_MapString").set(ga[0],c,b("bs_caml_option").valFromOption(a).sort(function(a,c){return b("bs_caml_primitive").caml_float_compare(a.watermark,c.watermark)}));return 0}else return 0});if(fa[0])return[m[0],m[1],ga[0],m[3],m[4],m[5],m[6],m[7],m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15],m[16],m[17],m[18]];else return m;case 7:var r=f;o=d;p=k[0];if(p.length!==0){q=r[7];n=p.reduce(function(c,a){return b("bs_belt_Map").set(c,a.thread_id,new(b("ImmutableObject"))(a))},q);kb(n,o[0][0]);p.forEach(function(a){return s(r[0],a.thread_id)});return[r[0],r[1],r[2],r[3],r[4],r[5],r[6],n,r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15],r[16],r[17],r[18]]}else return r;case 8:m=f;q=k[0];if(q.length!==0){var ra=m[8],sa=b("MercuryServerRequests").getForFBID(m[0]);q.forEach(function(a){__p&&__p();var b=a.thread_id;if(ra.has(b)){ra["delete"](b);if(a.unread_count>0){sa.changeThreadReadStatus(b,!0,null,null,null,null);return 0}else return 0}else return 0});return[m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],ra,m[9],m[10],m[11],m[12],m[13],m[14],m[15],m[16],m[17],m[18]]}else return m;case 9:var u=f,Ca=k[0];b("qex")._("998180")&&b("MessengerEnvironment").messengerdotcom&&ob(u);na.forEach(function(a){__p&&__p();ma.forEach(function(d){__p&&__p();var c=u,e=Ca,f=a,g=d,h=[];d=e.filter(function(c){var a=c.filter;a=a==null?b("MercuryFilters.bs").all:a;c=c.folder;c=c==null?f===b("MessagingTag").INBOX:c===f;if(c)return a===g;else return!1});var i=[!1];d.forEach(function(a){a.thread_ids.forEach(function(a){h.push(a);return 0});var b=a.limit;if(a.thread_ids.length<b){i[0]=!0;return 0}else return 0});e=va(c,h,f,g);d=c[12][f];c=b("bs_js_dict").get(d,g);c=c!==void 0?b("bs_caml_option").valFromOption(c).reachedEnd:!1;d[g]={reachedEnd:i[0]?i[0]:c,threadlist:e[0],existingIDs:e[1]};return 0});return 0});return[u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],u[8],u[9],u[10],u[11],u[12],u[13],u[14],u[15],u[16],u[17],u[18]];case 10:return nb(f,k[0]);case 11:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdatePinnedThreads");var v=f,Da=d;o=k[0];if(o.length!==0){o.forEach(function(a){if(Da[5].has(a))return 0;else{v[13].push(a);Da[5].add(a);return 0}});p=b("MercuryThreadInformer").getForFBID(v[0]);p.updatedThreadlist();return[v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],v[8],v[9],v[10],v[11],v[12],v[13],v[14],v[15],v[16],v[17],v[18]]}else return v;case 12:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UnSubscribeStatusUpdate");n=f;q=k[0];var Ea=k[1];return t(function(a){return a.page_unsubscribe_status!==Ea},n,q,{page_unsubscribe_status:Ea});case 13:m=f;o=k[0];p=k[1];n=k[2];return t(void 0,m,o,{can_reply:p,cannot_reply_reason:n});case 14:q=f;m=k[0];o=k[1];p=b("bs_belt_Map").get(q[7],m);if(p!==void 0){n=Object.assign({},b("bs_caml_option").valFromOption(p));ua(b("MercuryIDs").getParticipantIDFromUserID(q[0]),n,o);return t(void 0,q,m,n)}else return q;case 15:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangeFlag");p=f;o=k[0];m=k[1];n=b("bs_belt_Map").get(p[7],o);if(n!==void 0){q=b("bs_caml_option").valFromOption(n);n=q.page_thread_info;q=b("ImmutableObject").set(q,{page_thread_info:Object.assign(n==null?{}:n,{flagged:m})});n=b("bs_belt_Map").set(p[7],o,q);s(p[0],o);return[p[0],p[1],p[2],p[3],p[4],p[5],p[6],n,p[8],p[9],p[10],p[11],p[12],p[13],p[14],p[15],p[16],p[17],p[18]]}else return p;case 16:m=f;q=k[0];return t(function(a){return b("MessageRequestUtils").isMessageRequest(a)},m,q,{folder:b("MessagingTag").INBOX});case 17:o=f;n=k[0];p=k[1];return t(void 0,o,n,{custom_like_icon:p});case 18:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("PromoteGroupAdmins");m=f;q=k[0];o=k[1];n=b("bs_belt_Map").get(m[7],q);if(n!==void 0){p=b("bs_caml_option").valFromOption(n);n=b("bs_js_dict").fromArray(b("bs_js_dict").entries(p.admins));p=b("ImmutableObject").set(p,{admins:b("bs_array").fold_left(function(a,b){a[b.admin_fbid]=b.admin_type;return a},n,o)});n=b("bs_belt_Map").set(m[7],q,p);s(m[0],q);return[m[0],m[1],m[2],m[3],m[4],m[5],m[6],n,m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15],m[16],m[17],m[18]]}else return m;case 19:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("RemoveGroupAdmins");o=f;p=k[0];q=k[1];n=b("bs_belt_Map").get(o[7],p);if(n!==void 0){m=b("bs_caml_option").valFromOption(n);n=b("bs_js_dict").fromArray(b("bs_js_dict").entries(m.admins));m=b("ImmutableObject").set(m,{admins:b("bs_array").fold_left(function(d,c){var a=b("bs_js_dict").get(d,c);a!==void 0&&b("bs_curry")._2(ja,d,c);return d},n,q)});n=b("bs_belt_Map").set(o[7],p,m);s(o[0],p);return[o[0],o[1],o[2],o[3],o[4],o[5],o[6],n,o[8],o[9],o[10],o[11],o[12],o[13],o[14],o[15],o[16],o[17],o[18]]}else return o;case 20:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("JoinableMode");q=f;m=k[0];p=k[1];return t(void 0,q,m,{joinable_mode:p});case 21:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ApprovalMode");n=f;o=k[0];q=k[1];return t(void 0,n,o,{approval_mode:q});case 22:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ApprovalQueue");m=f;p=k[0];n=k[1];o=k[2];var Fa=k[3],Ga=k[4];q=b("bs_belt_Map").get(m[7],p);if(q!==void 0){q=b("bs_caml_option").valFromOption(q);var w=q.group_approval_queue;q={approval_queue_ids:q.approval_queue_ids.slice(),group_approval_queue:w==null?null:w.slice()};n==null||q.approval_queue_ids.indexOf(n)===-1&&Object.assign(q,{approval_queue_ids:q.approval_queue_ids.concat([n])});if(!(o==null)){w=q.group_approval_queue;w==null?Object.assign(q,{group_approval_queue:[o]}):w.map(function(a){return a.requester.id}).indexOf(o.requester.id)===-1&&Object.assign(q,{group_approval_queue:w.concat([o])})}Fa==null||Object.assign(q,{approval_queue_ids:q.approval_queue_ids.filter(function(a){return b("bs_caml_obj").caml_notequal(a,Fa)})});if(!(Ga==null)){n=q.group_approval_queue;Object.assign(q,{group_approval_queue:(n==null?[]:n).filter(function(a){return a.requester.id!==Ga})})}return t(void 0,m,p,q)}else return m;case 23:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("IsPinProtected");w=f;o=k[0];n=k[1];return t(void 0,w,o,{is_pin_protected:n});case 24:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateRtcCallData");p=f;q=k[0];m=k[1];w=k[2];o=k[3];n=b("bs_belt_Map").get(p[7],q);if(n!==void 0){if(m==null){n=b("bs_caml_option").valFromOption(n).rtc_call_data;n=n==null?void 0:m}else n=m;return t(void 0,p,q,{rtc_call_data:new(b("ImmutableObject"))({call_state:w,server_info_data:o,initiator_fbid:n})})}else return p;case 25:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateCommStatus");m=f;q=k[0];w=k[1];return t(void 0,m,q,{comm_status:w});case 26:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateCommItemOwner");o=f;n=k[0];p=k[1];m=k[2];q=k[3];w=p==null?{nodes:[]}:{nodes:[{admin:{id:p,name:m,profile_picture:{uri:q}}}]};return t(void 0,o,n,{comm_item_owners:w});case 27:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("EventRsvpChanged");p=f;m=k[0];var Oa=k[1];q=k[2];o=b("bs_belt_Map").get(p[7],m);if(o!==void 0){n=b("bs_caml_option").valFromOption(o).participants_event_status;w=(n==null?[]:n).filter(function(a){return b("bs_caml_obj").caml_notequal(a.participant_id,Oa)});w.push({participant_id:Oa,event_status:q});return t(void 0,p,m,{participants_event_status:w})}else return p;case 28:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("GroupsSyncStatusChanged");o=f;n=k[0];q=k[1];m=k[2];return!(m==null)&&b("bs_caml_obj").caml_equal(m,b("MessengerGroupsSyncStatus").OPT_IN)?t(void 0,o,n,{groups_sync_status:q}):t(void 0,o,n,{groups_sync_status:q,work_associated_group:null});case 29:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("GroupsSyncMetadataUpdate");w=f;p=k[0];m=k[1];o=k[2];if(m==null)return t(void 0,w,p,{work_associated_group:null});else if(b("bs_caml_obj").caml_equal(m,b("MessengerGroupsSyncStatus").OPT_IN)){n=new(h||(h=b("URI")))(document.URL);q=n.getDomain();m=b("XGroupsController").getURIBuilder().setString("idorvanity",o).getURI().setDomain(q==null?"":q.replace("messenger.com","facebook.com")).setPort(n.getPort()).setProtocol("https");return t(void 0,w,p,{work_associated_group:{id:o,url:m.toString(),group_saves:{count:0},group_events:{count:0}}})}else return t(void 0,w,p,{work_associated_group:null});case 30:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("DescriptionChanged");q=f;n=k[0];o=k[1];return t(void 0,q,n,{description:o});case 31:m=f;w=k[0];p=k[1];return t(void 0,m,w,{solid_color:p.solid_color,header_color:p.header_color,footer_color:p.footer_color,gradient_colors:p.gradient_colors,theme_id:p.theme_id});case 32:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateJoinableLink");q=f;n=k[0];o=k[1];return t(void 0,q,n,{joinable_link:o});case 33:var x=f,Ra=k[0];m=b("bs_belt_Map").toArray(x[7]).reduce(function(d,c){var a=c[1];c=c[0];if(a.folder===Ra){s(x[0],c);return b("bs_belt_Map").set(d,c,b("ImmutableObject").set(a,{unread_count:0,unread_mentions_count:0}))}else return d},x[7]);x[16][Ra]=new Set();w=b("MercuryThreadInformer").getForFBID(x[0]);w.updatedUnreadState();return[x[0],x[1],x[2],x[3],x[4],x[5],x[6],m,x[8],x[9],x[10],x[11],x[12],x[13],x[14],x[15],x[16],x[17],x[18]];case 34:var y=f,Ta=k[0];b("gkx")("1143875")&&(b("ChatReliabilityInstrumentation").logDELETE_THREAD(Ta),b("LogHistory").getInstance("messenger_state").debug("delete_thread",Ta));p=b("bs_belt_Map").remove(y[7],Ta);y[15]["delete"](Ta);y[9].forEach(function(a,c,d){__p&&__p();if(b("bs_caml_obj").caml_equal(a.thread_id,Ta)){y[9]["delete"](a.message_id);c=a.offline_threading_id;if(!(c==null)){d=y[10].get(c);d==null||(y[9]["delete"](d),y[10]["delete"](c))}y[10]["delete"](a.message_id);return 0}else return 0});pa(y[0],Ta);return[y[0],y[1],y[2],y[3],y[4],y[5],y[6],p,y[8],y[9],y[10],y[11],y[12],y[13],y[14],y[15],y[16],y[17],y[18]];case 35:q=k[0];return Sa(f,d,[q.message_id,q,k[1]]);case 36:n=f;o=[k[0],k[1],k[2]];var fb=o[2];w=o[1];var gb=o[0];if(w.length!==0){m=Va(n,[gb,w,fb]);p=0;fb!==void 0&&b("bs_caml_obj").caml_equal(b("bs_caml_option").valFromOption(fb),b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE)||(p=1);p===1&&b("MercuryServerRequests").getForFBID(m[0]).deleteMessages(gb,w);return b("bs_belt_Array").reduce(w,m,function(c,e){__p&&__p();var a=Na(c,e),d=b("bs_belt_Map").get(c[7],gb);if(d!==void 0){d=b("bs_caml_option").valFromOption(d);d=b("ImmutableObject").set(b("ImmutableObject").set(d,Wa(c,gb)),{message_count:d.message_count-1|0});d=b("bs_belt_Map").set(c[7],gb,d);s(c[0],gb);d=[c[0],c[1],c[2],c[3],c[4],c[5],c[6],d,c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15],c[16],c[17],c[18]]}else d=c;if(a!==void 0){c=b("bs_caml_option").valFromOption(a);Xa(b("bs_caml_option").some(gb),c);Ka(d[0],gb,e,fb,c.attachments)}return d})}else return n;case 37:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangeFolder");return Ba(f,k[0],k[1],1);case 38:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangeMuteSettings");q=f;o=k[0];p=k[1];w=b("bs_belt_Map").get(q[7],o);if(w!==void 0){m=b("bs_caml_option").valFromOption(w);var mb;switch(p.tag|0){case 0:mb=b("ImmutableObject").set(m,{reactions_mute_mode:p[0]?1:0});break;case 1:mb=b("ImmutableObject").set(m,{mentions_mute_mode:p[0]?1:0});break;case 2:n=p[0];w=n===0;mb=b("ImmutableObject").set(m,{mute_until:w?void 0:n});break}p=b("bs_belt_Map").set(q[7],o,mb);s(q[0],o);return[q[0],q[1],q[2],q[3],q[4],q[5],q[6],p,q[8],q[9],q[10],q[11],q[12],q[13],q[14],q[15],q[16],q[17],q[18]]}else return q;case 39:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangeArchivedStatus");m=f;w=k[0];n=k[1];o=b("bs_belt_Map").get(m[7],w);if(o!==void 0){p=b("bs_caml_option").valFromOption(o);if(p.is_archived!==n){q=b("MessengerFolders.bs").getFromMeta(p);o=p.comm_status;o=o==null?b("ImmutableObject").set(p,{is_archived:n}):b("ImmutableObject").set(p,{is_archived:n,comm_status:n?b("PageCommItemStatus").DONE:b("PageCommItemStatus").TODO});p=b("bs_belt_Map").set(m[7],w,o);za(m,o,q);Aa(m,o);s(m[0],w);return[m[0],m[1],m[2],m[3],m[4],m[5],m[6],p,m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15],m[16],m[17],m[18]]}else return m}else return m;case 40:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangePageFollowUpStatus");n=f;q=k[0];o=k[1];w=b("bs_belt_Map").get(n[7],q);if(w!==void 0){p=b("bs_caml_option").valFromOption(w);if(p.is_page_follow_up!==o){m=b("ImmutableObject").set(p,{is_page_follow_up:o});w=b("bs_belt_Map").set(n[7],q,m);s(n[0],q);return[n[0],n[1],n[2],n[3],n[4],n[5],n[6],w,n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15],n[16],n[17],n[18]]}else return n}else return n;case 41:p=f;o=k[0];m=k[1];q=k[2];w=k[3];n=k[4];var z=b("bs_belt_Map").get(p[7],o);if(z!==void 0){z=b("bs_caml_option").valFromOption(z);q=lb(p[0],z,q,p[8],m);q=q!==void 0&&z.last_message_timestamp>z.last_read_timestamp?b("bs_caml_option").some(Object.assign(b("bs_caml_option").valFromOption(q),{last_read_timestamp:z.last_message_timestamp})):q;if(q!==void 0){q=b("ImmutableObject").set(z,b("bs_caml_option").valFromOption(q));var A=b("bs_belt_Map").set(p[7],o,q);if(w){w=!z.read_only&&z.folder===b("MessagingTag").INBOX;var B=b("MercuryServerRequests").getForFBID(p[0]);B.changeThreadReadStatus(q.thread_id,m,n,q.last_read_timestamp,w,q.last_message_type)}B=A}else B=p[7];n=b("MessengerFolders.bs").getFromMeta(z);m?(ta(p,[o],n,b("MercuryFilters.bs").unread),ya(p,n,b("bs_caml_option").some(o))):(va(p,[o],n,b("MercuryFilters.bs").unread),wa(p,n,b("bs_caml_option").some(o)));return[p[0],p[1],p[2],p[3],p[4],p[5],p[6],B,p[8],p[9],p[10],p[11],p[12],p[13],p[14],p[15],p[16],p[17],p[18]]}else return p;case 42:var C=f,rb=k[0];w=b("bs_belt_Option").getWithDefault(b("bs_belt_Option").map(b("bs_caml_option").nullable_to_opt(C[15].get(rb)),function(a){return[a[0],[]]}),[0,[]]);C[15].set(rb,w);q=b("bs_belt_Option").map(b("bs_belt_Map").get(C[7],rb),function(a){return b("ImmutableObject").set(a,{message_count:0})});if(q!==void 0){var sb=b("bs_caml_option").valFromOption(q);A=b("bs_belt_Map").set(C[7],rb,sb);ma.forEach(function(a){return ta(C,[rb],b("MessengerFolders.bs").getFromMeta(sb),a)});z=A}else z=C[7];xa.forEach(function(a){a=b("bs_js_dict").get(C[16],a);if(a!==void 0){b("bs_caml_option").valFromOption(a)["delete"](rb);return 0}else return 0});qa(C[0],rb);return[C[0],C[1],C[2],C[3],C[4],C[5],C[6],z,C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15],C[16],C[17],C[18]];case 43:m=f;n=d;o=[k[0],k[1],k[2]];B=Ua(m,[o[0],o[1]]);p=B.thread_id;w=Va(m,[p,[B.message_id],o[2]]);q=n[2].get(p);q==null||n[2].set(p,Math.max(0,q-1|0));return w;case 44:A=f;z=[k[0],k[1]];m=Ua(A,[z[0],z[1]]);b("MercuryServerRequests").getForFBID(A[0]).sendNewMessage(Object.assign(m,{preview_attachments:void 0}));return A;case 45:B=f;o=[k[0],k[1],k[2],k[3]];n=o[2];p=o[1];q=o[0];w=Na(B,q);if(w!==void 0){z=b("bs_caml_option").valFromOption(w);m=b("bs_js_dict").map(function(a){return a},b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(z.reactions),{}));p!==void 0?m[n]=p:b("bs_curry")._2(Ma,m,n);A=Object.assign(Object.assign({},z),{reactions:m});w=z.thread_id;w==null||Ia(B[0],w,q,o[3]);return Qa(B,[q,A])}else return B;case 46:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("MontageDirectExpire");p=f;n=k[0];if(b("gkx")("676919")){m=Na(p,n);if(m!==void 0){z=b("bs_caml_option").valFromOption(m);w=z.attachments;if(w==null||w.length===0)return p;else{o=b("bs_caml_array").caml_array_get(w,0);q=o.share;if(q==null)return p;else{A=q.target;if(A==null)return p;else{B=A.message_state;if(B==null)return p;else{m=Object.assign(Object.assign({},z),{attachments:b("bs_caml_array").caml_array_set(b("bs_array").copy(w),0,Object.assign(Object.assign({},o),{share:Object.assign(Object.assign({},q),{target:Object.assign(Object.assign({},A),{message_state:"EXPIRED"})})}))});return Qa(p,[n,m])}}}}}else return p}else return p;case 47:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("LiveLocationUpdate");B=f;z=[k[0],k[1],k[2]];w=z[0];o=Na(B,w);if(o!==void 0){q=b("bs_caml_option").valFromOption(o);A=q.attachments;if(A==null||A.length===0)return B;else{n=b("bs_caml_array").caml_array_get(A,0);m=n.share;if(m==null)return B;else{p=m.target;if(p==null)return B;else{o=b("bs_array").copy(A);b("bs_caml_array").caml_array_set(o,0,Object.assign(Object.assign({},n),{share:Object.assign(Object.assign({},m),{target:Object.assign(Object.assign({},z[1]),{live_location_id:p.live_location_id})})}));A=Object.assign(Object.assign({},q),{attachments:o});n=q.thread_id;n==null||Ia(B[0],n,w,z[2]);return Qa(B,[w,A])}}}}else return B;case 48:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ReplaceMessage");m=f;p=k[0];o=k[1];var tb=p.replaced_message_id;if(tb==null)return m;else{q=Na(m,tb);if(q!==void 0){n=p.message_id;z={timestamp:p.timestamp};w=b("bs_caml_option").nullable_to_opt(p.status);w!==void 0&&(z.status=b("bs_caml_option").valFromOption(w));A=b("bs_caml_option").nullable_to_opt(p.log_message_data);A!==void 0&&(z.log_message_data=b("bs_caml_option").valFromOption(A));B=b("bs_caml_option").nullable_to_opt(p.meta_ranges);B!==void 0&&(z.meta_ranges=b("bs_caml_option").valFromOption(B));w=b("bs_caml_option").nullable_to_opt(p.ranges);w!==void 0&&(z.ranges=b("bs_caml_option").valFromOption(w));A=b("bs_caml_option").nullable_to_opt(p.raw_attachments);A!==void 0&&(z.raw_attachments=b("bs_caml_option").valFromOption(A));B=b("bs_caml_option").nullable_to_opt(p.attachments);B!==void 0&&(z.attachments=b("bs_caml_option").valFromOption(B));w=b("bs_caml_option").nullable_to_opt(p.body);w!==void 0&&(z.body=b("bs_caml_option").valFromOption(w));A=b("bs_caml_option").nullable_to_opt(p.platform_xmd);A!==void 0&&(z.platform_xmd=b("bs_caml_option").valFromOption(A));B=b("bs_caml_option").nullable_to_opt(p.profile_ranges);B!==void 0&&(z.profile_ranges=b("bs_caml_option").valFromOption(B));w=z;A=Object.assign(Object.assign({},b("bs_caml_option").valFromOption(q)),w);b("MercuryMessageIDs.bs").addServerID(n,n);var D=Qa(m,[n,A]);if(n!==tb){D[9]["delete"](tb);D[10].set(tb,n);B=b("bs_belt_Option").flatMap(b("bs_caml_option").nullable_to_opt(p.thread_id),function(a){return b("bs_caml_option").nullable_to_opt(D[15].get(a))});z=p.thread_id;if(B!==void 0&&!(z==null)){q=B;w=Pa(D,[n].concat(q[1].filter(function(a){return a!==tb})));D[15].set(z,[q[0],w])}}A=p.message_id;B=p.thread_id;B==null||(Ia(D[0],B,tb,o),Ia(D[0],B,A,o));return[D[0],D[1],D[2],D[3],D[4],D[5],D[6],D[7],D[8],D[9],D[10],D[11],D[12],D[13],D[14],D[15],D[16],D[17],D[18]]}else return m}case 49:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateLocalTitanMessagesCount");n=f;z=d;q=[k[0],k[1]];w=q[0];p=Na(n,q[1]);if(p!==void 0&&b("MessengerMessage.bs").isTitanMessage(b("bs_caml_option").valFromOption(p))){B=z[2].get(w);B==null?z[2].set(w,1):z[2].set(w,1+B|0)}return n;case 50:return $a(f,d,k[0],k[1]);case 51:A=f;o=d;m=k[0];q=k[1];p=k[2];z=db(A,m,q,p==null?void 0:b("bs_caml_option").some(p));bb(z[0],q,m,function(a,b,c){a.informNewMessage(b,c);return 0});w=z[0];B=b("MercuryIDs").getParticipantIDFromUserID(w);if(m.folder===b("MessagingTag").PENDING&&b("bs_caml_obj").caml_equal(q,b("bs_caml_option").some(b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE)))n=[z[0],z[1],z[2],z[3],z[4],z[5]+1|0,z[6],z[7],z[8],z[9],z[10],z[11],z[12],z[13],z[14],z[15],z[16],z[17],z[18]];else if(m.folder===b("MessagingTag").INBOX){A=m.thread_id;n=A==null?z:Ba(z,A,m.folder,0)}else{A=m.thread_id;if(A==null)n=z;else{p=hb(z[0],z[7],m,p);if(p!==void 0){p=b("bs_caml_option").valFromOption(p);var E=z[0],F=z[1],G=z[2],H=z[3],ub=z[4],I=z[5],J=z[6],K=b("bs_belt_Map").set(z[7],p.thread_id,p),L=z[8],vb=z[9],M=z[10],N=z[11],O=z[12],P=z[13],Q=z[14],R=z[15],S=z[16],T=z[17],U=z[18];E=[E,F,G,H,ub,I,J,K,L,vb,M,N,O,P,Q,R,S,T,U];if(b("bs_caml_obj").caml_equal(q,b("bs_caml_option").some(b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE))){F=m.offline_threading_id;F==null?Object.assign(m,{folder:p.folder}):b("bs_caml_obj").caml_equal(b("bs_caml_option").nullable_to_opt(M.get(F)),F)?Object.assign(m,{client_message_id:m.offline_threading_id,status:b("MercuryActionStatus").SUCCESS,action_type:b("MercuryActionType").SEND_MESSAGE}):Object.assign(m,{folder:p.folder})}Aa(E,p);G=Object.assign({},p);G.unread_count===0&&b("bs_caml_obj").caml_equal(m.author,B)&&m.timestamp>=G.last_read_timestamp&&!b("gkx")("702170")&&Object.assign(G,{last_read_timestamp:m.timestamp});H=m.offline_threading_id;if(!(H==null)&&H!==m.message_id){Object.assign(G,{last_message_timestamp:m.timestamp});ub=m.comm_status;ub==null||Object.assign(G,{last_message_id:m.message_id})}I=m.comm_status;J=G.comm_status;I==null||!(J==null)&&b("bs_caml_obj").caml_notequal(J,b("PageCommItemStatus").FOLLOW_UP)&&Object.assign(G,{comm_status:I});K=m.creator_info;K==null||b("bs_caml_obj").caml_equal(K.pageID,w)&&Object.assign(G,{folder:m.folder});L=m.author;L==null||cb(G,L);n=t(void 0,E,A,G)}else n=z}}vb=ab(n,o,m,q);N=ib(vb,m);O=N;P=m;Q=b("bs_caml_obj").caml_notequal(P.author,b("MercuryViewer").getID());R=P.thread_id;S=P.author;if(Q&&!(R==null||S==null)){T=ka(O[6],R,S);if(T!==O[6])return[O[0],O[1],O[2],O[3],O[4],O[5],T,O[7],O[8],O[9],O[10],O[11],O[12],O[13],O[14],O[15],O[16],O[17],O[18]];else return O}else return O;case 52:U=f;M=d;F=k[0];p=k[1];B=k[2];H=b("bs_caml_obj").caml_notequal(B==null?void 0:b("bs_caml_option").some(B),!1);ub=b("bs_caml_obj").caml_equal(B==null?void 0:b("bs_caml_option").some(B),!0);J=U[0];I=b("MercuryIDs").getParticipantIDFromUserID(J);K=ab(U,M,F,p);bb(K[0],p,F,function(a,b,c){a.informNewLogMessage(b,c);return 0});w=db(K,F,p,B==null?void 0:b("bs_caml_option").some(B));L=F.thread_id;if(L==null)E=w;else{A=b("bs_belt_Map").get(w[7],L);if(A!==void 0){G=Object.assign({},b("bs_caml_option").valFromOption(A));Aa(w,G);G.last_message_timestamp<F.timestamp&&Object.assign(G,{last_message_timestamp:F.timestamp});if(F.timestamp>=G.timestamp||b("gkx")("1183082")){z=F.log_message_type;if(!(z==null))if(b("bs_caml_obj").caml_equal(z,b("MercuryLogMessageType").SUBSCRIBE)&&!ub){n=F.log_message_data;if(n==null)o=[];else{q=n.added_participants;o=q==null?[]:q}ua(I,G,o);s(J,L)}else if(b("bs_caml_obj").caml_equal(z,b("MercuryLogMessageType").UNSUBSCRIBE)&&!ub){vb=F.log_message_data;if(vb==null)N=[];else{m=vb.removed_participants;N=m==null?[]:m}eb(I,G,N);s(J,L)}else if(b("bs_caml_obj").caml_equal(z,b("MercuryLogMessageType").THREAD_IMAGE)){if(!H){P=F.log_message_data;if(P==null)Q=null;else{R=P.image;Q=R==null?null:R.preview_url}Object.assign(G,{image_src:Q})}}else if(b("bs_caml_obj").caml_equal(z,b("MercuryLogMessageType").THREAD_NAME)){S=F.log_message_data;if(!(S==null)){T=S.name;!(T==null)&&G.name===T||s(J,L);Object.assign(G,{name:S.name})}}else b("bs_caml_obj").caml_equal(z,b("MercuryLogMessageType").GENERIC_ADMIN_TEXT)&&Ha(J,G,F,L)}E=t(void 0,w,L,G)}else E=w}return ib(E,F);case 53:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangePinnedStatus");O=f;U=d;M=k[0];K=k[1];p=k[2];B=b("bs_belt_Map").get(O[7],M);A=!1;if(K&&!U[5].has(M))O[13].push(M),U[5].add(M),A=!0;else if(!K&&U[5].has(M)){n=O[13].indexOf(M);n>-1&&O[13].splice(n,1);U[5]["delete"](M);A=!0}if(B!==void 0){q=b("bs_caml_option").valFromOption(B);o=b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(q.thread_pin_timestamp),0);if(q.is_pinned!==K||o!==p){ub=b("ImmutableObject").set(q,{is_pinned:K,thread_pin_timestamp:p});vb=b("bs_belt_Map").set(O[7],M,ub);s(O[0],M);A=!0;m=vb}else m=O[7]}else m=O[7];if(A)return[O[0],O[1],O[2],O[3],O[4],O[5],O[6],m,O[8],O[9],O[10],O[11],O[12],O[13],O[14],O[15],O[16],O[17],O[18]];else return O;case 54:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("InvalidateMontageState");I=f;N=k[0];H=b("bs_js_dict").fromArray(b("bs_js_dict").entries(I[14]));H[N]=[];return[I[0],I[1],I[2],I[3],I[4],I[5],I[6],I[7],I[8],I[9],I[10],I[11],I[12],I[13],H,I[15],I[16],I[17],I[18]];case 55:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("NewMontageMessage");P=f;R=k[0];Q=b("bs_js_dict").fromArray(b("bs_js_dict").entries(P[14]));T=R.actor.id;S=b("bs_js_dict").get(Q,T);if(S!==void 0){z=S;z.push(R);Q[T]=z}else Q[T]=[R];return[P[0],P[1],P[2],P[3],P[4],P[5],P[6],P[7],P[8],P[9],P[10],P[11],P[12],P[13],Q,P[15],P[16],P[17],P[18]];case 56:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("InstantiateMontageThread");J=f;L=k[0];G=b("bs_js_dict").fromArray(b("bs_js_dict").entries(J[14]));w=b("bs_js_dict").get(G,L);w===void 0&&(G[L]=[]);return[J[0],J[1],J[2],J[3],J[4],J[5],J[6],J[7],J[8],J[9],J[10],J[11],J[12],J[13],G,J[15],J[16],J[17],J[18]];case 57:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("DeleteMontageMessage");E=f;var wb=k[0],xb=b("bs_js_dict").fromArray(b("bs_js_dict").entries(E[14]));F=Object.keys(xb);F.forEach(function(c){var a=b("bs_js_dict").get(xb,c);if(a!==void 0){a=a.filter(function(a){return a.id!==wb.messageFBID});xb[c]=a;return 0}else return 0});return[E[0],E[1],E[2],E[3],E[4],E[5],E[6],E[7],E[8],E[9],E[10],E[11],E[12],E[13],xb,E[15],E[16],E[17],E[18]];case 58:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("AddFetchedAllHistoryMarkers");var V=f;n=[k[0],k[1]];var yb=n[1];n[0].forEach(function(b){var a=V[15].get(b);a==null?V[15].set(b,[1,[]]):V[15].set(b,[1,a[1]]);return Ja(V[0],b,yb)});return[V[0],V[1],V[2],V[3],V[4],V[5],V[6],V[7],V[8],V[9],V[10],V[11],V[12],V[13],V[14],V[15],V[16],V[17],V[18]];case 59:var W=f;U=k[0];U.forEach(function(c){__p&&__p();var a=c.folder;if(xa.includes(a)){c=c.thread_fbids.map(function(a){return b("MercuryIDs").getThreadIDFromThreadFBID(a)}).concat(c.other_user_fbids.map(function(a){return b("MercuryIDs").getThreadIDFromUserID(a)}));W[16][a]=new Set(c);a=b("MercuryThreadInformer").getForFBID(W[0]);a.updatedUnreadState();return 0}else return 0});return[W[0],W[1],W[2],W[3],W[4],W[5],W[6],W[7],W[8],W[9],W[10],W[11],W[12],W[13],W[14],W[15],W[16],W[17],W[18]];case 60:var X=f,zb=d;B=k[0];var c=[X[18]];B.forEach(function(a){X[17][a.folder]=a.unread_count;a.unread_count===0&&(X[16][a.folder]=new Set());a.folder===b("MessagingTag").INBOX&&(c[0]=b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(a.seen_timestamp),c[0]),zb[7][0]=a.unseen_count);a=b("MercuryThreadInformer").getForFBID(X[0]);a.updatedUnreadState();a.updatedUnseenState();return 0});return[X[0],X[1],X[2],X[3],X[4],X[5],X[6],X[7],X[8],X[9],X[10],X[11],X[12],X[13],X[14],X[15],X[16],X[17],c[0]];case 61:var Y=f,Ab=k[0];xa.forEach(function(a){__p&&__p();a=b("bs_js_dict").get(Y[16],a);if(a!==void 0){var c=b("bs_caml_option").valFromOption(a);b("bs_js_dict").entries(Ab).forEach(function(a){var b=a[0];if(c.has(b)){c.add(a[1]);c["delete"](b);return 0}else return 0});return 0}else return 0});return[Y[0],Y[1],Y[2],Y[3],Y[4],Y[5],Y[6],Y[7],Y[8],Y[9],Y[10],Y[11],Y[12],Y[13],Y[14],Y[15],Y[16],Y[17],Y[18]];case 62:o=f;q=k[0];K=k[1];p=k[2];ub=k[3];M=k[4];vb=Na(o,K);if(vb!==void 0){A=b("bs_caml_option").valFromOption(vb);Xa(b("bs_caml_option").some(q),A);m=b("MessengerMessage.bs").makeFakeMessage(A.message_id,A.thread_id,A.author,A.action_type,A.timestamp,{removed_timestamp:ub,message_unsendability_status:b("MessageUnsendabilityStatus").DENY_TOMBSTONE_MESSAGE,unsender:{id:p}});O=Qa(o,[K,m]);N=A.thread_id;if(N==null)return O;else{H=Ya(O,K,N);Ia(H[0],N,K,M);Ka(H[0],N,K,M,A.attachments);I=b("bs_belt_Map").get(H[7],N);if(I!==void 0){S=b("bs_caml_option").valFromOption(I);z=Za(A.profile_ranges,H[0]);T=b("ImmutableObject").set(b("ImmutableObject").set(S,Wa(H,N)),{unread_mentions_count:z?S.unread_mentions_count-1|0:S.unread_mentions_count});R=b("bs_belt_Map").set(H[7],N,T);s(H[0],N);return[H[0],H[1],H[2],H[3],H[4],H[5],H[6],R,H[8],H[9],H[10],H[11],H[12],H[13],H[14],H[15],H[16],H[17],H[18]]}else return H}}else{La(o[0],q,K,M);return o}case 63:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateConnectivityStatus");Q=f;P=k[0];w=k[1];L=b("ThreadConnectivityStatus.bs").toGraphQLValue(w);G=b("bs_belt_Map").get(Q[7],P);if(G!==void 0){J=b("bs_caml_option").valFromOption(G);F=J.thread_connectivity_data;E=F==null?b("ImmutableObject").set(J,{thread_connectivity_data:{connectivity_status:L,first_sender_id:null}}):b("ImmutableObject").set(J,{thread_connectivity_data:{connectivity_status:L,first_sender_id:F.first_sender_id}});return[Q[0],Q[1],Q[2],Q[3],Q[4],Q[5],Q[6],b("bs_belt_Map").set(Q[7],P,E),Q[8],Q[9],Q[10],Q[11],Q[12],Q[13],Q[14],Q[15],Q[16],Q[17],Q[18]]}else return Q;case 64:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("DeltaMarkFolderSeen");n=f;var Bb=k[0];return b("bs_belt_Array").reduceU(Bb.folders,n,function(c,a){a=b("bs_js_dict").get(b("MessagingTag").IRIS_MAPPING,a);if(a!==void 0)return qb(c,Number(Bb.timestamp),a);else return c});case 65:U=f;B=[k[0],k[1],k[2],k[3]];var Cb=B[2];vb=B[0];ub=Na(U,vb);if(ub!==void 0){p=b("bs_caml_option").valFromOption(ub);m=B[1].concat(p.tags).filter(function(a){return Cb.indexOf(a)===-1});O=Object.assign(Object.assign({},p),{tags:m});I=p.thread_id;I==null||Ia(U[0],I,vb,B[3]);return Qa(U,[vb,O])}else return U;case 66:A=f;z=[k[0],k[1],k[2],k[3],k[4]];S=z[0];T=Na(A,S);if(T!==void 0){N=b("bs_caml_option").valFromOption(T);R=N.attachments;if(R==null||R.length!==1)return A;else{H=R[0];q=z[2]?[Object.assign(Object.assign({},H),{blurred_image_uri:void 0})]:[Object.assign(Object.assign({},H),{blurred_image_uri:z[3]})];K=Object.assign(Object.assign({},N),{attachments:q});M=N.thread_id;M==null||Ia(A[0],M,S,z[4]);return Qa(A,[S,K])}}else return A}case 1:o=g[0];if(typeof o==="number")if(o===0){w=f;var Db=[];b("bs_belt_MapString").forEach(w[6],function(a,c){return b("bs_belt_Map").forEach(c,function(b,c){if(c<Date.now()-3e4){Db.push([a,b]);return 0}else return 0})});if(Db.length!==0){var a=[w[6]];Db.forEach(function(b){a[0]=ka(a[0],b[0],b[1]);return 0});return[w[0],w[1],w[2],w[3],w[4],w[5],a[0],w[7],w[8],w[9],w[10],w[11],w[12],w[13],w[14],w[15],w[16],w[17],w[18]]}else return w}else{G=f;J=d;if(pb(G,J,!1)>0){L=b("MercuryServerRequests").getForFBID(G[0]);L.markSeen();return qb(G,L.getLastActionTimestamp(),b("MessagingTag").INBOX)}else return G}else switch(o.tag|0){case 0:var Z=f,Eb=d;F=o[0];P=o[1];E=o[2];Q=o[3];var Fb=Z[7],Gb=[];n=i(F.reduce(function(c,d){var a=b("bs_belt_Map").get(Fb,d);if(a!==void 0)return b("bs_belt_Map").set(c,d,b("bs_caml_option").valFromOption(a));else{Gb.push(d);return c}},b("bs_belt_Map").make(b("ThreadId.bs"))));if(Gb.length!==0){ub=Eb[1];m=ub[0].toString();Eb[1][0]=ub[0]+1|0;Eb[0][0][m]=[F,E];p=b("MercuryServerRequests").getForFBID(Z[0]);I=Gb.reduce(function(c,d){__p&&__p();var e=b("MercuryIDs").tokenize(d),f=e.type;e=e.value;if(f==="user"){f=b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(e));e=b("MercuryIDs").getParticipantIDFromUserID(Z[0]);var a=b("bs_caml_obj").caml_equal(f,e);a=b("MessengerThreadUtils.bs").createNewLocalThread(e,d,a?[e]:[e,f],null);e=b("bs_belt_Map").set(c,d,a);b("gkx")("1074761")||kb(e,Eb[0][0]);return e}else return c},Z[7]);p.fetchThreadData(Gb,Q);b("bs_curry")._1(P,m);if(I===Z[7])return Z;else return[Z[0],Z[1],Z[2],Z[3],Z[4],Z[5],Z[6],I,Z[8],Z[9],Z[10],Z[11],Z[12],Z[13],Z[14],Z[15],Z[16],Z[17],Z[18]]}else{b("bs_curry")._1(E,n);return Z}case 1:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UnsubscribeThread");B=d[0][0];b("bs_curry")._2(jb,B,o[0]);d[0][0]=B;return f;case 2:var $=f;vb=o[0];O=b("bs_belt_Array").keepMap(vb,function(a){a=Na($,a);if(a!==void 0)return b("bs_caml_option").nullable_to_opt(b("bs_caml_option").valFromOption(a).offline_threading_id)});O.forEach(function(a){$[10]["delete"](a);return 0});return[$[0],$[1],$[2],$[3],$[4],$[5],$[6],$[7],$[8],$[9],$[10],$[11],$[12],$[13],$[14],$[15],$[16],$[17],$[18]];case 3:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("MontagePollStickerVoted");U=f;var Hb=o[0];k=b("bs_js_dict").fromArray(b("bs_js_dict").entries(U[14]));T=Hb.montageActorID;R=b("bs_js_dict").get(k,T);if(R!==void 0){H=R.map(function(a){__p&&__p();var c=b("bs_caml_obj").caml_equal(Hb.montageMessageID,a.id);if(c){c=a;var d=Hb,e=c.montage_overlays.map(function(a){__p&&__p();if(b("bs_caml_obj").caml_equal(a.poll.id,d.pollID)){var c=a.poll.poll_options.map(function(a,c){c=c===d.optionVotedIndex;if(c)return new(b("ImmutableObject"))({text:a.text,vote_count:a.vote_count+1|0});else return a});c=new(b("ImmutableObject"))({can_viewer_vote:a.poll.can_viewer_vote,id:a.poll.id,poll_options:c,viewer_vote_index:d.optionVotedIndex});return b("ImmutableObject").set(new(b("ImmutableObject"))(a),{poll:c})}else return a});return b("ImmutableObject").set(new(b("ImmutableObject"))(c),{montage_overlays:e})}else return a});k[T]=H}return[U[0],U[1],U[2],U[3],U[4],U[5],U[6],U[7],U[8],U[9],U[10],U[11],U[12],U[13],k,U[15],U[16],U[17],U[18]];case 4:q=b("bs_belt_Map").set(f[7],o[0],o[1]);return[f[0],f[1],f[2],f[3],f[4],f[5],f[6],q,f[8],f[9],f[10],f[11],f[12],f[13],f[14],f[15],f[16],f[17],f[18]];case 5:b("MercuryServerRequests").getForFBID(f[0]).updateLastActionTimestamp(o[0]);return f}case 2:N=g[0];switch(N.tag|0){case 0:b("bs_curry")._1(N[0],{blocked_ids:f[4]});break;case 1:b("bs_curry")._1(N[1],b("bs_belt_Map").get(f[7],N[0]));break;case 2:b("bs_curry")._1(N[0],f[13].concat([]));break;case 3:b("bs_curry")._2(N[0],f,d);break}return f}},c,a);e.length>0&&b("LogHistory").getInstance("messenger_state").debug("actions",b("bs_belt_Option").getWithDefault(b("bs_caml_option").undefined_to_opt(JSON.stringify(e)),""));return c}function J(c,a){__p&&__p();var d=function(c){b("bs_curry")._1(a,[b("bs_block").__(0,[b("bs_block").__(5,[c])])]);b("setTimeoutAcrossTransitions")(function(c){return b("bs_curry")._1(a,[b("bs_block").__(1,[0])])},3e4);return 0};b("Arbiter").subscribe(B(c),function(a,b){a=b.obj;b=a.to;if(!(b==null)&&b.toString()!==c)return 0;else{d(a);return 0}});b("Arbiter").subscribe(b("JSLogger").DUMP_EVENT,function(d,e){__p&&__p();d=function(a,d){__p&&__p();var f={};b("bs_belt_MapString").toArray(a[2]).forEach(function(a){var b={};a[1].forEach(function(c,d,a){b[d]=c.watermark;return 0});f[a[0]]=b;return 0});d="read_receipts:"+c;e[d]=f;return 0};return b("bs_curry")._1(a,[b("bs_block").__(2,[b("bs_block").__(3,[d])])])});return 0}rb=b("MessengerPersistantViewerKeyedSubscriptionComponent.bs").Make({initialState:C,reducer:I,onFirstMount:J,displayName:"MessengerStateProvider"});var K=rb.send;function L(a,c){return b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(0,[c])])])}function vb(a,c){b("MercuryAssert").isThreadID(c);var d=[void 0],e=function(a){d[0]=a;return 0};b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(1,[c,e])])]);return b("bs_js_null_undefined").fromOption(d[0])}function M(a,c,d,e){__p&&__p();if(c.length!==0){b("MercuryAssert").allThreadID(c);var f=[null],g=function(a){f[0]=a;return 0};b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(1,[b("bs_block").__(0,[c,g,d,e])])]);return f[0]}else{b("bs_curry")._1(d,{});return null}}function N(a,c,d,e){return M(a,[c],function(a){return b("bs_curry")._1(d,a[c])},e)}function O(a,c,d,e){__p&&__p();var f=[void 0],g=function(a){f[0]=a;return 0};b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(1,[c,g])])]);g=f[0];if(g!==void 0)return b("bs_caml_option").valFromOption(g);else{g=b("MessengerThreadUtils.bs").createNewLocalThread(b("MercuryIDs").getParticipantIDFromUserID(a),c,d,e);b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(1,[b("bs_block").__(4,[c,g])])]);return g}}function P(a){var c=b("MercuryLocalIDs").generateThreadID(null);O(a,c,[],null);return c}function Q(a,c,d,e){__p&&__p();var f=[void 0],g=function(a){f[0]=a;return 0};b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(1,[c,g])])]);g=f[0];if(g!==void 0)return b("bs_caml_option").valFromOption(g);else{g=b("MessengerThreadUtils.bs").createNewLocalGroupGeneralThread(b("MercuryIDs").getParticipantIDFromUserID(a),c,d,e);b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(1,[b("bs_block").__(4,[c,g])])]);return g}}function R(a,c,d){var e=b("MercuryLocalIDs").generateThreadID(null);Q(a,e,c,d);return e}function S(a,c){var d=[void 0],e=function(a){d[0]=a;return 0};b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(1,[c,e])])]);a=d[0];if(a!==void 0)return b("MercuryThreadInfo").isEmptyLocalThread(b("bs_caml_option").valFromOption(a));else return!1}function T(a,c){var d=[void 0],e=function(a){d[0]=a;return 0};b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(1,[c,e])])]);a=d[0];if(a!==void 0)return b("MercuryThreadInfo").isNewEmptyLocalThread(b("bs_caml_option").valFromOption(a));else return!1}function U(c){var a=[[]],d=function(b){a[0]=b;return 0};b("bs_curry")._2(K,b("bs_caml_option").some(c),[b("bs_block").__(2,[b("bs_block").__(2,[d])])]);return a[0]}function wb(a,c){return b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(1,[b("bs_block").__(1,[c])])])}function xb(a){__p&&__p();var c=a.payload_source;if(c==null)return!1;else if(b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").CLIENT_CHANGE_ARCHIVED_STATUS)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").CLIENT_SEND_MESSAGE)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_SEND_MESSAGE)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_FETCH_THREADLIST_INFO)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_THREAD_SYNC)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_CHANGE_PINNED_STATUS)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_INVALIDATE_GLOBAL_STATE)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").CLIENT_UPDATE_COMM_STATUS))return!0;else if(b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_INITIAL_DATA)){c=a.ordered_threadlists;return!(c==null)}else return!1}function V(a,c){c=b("bs_block").__(1,[b("bs_block").__(3,[c])]);return b("bs_curry")._2(K,b("bs_caml_option").some(a),[c])}function yb(a,c){return b("bs_curry")._2(K,a==null?void 0:b("bs_caml_option").some(a),c)}function W(a){__p&&__p();var c=[],d=!1;if(!(a==null)){var e=a.payload_source;!(e==null)&&b("bs_caml_obj").caml_equal(e,b("MercuryPayloadSource").SERVER_INVALIDATE_GLOBAL_STATE)&&(d=!0);e=a.newlyAddedClientIDs;e==null||Object.keys(e).length>0&&c.push(b("bs_block").__(0,[b("bs_block").__(61,[e])]));e=a.delivery_receipts;e==null||c.push(b("bs_block").__(0,[b("bs_block").__(0,[e])]));e=a.message_ignored_ids;e==null||c.push(b("bs_block").__(0,[b("bs_block").__(1,[e])]));e=a.threads;if(!(e==null)){var f=a.payload_source;f==null||(b("bs_caml_obj").caml_equal(f,b("MercuryPayloadSource").SERVER_FETCH_THREAD_INFO)&&c.push(b("bs_block").__(0,[b("bs_block").__(8,[e])])),b("bs_caml_obj").caml_equal(f,b("MercuryPayloadSource").SERVER_INVALIDATE_THREAD_STATE)&&(e.length>0&&c.unshift(b("bs_block").__(0,[b("bs_block").__(34,[b("bs_caml_array").caml_array_get(e,0).thread_id])]))));c.push(b("bs_block").__(0,[b("bs_block").__(7,[e])]))}f=a.participants;if(!(f==null)){c.push(b("bs_block").__(0,[b("bs_block").__(3,[f])]));var g=[],h=[];f.forEach(function(a){if(a.is_messenger_blocked||a.is_facebook_blocked){g.push(b("MercuryIDs").getParticipantIDFromUserID(a.fbid));return 0}else{h.push(b("MercuryIDs").getParticipantIDFromUserID(a.fbid));return 0}});e=0;(g.length!==0||h.length!==0)&&(e=1);e===1&&c.push(b("bs_block").__(0,[b("bs_block").__(2,[g,h])]))}f=a.message_blocked_ids;f==null||f.length>0&&c.push(b("bs_block").__(0,[b("bs_block").__(2,[f,[]])]));e=a.message_unblocked_ids;e==null||e.length>0&&c.push(b("bs_block").__(0,[b("bs_block").__(2,[[],e])]));f=a.pending_folder_unseen_count;f==null||c.push(b("bs_block").__(0,[b("bs_block").__(4,[f])]));e=a.global_actions;e==null||e.forEach(function(a){if(b("bs_caml_obj").caml_equal(a.action_type,b("MercuryGlobalActionType").MARK_ALL_READ)){c.push(b("bs_block").__(0,[b("bs_block").__(33,[a.folder])]));return 0}else return 0});if(xb(a)){f=a.ordered_threadlists;e=0;f==null||f.length===0?e=1:c.push(b("bs_block").__(0,[b("bs_block").__(9,[f])]));if(e===1){f=a.threads;e=a.payload_source;f==null||!(e==null)&&f.length>0&&e!==b("MercuryPayloadSource").SERVER_CHANGE_PINNED_STATUS&&c.push(b("bs_block").__(0,[b("bs_block").__(10,[f])]))}}e=a.pinned_thread_ids;e==null||e.length>0&&xb(a)&&c.push(b("bs_block").__(0,[b("bs_block").__(11,[e])]));f=a.roger;f==null||c.push(b("bs_block").__(0,[b("bs_block").__(6,[f])]));e=a.montage_delete_message_delta;e==null||c.push(b("bs_block").__(0,[b("bs_block").__(57,[e])]));f=a.montage_new_message_delta;f==null||c.push(b("bs_block").__(0,[b("bs_block").__(55,[f])]));e=a.montage_poll_sticker_vote;e==null||e.forEach(function(a){c.push(b("bs_block").__(1,[b("bs_block").__(3,[a])]));return 0});f=a.current_montage_thread;if(!(f==null)){e=f.user;if(!(e==null)){f=e.messenger_montage_thread;f==null||(c.push(b("bs_block").__(0,[b("bs_block").__(56,[e.id])])),f.montage_messages.edges.forEach(function(a){c.push(b("bs_block").__(0,[b("bs_block").__(55,[a.node])]));return 0}))}}e=a.unread_thread_fbids;e==null||c.push(b("bs_block").__(0,[b("bs_block").__(59,[e])]));f=a.message_counts;f==null||c.push(b("bs_block").__(0,[b("bs_block").__(60,[f])]));e=a.actions;if(!(e==null)){var i=a.payload_source,j=i==null?void 0:b("bs_caml_option").some(i);e.forEach(function(d){__p&&__p();var e=d.action_type,f=0;(i==null||!i.startsWith("server"))&&(f=1);f===1&&c.push(b("bs_block").__(1,[b("bs_block").__(5,[d.timestamp])]));if(b("bs_caml_obj").caml_equal(j,b("bs_caml_option").some(b("MercuryPayloadSource").SERVER_SEARCH))||b("bs_caml_obj").caml_equal(b("bs_caml_option").nullable_to_opt(d.client_state),b("bs_caml_option").some(b("MercuryMessageClientState").SEND_TO_SERVER))){c.push(b("bs_block").__(0,[b("bs_block").__(35,[d,0])]));return 0}else{f=d.thread_id;var g=d.upload_id,h=d.upload_data,k=d.message_ids;r(d);if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").DELETE_MESSAGES))if(!(f==null)&&!(k==null)){c.push(b("bs_block").__(0,[b("bs_block").__(36,[f,k,j])]));return 0}else return 0;else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_FOLDER)){k=d.new_folder;if(!(f==null)&&!(k==null)){c.push(b("bs_block").__(0,[b("bs_block").__(37,[f,k])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_ARCHIVED_STATUS))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(39,[f,d.archived])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_MUTE_SETTINGS)){k=d.reactions_mute_mode;var l=d.mentions_mute_mode,m=d.mute_until;l=k==null?l==null?m==null?void 0:b("bs_block").__(2,[m]):m==null?b("bs_block").__(1,[l===1]):void 0:!(l==null)||!(m==null)?void 0:b("bs_block").__(0,[k===1]);if(!(f==null)&&l!==void 0){c.push(b("bs_block").__(0,[b("bs_block").__(38,[f,l])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_READ_STATUS))if(f==null)return 0;else{m=a.from_client;c.push(b("bs_block").__(0,[b("bs_block").__(41,[f,d.mark_as_read,d.timestamp,m==null?!1:m,d.source])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_PAGE_FOLLOW_UP_STATUS))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(40,[f,d.is_page_follow_up])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").BLOCK_STATUS_CHANGED))if(f==null)return 0;else{k=d.canViewerReply;l=k?null:b("MessengerThreadCannotReplyReason.bs").fromMessageThreadCannotReplyReason(d.reason);c.push(b("bs_block").__(0,[b("bs_block").__(13,[f,d.canViewerReply,l])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").DELETE_THREAD))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(42,[f])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").REACTION_UPDATE)){m=d.messageId;k=d.userId;if(!(m==null)&&!(k==null)){c.push(b("bs_block").__(0,[b("bs_block").__(45,[m,b("bs_caml_option").nullable_to_opt(d.reaction),k,j])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").MONTAGE_DIRECT_EXPIRE)){l=d.messageId;if(l==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(46,[l,j])]));return 0}}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").LIVE_LOCATION_UPDATE)){m=d.messageId;k=d.liveLocation;if(!(m==null)&&!(k==null)){c.push(b("bs_block").__(0,[b("bs_block").__(47,[m,k,j])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").REPLACE_MESSAGE)){c.push(b("bs_block").__(0,[b("bs_block").__(48,[d,j])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CONFIRM_ATTACHMENT_PLACEHOLDER))if(!(g==null)&&!(h==null)){c.push(b("bs_block").__(0,[b("bs_block").__(44,[g,h])]));return 0}else return 0;else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CANCEL_ATTACHMENT_PLACEHOLDER))if(!(g==null)&&!(h==null)){c.push(b("bs_block").__(0,[b("bs_block").__(43,[g,h,j])]));return 0}else return 0;else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").SEND_MESSAGE)){c.push(b("bs_block").__(0,[b("bs_block").__(50,[d,j])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").USER_GENERATED_MESSAGE)){c.push(b("bs_block").__(0,[b("bs_block").__(51,[d,j,a.from_client])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").LOG_MESSAGE))if(b("MessengerMessage.bs").isLocalMessage(d))return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(52,[d,j,a.from_client])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_PINNED_STATUS))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(53,[f,d.is_pinned,d.thread_pin_timestamp])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").REMOVE_MESSAGE)){l=d.thread_id;m=d.messageId;k=d.removed_timestamp;g=d.author;if(!(l==null)&&!(m==null)&&!(k==null)&&!(g==null)){c.push(b("bs_block").__(0,[b("bs_block").__(62,[l,m,g,k,j])]));b("MessengerDesktopNotifications").removeNotification(m);return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UNSUBSCRIBE_STATUS_UPDATE))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(12,[f,d.page_unsubscribe_status])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").BLURRED_IMAGE_STATUS)){h=d.image_message_id;l=d.image_id;g=d.should_show;k=d.blurred_image_uri;if(!(h==null)&&!(l==null)&&!(g==null)&&!(k==null)){c.push(b("bs_block").__(0,[b("bs_block").__(66,[h,l,g,k,j])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").ADD_PARTICIPANTS))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(14,[f,d.participants])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_FLAG))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(15,[f,d.mark_as_flag])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").MOVE_PENDING_TO_INBOX))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(16,[f])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_CUSTOM_LIKE))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(17,[f,d.custom_like])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").PROMOTE_GROUP_ADMINS)){m=d.promoted_admins;if(!(f==null)&&!(m==null)){c.push(b("bs_block").__(0,[b("bs_block").__(18,[f,m])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").REMOVE_GROUP_ADMINS)){h=d.removed_admin_ids;if(!(f==null)&&!(h==null)){c.push(b("bs_block").__(0,[b("bs_block").__(19,[f,h])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").JOINABLE_MODE))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(20,[f,d.joinable_mode])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").APPROVAL_MODE))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(21,[f,d.approval_mode])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").APPROVAL_QUEUE))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(22,[f,d.added_id,d.added_group_id,d.removed_id,d.removed_group_id])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").IS_PIN_PROTECTED))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(23,[f,d.is_pin_protected])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_RTC_CALL_DATA))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(24,[f,d.initiator_fbid,d.call_state,d.server_info_data])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_COMM_STATUS))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(25,[f,d.comm_status])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_COMM_ITEM_OWNER))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(26,[f,d.id,d.name,d.profile_pic_uri])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").EVENT_RSVP_CHANGED))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(27,[f,d.actor_fbid,d.rsvp_status])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_CONNECTIVITY_STATUS)){l=d.thread_connectivity_status;if(!(f==null)&&!(l==null)){c.push(b("bs_block").__(0,[b("bs_block").__(63,[f,l])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").GROUPS_SYNC_STATUS_CHANGED))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(28,[f,d.groups_sync_action,d.groups_sync_status_string])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").GROUPS_SYNC_METADATA_UPDATE))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(29,[f,d.groups_sync_action,d.fb_group_id])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").DESCRIPTION_CHANGED))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(30,[f,d.group_thread_description_string])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_THREAD_THEME))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(31,[f,{solid_color:d.solid_color,header_color:d.header_color,footer_color:d.footer_color,gradient_colors:d.gradient_colors,theme_id:d.theme_id}])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_JOINABLE_LINK))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(32,[f,d.joinable_link])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").MUTATE_TAGS)){g=d.tags_to_add;k=g==null?[]:g;m=d.tags_to_delete;h=m==null?[]:m;l=d.messageId;if(l==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(65,[l,k,h,j])]));return 0}}else return 0}});b("Utils.bs").isTruthy(a.from_client)&&e.forEach(function(d){var a=d.thread_id;if(a==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(49,[a,d.message_id])]));return 0}})}f=a.end_of_history;f==null||c.push(b("bs_block").__(0,[b("bs_block").__(58,[f,a.payload_source])]))}d&&c.unshift(b("bs_block").__(0,[0]));return c}function X(c,d){var a=[[]],e=function(b,c){c=b[15].get(d);if(c==null)return 0;else{a[0]=Oa(!0,b,c[1]);return 0}};b("bs_curry")._2(K,b("bs_caml_option").some(c),[b("bs_block").__(2,[b("bs_block").__(3,[e])])]);return a[0]}function zb(c,d){var a=[d],e=function(b,c){c=b[10].get(d);if(c==null)return 0;else{a[0]=c;return 0}};b("bs_curry")._2(K,b("bs_caml_option").some(c),[b("bs_block").__(2,[b("bs_block").__(3,[e])])]);return a[0]}function Y(a,c){var d=[void 0],e=function(a,b){d[0]=a;return 0};b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[e])])]);a=d[0];if(a!==void 0)return Oa(!1,a,c);else return[]}function Ab(a,c,d){__p&&__p();var e=[!1],f=function(a,b){__p&&__p();b=a[15].get(c);if(b==null)return 0;else{a=b[0];b=b[1].length;if(a){e[0]=!0;return 0}else{e[0]=b>=d;return 0}}};b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[f])])]);return e[0]}function Bb(a,c){__p&&__p();var d=[!1],e=function(a,b){__p&&__p();b=a[15].get(c);if(b==null)return 0;else{a=b[0];if(a){d[0]=!0;return 0}else{d[0]=!1;return 0}}};b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[e])])]);return d[0]}function Cb(a,c){return b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(1,[b("bs_block").__(2,[c])])])}function Db(a,c,d,e){__p&&__p();var f=[],g=function(g,h){__p&&__p();h=g[15].get(c);if(h==null)return 0;else{h=h[1];for(var i=d,j=d+e|0;i<=j;++i){var a=b("bs_belt_Option").flatMap(b("bs_belt_Array").get(h,i),function(a){return Na(g,a)});a!==void 0&&f.push(b("bs_caml_option").valFromOption(a))}return 0}};b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[g])])]);return f}var Z=[void 0];function Eb(a,c,d,e,f,g,h){__p&&__p();var i=function(j,i){__p&&__p();Z[0]=[c,d,e];var k=j[15].get(c);k=k==null?[[],void 0]:[k[1],k[0]];var l=k[0];if(b("bs_js_dict").get(i[6][0],c)!==!0){var m=i[2];m=l.length-b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(m.get(c)),0)|0;m>0&&b("ChatReliabilityInstrumentation").logERROR("fetch made with message in flight");var aa=m-d|0;aa=e-aa|0;if(aa>0&&b("bs_caml_obj").caml_notequal(k[1],1)){k=b("MercuryServerRequests").getForFBID(a);var ba=b("bs_js_null_undefined").fromOption(b("bs_belt_Option").map(b("bs_belt_Option").flatMap(b("bs_belt_Array").get(l,m-1|0),function(a){return Na(j,a)}),function(a){return a.timestamp})),ca=i[4][0];i[4][0]=ca+1|0;i[3][0][String(ca)]=[[c,d,e],f];if(b("bs_caml_obj").caml_equal([c,d,e],Z[0])){k.fetchThreadMessages(c,m,aa,ba,g,h);return 0}else return 0}else return b("bs_curry")._1(f,b("bs_belt_Array").keepMap(l,function(a){return Na(j,a)}).slice(d,e))}else{Z[0]=void 0;i[6][0][c]=!1;return 0}};return b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[i])])])}function Fb(a,b,c,d,e,f,g){if(Bb(a,b))return 0;else return Eb(a,b,c,d,e,f,g)}function Gb(a){var c=[0],d=function(d,a){c[0]=b("bs_caml_primitive").caml_int_min(A(d,a),b("MercuryThreadlistConstants").MAX_UNSEEN_COUNT);return 0};b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[d])])]);return c[0]}function $(a){var c=[0],d=function(b,a){c[0]=A(b,a);return 0};b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[d])])]);return c[0]}function Hb(a){var c=[0],d=function(d,a){c[0]=b("bs_caml_primitive").caml_int_min(pb(d,a,!0),b("MercuryThreadlistConstants").MAX_UNSEEN_COUNT);return 0};b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[d])])]);return c[0]}function Ib(a){return b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(1,[1])])}function Jb(a,c){var d=[null],e=function(a,e){e=b("bs_js_dict").get(a[16],c);d[0]=e!==void 0?b("bs_belt_Array").keepMap(b("JSSet.bs").values(b("bs_caml_option").valFromOption(e)),function(c){return b("bs_caml_option").nullable_to_opt(j(a,c))}).filter(function(a){return!b("MercuryThreadInfo").isMuted(a)}).length:null;return 0};b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[e])])]);return d[0]}function Kb(a){var c=[[]],d=function(a,d){c[0]=b("bs_belt_Map").keysToArray(a[7]);return 0};b("bs_curry")._2(K,b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[d])])]);return c[0]}sb=rb.make;tb={make:rb.make};f.fbid=c;f.deliveryReceipts=d;f.readReceiptsPerThread=e;f.ignoredIds=k;f.blockedIds=l;f.pendingFolderUnseenCount=m;f.typing=aa;f.pendingReadStatusThreads=ba;f.messages=ca;f.localIDsMap=da;f.messagesWithUploadsInFlight=n;f.threadlistOrderMap=o;f.pinnedThreads=p;f.montage=q;f.orderedMessageLists=ea;f.unreadCounts=fa;f.initialUnreadCounts=ga;f.unseenTimestamp=ha;f.threads=a;f.thread=j;f.send=K;f.compute=L;f.getThreadMetaNow=vb;f.getMultiThreadMeta=M;f.getThreadMeta=N;f.createNewLocalThread=O;f.createNewLocalThreadGenerateID=P;f.createNewLocalGroupGeneralThreadGenerateID=R;f.isEmptyLocalThread=S;f.isNewEmptyLocalThread=T;f.getPinnedThreadlist=U;f.unsubscribeThread=wb;f.sendJS=yb;f.invalidateSearchedMessages=Cb;f.hasLoadedNMessages=Ab;f.hasLoadedAllMessages=Bb;f.getCurrentlyLoadedMessages=X;f.getServerMessageID=zb;f.getMessagesFromIDs=Y;f.getThreadMessagesRange=Eb;f.getThreadMessagesRangeNow=Db;f.fetchMoreMessages=Fb;f.processPollStickerVoted=V;f.getUnseenUnreadCount=Gb;f.getUnseenUnreadCountRaw=$;f.getUnseenCount=Hb;f.getThreadIDs_debug=Kb;f.getUnreadThreadCount=Jb;f.markAsSeen=Ib;f.processJSActions=W;f.Provider=tb;f.jsComponent=sb}),null);
__d("MessengerState.re",["bs_curry","MessengerState.bs"],(function(a,b,c,d,e,f){__p&&__p();c=(a=b("MessengerState.bs")).fbid;f.fbid=c;d=a.deliveryReceipts;f.deliveryReceipts=d;e=a.readReceiptsPerThread;f.readReceiptsPerThread=e;c=a.ignoredIds;f.ignoredIds=c;d=a.blockedIds;f.blockedIds=d;e=a.pendingFolderUnseenCount;f.pendingFolderUnseenCount=e;c=a.typing;f.typing=c;d=a.pendingReadStatusThreads;f.pendingReadStatusThreads=d;e=a.messages;f.messages=e;c=a.localIDsMap;f.localIDsMap=c;d=a.messagesWithUploadsInFlight;f.messagesWithUploadsInFlight=d;e=a.threadlistOrderMap;f.threadlistOrderMap=e;c=a.pinnedThreads;f.pinnedThreads=c;d=a.montage;f.montage=d;e=a.orderedMessageLists;f.orderedMessageLists=e;c=a.unreadCounts;f.unreadCounts=c;d=a.initialUnreadCounts;f.initialUnreadCounts=d;e=a.unseenTimestamp;f.unseenTimestamp=e;c=a.threads;f.threads=c;d=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").thread,a,c);return a};f.thread=d;e=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").compute,a,c);return a};f.compute=e;c=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").getThreadMetaNow,a,c);return a};f.getThreadMetaNow=c;d=function(a,c,d,e){a=b("bs_curry")._4(b("MessengerState.bs").getMultiThreadMeta,a,c,d,e);return a};f.getMultiThreadMeta=d;e=function(a,c,d,e){a=b("bs_curry")._4(b("MessengerState.bs").getThreadMeta,a,c,d,e);return a};f.getThreadMeta=e;c=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").isEmptyLocalThread,a,c);return a};f.isEmptyLocalThread=c;d=a.getPinnedThreadlist;f.getPinnedThreadlist=d;e=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").unsubscribeThread,a,c);return a};f.unsubscribeThread=e;c=function(a,c,d){a=b("bs_curry")._3(b("MessengerState.bs").hasLoadedNMessages,a,c,d);return a};f.hasLoadedNMessages=c;d=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").getServerMessageID,a,c);return a};f.getServerMessageID=d;e=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").getMessagesFromIDs,a,c);return a};f.getMessagesFromIDs=e;c=function(a,c,d,e,f,g,h){a=b("bs_curry")._7(b("MessengerState.bs").getThreadMessagesRange,a,c,d,e,f,g,h);return a};f.getThreadMessagesRange=c;d=function(a,c,d,e){a=b("bs_curry")._4(b("MessengerState.bs").getThreadMessagesRangeNow,a,c,d,e);return a};f.getThreadMessagesRangeNow=d;e=function(a,c,d,e,f,g,h){a=b("bs_curry")._7(b("MessengerState.bs").fetchMoreMessages,a,c,d,e,f,g,h);return a};f.fetchMoreMessages=e;c=a.getUnseenUnreadCount;f.getUnseenUnreadCount=c;d=a.getUnseenCount;f.getUnseenCount=d;e=a.getThreadIDs_debug;f.getThreadIDs_debug=e;c=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").getUnreadThreadCount,a,c);return a};f.getUnreadThreadCount=c;(function(a){return null});d=a.jsComponent;f.jsComponent=d}),null);
__d("MessengerPresenceProvider.bs",["FBID.bs","bs_curry","React","Arbiter","bs_belt_Set","bs_caml_obj","bs_belt_Array","MercuryIDs","bs_belt_Option","bs_caml_option","OnlineUserIds.bs","ParticipantId.bs","PresenceStatus","PresencePrivacy","AvailableListConstants","MessengerPersistantViewerKeyedSubscriptionComponent.bs"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=["privacy-changed","privacy-availability-changed","privacy-user-presence-response"];function a(a){return b("OnlineUserIds.bs").make(0)}function c(a,c){if(a){a=a[0];var d=b("bs_caml_obj").caml_equal(b("PresenceStatus").get(a),b("AvailableListConstants").ACTIVE);if(d)return b("bs_belt_Set").add(c,b("MercuryIDs").getParticipantIDFromUserID(a));else return b("bs_belt_Set").remove(c,b("MercuryIDs").getParticipantIDFromUserID(a))}else return b("bs_belt_Set").fromArray(b("bs_belt_Array").map(b("PresenceStatus").getOnlineIDs(),function(a){return b("MercuryIDs").getParticipantIDFromUserID(a)}),b("ParticipantId.bs"))}function d(a,c){__p&&__p();b("PresencePrivacy").subscribe(g,function(a){return b("bs_curry")._1(c,0)});b("bs_curry")._1(c,0);b("Arbiter").subscribe(b("AvailableListConstants").ON_AVAILABILITY_CHANGED,function(a,d){if(d==null)return 0;else{a=b("FBID.bs").ofStringExn(d);return b("bs_curry")._1(c,[a])}});return 0}a=b("MessengerPersistantViewerKeyedSubscriptionComponent.bs").Make({initialState:a,reducer:c,onFirstMount:d,displayName:"MessengerPresenceProvider"});var h=a.make;function i(a,c,d,e,f){f={children:e};a!==void 0&&(f.shouldUpdate=b("bs_caml_option").valFromOption(a));c!==void 0&&(f.remoteAction=b("bs_caml_option").valFromOption(c));d!==void 0&&(f.fbid=b("bs_caml_option").valFromOption(d));return f}function j(a){__p&&__p();var c=a.subscribeToIDs,d=a.remoteAction,e=a.fbid;a=a.children;d=i(function(a,d){if(c!==void 0){var e;d=(e=b("bs_belt_Set")).union(e.diff(a,d),e.diff(d,a));return!e.isEmpty(e.intersect(d,b("bs_caml_option").valFromOption(c)))}else return!1},d,e,a,0);return b("React").createElement(h,d)}function e(a){var c=b("ParticipantId.bs"),d={children:a.children},e=b("bs_belt_Option").map(b("bs_caml_option").nullable_to_opt(a.subscribeToIDs),function(a){return b("bs_belt_Set").fromArray(a,c)});e!==void 0&&(d.subscribeToIDs=b("bs_caml_option").valFromOption(e));e=b("bs_caml_option").nullable_to_opt(a.fbid);e!==void 0&&(d.fbid=b("bs_caml_option").valFromOption(e));return j(d)}c=a.send;d=j;f.privacyEvents=g;f.send=c;f.makePropsOriginal=i;f.make=d;f.jsComponent=e}),null);
__d("MessengerReadReceipt.bs",["bs_array","Utils.bs","immutable","bs_caml_option","bs_belt_MapString","MercuryActionStatus"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function g(a,c,d,e){__p&&__p();c=c>=a.timestamp;var f=a.status;e=!e||d!==a.author;if(c)if(f==null)if(e)return!0;else return!1;else if(e)return f===b("MercuryActionStatus").SUCCESS;else return!1;else return!1}function a(a,c,d){__p&&__p();if(c==null)return[];else{a=b("bs_belt_MapString").get(a,c.thread_id);if(a!==void 0)return b("bs_caml_option").valFromOption(a).reduce(function(a,e,f,h){if(g(c,e.watermark,f,b("Utils.bs").isTruthy(d)))return b("bs_array").append(a,[f]);else return a},[]);else return[]}}function c(a,c){a=b("bs_belt_MapString").get(a,c.thread_id);if(a!==void 0)return b("bs_caml_option").valFromOption(a).reduce(function(a,b,d,e){if(a)return g(c,b.watermark,d,!1);else return!1},!0);else return!1}function d(a){return!b("bs_belt_MapString").isEmpty(a)}function e(a,c){if(b("bs_belt_MapString").isEmpty(a))return b("immutable").OrderedMap();else{a=b("bs_belt_MapString").get(a,c);if(a!==void 0)return b("bs_caml_option").valFromOption(a);else return b("immutable").OrderedMap()}}function h(a,c,d){a=b("bs_belt_MapString").get(a,c);if(a!==void 0){c=b("bs_caml_option").valFromOption(a).get(d);if(c==null)return null;else return c}else return null}var i=b("bs_belt_MapString").empty;f.emptyReadReceipts=i;f.wasSeen=g;f.getSeenBy=a;f.wasSeenByAll=c;f.hasReadReceipts=d;f.getSeenTimestamps=e;f.getSeenTimestamp=h}),null);
__d("M4Icon.bs",["cssVar","CurrentUser"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();c={};function a(a){__p&&__p();var c=b("CurrentUser").isWorkUser();if(c)if(typeof a==="number")switch(a){case 0:return"#FFFFFF";case 1:return"#BEC3C9";case 2:return"#8D949E"}else return"#373e4c";else if(typeof a==="number")switch(a){case 0:return"#FFFFFF";case 1:return"#bec2c9";case 2:return"#8D949E"}else return a[0]}d=0;e=1;f.Style=c;f.white=d;f.light=e;f.getColor=a}),null);
__d("M4IconSVG.bs",["React"],(function(a,b,c,d,e,f){"use strict";function a(a){var c=a.size;c=c!==void 0?c:"16px";a=a.children;a=b("React").Children.toArray(a);return b("React").jsx("svg",{children:a,className:"svgIcon",height:c,width:c,version:"1.1",viewBox:"0 0 16 16",x:"0px",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",xmlSpace:"preserve",y:"0px"},"svg")}c=a;f.make=c}),null);
__d("M4IconSettings.bs",["React","M4IconSVG.bs","ReasonReact.bs"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("ReasonReact.bs").statelessComponent("M4IconSettings");function h(a,c,d){var e=a!==void 0?a:!0,f=c!==void 0?c:"blue",h={fill:"none",stroke:f,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10"};return[g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],function(a){a=!e;return b("React").jsx(b("M4IconSVG.bs").make,{children:a?b("React").jsxs("g",{children:[b("React").jsx("path",{style:h,d:"M15.5,8.9V7.1l-2.2-0.5c-0.1-0.5-0.3-0.9-0.6-1.3l1.2-1.9l-1.2-1.2l-1.9,1.2C10.3,3,9.9,2.8,9.4,2.7L8.9,0.5\n          \t\t\tH7.1L6.6,2.7C6.1,2.8,5.7,3,5.2,3.2L3.3,2.1L2.1,3.3l1.2,1.9C3,5.7,2.8,6.1,2.7,6.6L0.5,7.1v1.7l2.2,0.5c0.1,0.5,0.3,0.9,0.6,1.3\n          \t\t\tl-1.2,1.9l1.2,1.2l1.9-1.2c0.4,0.2,0.9,0.4,1.3,0.6l0.5,2.2h1.7l0.5-2.2c0.5-0.1,0.9-0.3,1.3-0.6l1.9,1.2l1.2-1.2l-1.2-1.9\n          \t\t\tc0.2-0.4,0.4-0.9,0.6-1.3L15.5,8.9z"},"outer"),b("React").jsx("circle",{style:h,cx:"8",cy:"8",r:"2.5"},"inner")]},"filled"):b("React").jsx("path",{d:"M15.5,8.9V7.1l-2.2-0.5c-0.1-0.5-0.3-0.9-0.6-1.3l1.2-1.9l-1.2-1.2l-1.9,1.2C10.3,3,9.9,2.8,9.4,2.7L8.9,0.5 H7.1L6.6,2.7C6.1,2.8,5.7,3,5.2,3.2L3.3,2.1L2.1,3.3l1.2,1.9C3,5.7,2.8,6.1,2.7,6.6L0.5,7.1v1.7l2.2,0.5c0.1,0.5,0.3,0.9,0.6,1.3 l-1.2,1.9l1.2,1.2l1.9-1.2c0.4,0.2,0.9,0.4,1.3,0.6l0.5,2.2h1.7l0.5-2.2c0.5-0.1,0.9-0.3,1.3-0.6l1.9,1.2l1.2-1.2l-1.2-1.9 c0.2-0.4,0.4-0.9,0.6-1.3L15.5,8.9z M8,11c-1.7,0-3-1.3-3-3c0-1.7,1.3-3,3-3c1.7,0,3,1.3,3,3C11,9.7,9.7,11,8,11z",fill:f,stroke:f},"all")})},g[9],g[10],g[11],g[12]]}a=b("ReasonReact.bs").wrapReasonForJs(g,function(a){return h(a.filled,a.color,[])});f.component=g;f.make=h;f.jsComponent=a}),null);
__d("ChatTabMenuIcon.bs",["M4Icon.bs","ReasonReact.bs","M4IconSettings.bs"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("ReasonReact.bs").statelessComponent("ChatTabMenuIcon");function h(a){return[g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],function(c){c=b("M4Icon.bs").getColor(a);return b("ReasonReact.bs").element(void 0,void 0,b("M4IconSettings.bs").make(!0,c,[]))},g[9],g[10],g[11],g[12]]}a=b("ReasonReact.bs").wrapReasonForJs(g,function(a){return h(a.iconStyle)});f.component=g;f.make=h;f.jsComponent=a}),null);
__d("M4IconCamcorder.bs",["React","M4IconSVG.bs","ReasonReact.bs"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("ReasonReact.bs").statelessComponent("M4IconCamcorder");function h(a,c,d){var e=a!==void 0?a:!0,f=c!==void 0?c:"blue",h={fill:e?f:"none",stroke:f};return[g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],function(a){return b("React").jsxs(b("M4IconSVG.bs").make,{children:[b("React").jsx("path",{style:h,d:"M9.5,13.5h-7c-1.1,0-2-0.9-2-2v-7c0-1.1,0.9-2,2-2h7c1.1,0,2,0.9,2,2v7C11.5,12.6,10.6,13.5,9.5,13.5z"},"body"),b("React").jsx("line",{stroke:e?"none":f,x1:"13.5",x2:"13.5",y1:"5",y2:"11"},"focus-ring"),b("React").jsx("path",{style:h,d:"M15,3.6l-3.5,3V8v1.4l3.5,3c0.2,0.2,0.5,0,0.5-0.3V8V3.9C15.5,3.6,15.2,3.4,15,3.6z"},"lens")]})},g[9],g[10],g[11],g[12]]}a=b("ReasonReact.bs").wrapReasonForJs(g,function(a){return h(a.filled,a.color,[])});f.component=g;f.make=h;f.jsComponent=a}),null);
__d("M4IconPhone.bs",["React","M4IconSVG.bs","ReasonReact.bs"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("ReasonReact.bs").statelessComponent("M4IconPhone");function h(a,c,d){d=a!==void 0?a:!0;a=c!==void 0?c:"blue";var e={fill:d?a:"none",stroke:a};return[g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],function(a){return b("React").jsx(b("M4IconSVG.bs").make,{children:b("React").jsx("path",{style:e,d:"M8.8,11.6c0.1,0,0.1,0.1,0.2,0.1c0.4,0.2,0.8,0.1,1-0.3c0.1-0.2,0.2-0.4,0.3-0.6c0.2-0.2,0.5-0.6,0.8-0.7 C11.5,10,11.8,10,12,10c0.4,0,0.9,0.4,1.6,0.8c0.7,0.4,1.2,0.8,1.5,1c0.2,0.2,0.3,0.4,0.3,0.6c0,0.4,0,1.2-0.7,1.9 c-1,1.1-2.5,1.6-4.3,1c-1.8-0.6-4.1-1.7-6-3.7s-3.1-4.2-3.7-6s-0.2-3.3,1-4.3c0.7-0.6,1.4-0.7,1.9-0.7c0.2,0,0.5,0.1,0.6,0.3 c0.2,0.3,0.6,0.8,1,1.5C5.7,3.1,6,3.6,6,4c0,0.3,0,0.6-0.1,0.8C5.8,5.1,5.5,5.4,5.2,5.6C5,5.8,4.8,5.9,4.7,6C4.3,6.1,4.1,6.6,4.3,7 c0,0.1,0.1,0.1,0.1,0.2C5.5,9,7,10.5,8.8,11.6z"},"all")})},g[9],g[10],g[11],g[12]]}a=b("ReasonReact.bs").wrapReasonForJs(g,function(a){return h(a.filled,a.color,[])});f.component=g;f.make=h;f.jsComponent=a}),null);
__d("ChatVideoCallIcon.bs",["M4Icon.bs","M4IconPhone.bs","ReasonReact.bs","M4IconCamcorder.bs"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("ReasonReact.bs").statelessComponent("ChatVideoCallIcon");function h(a,c,d){return[g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],function(d){d=b("M4Icon.bs").getColor(c);if(a)return b("ReasonReact.bs").element(void 0,void 0,b("M4IconPhone.bs").make(!0,d,[]));else return b("ReasonReact.bs").element(void 0,void 0,b("M4IconCamcorder.bs").make(!0,d,[]))},g[9],g[10],g[11],g[12]]}a=b("ReasonReact.bs").wrapReasonForJs(g,function(a){return h(a.isAudio,a.iconStyle,[])});f.component=g;f.make=h;f.jsComponent=a}),null);
__d("M4IconClose.bs",["React","M4IconSVG.bs"],(function(a,b,c,d,e,f){"use strict";function a(a){a=a.color;a=a!==void 0?a:"blue";return b("React").createElement(b("M4IconSVG.bs").make,{children:b("React").createElement("g",{key:"close",fill:"none",fillRule:"evenodd",stroke:"none",strokeWidth:"1"},b("React").createElement("g",{key:"iconName",transform:"translate(-712.000000, -1096.000000)"},b("React").createElement("g",{key:"group",stroke:a,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",transform:"translate(709.000000, 320.000000)"},b("React").createElement("path",{key:"stroke1",d:"M5.833,778.833 L16.167,789.167"}),b("React").createElement("path",{key:"stroke2",d:"M16.167,778.833 L5.833,789.167"}))))})}c=a;f.make=c}),null);
__d("M4IconPhoto.bs",["React","M4IconSVG.bs","ReasonReact.bs"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("ReasonReact.bs").statelessComponent("M4IconPhoto");function h(a,c,d){var e=a!==void 0?a:!0,f=c!==void 0?c:"blue",h={fill:"none",stroke:f,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10"};return[g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],function(a){return b("React").jsxs(b("M4IconSVG.bs").make,{children:[e?b("React").jsxs("g",{children:[b("React").jsx("path",{d:"M1.3,13.1L2,1.7c0-0.1,0-0.2,0-0.4L1.2,1.4C0.5,1.5,0,2.4,0,3.4l0.6,10.9c0,0.5,0.2,0.9,0.4,1.3C1.4,15.8,1.7,16,1.9,16 c0,0,0.1,0,0.1,0l0.3,0C1.7,15.4,1.2,14.3,1.3,13.1z",fill:f},"bg"),b("React").jsx("path",{d:"M13,6.2c-0.2-0.2-0.6-0.3-0.8-0.1L9.4,8.5c-0.2,0.1-0.2,0.4,0,0.6L10,9.8c0.2,0.2,0.2,0.6-0.1,0.8c-0.1,0.1-0.2,0.1-0.4,0.1 c-0.2,0-0.3-0.1-0.4-0.2L7.3,8.3C7.1,8.1,6.7,8,6.5,8.2l-2.6,2l-0.4,3.1c0,0.5,0.2,1.6,0.7,1.7l8.8,0.6c0.2,0,0.5,0,0.7-0.2 c0.2-0.2,0.5-0.7,0.6-0.9l0.6-5.9L13,6.2z",fill:f},"hills"),b("React").jsx("path",{style:h,d:"M12.9,15.5l-8.2-0.7C4,14.7,3.4,14,3.4,13.2l1-11.4C4.5,1,5.2,0.5,6,0.5l8.2,0.7C15,1.3,15.5,2,15.5,2.8 l-1,11.4C14.4,15,13.7,15.6,12.9,15.5z"},"frame")]},"filled"):b("React").jsxs("g",{children:[b("React").jsx("path",{d:"M2.1,14.7c-0.1-0.1-0.2-0.3-0.2-0.5l0-0.1c-0.1-0.3-0.1-0.7-0.1-1.1l0-0.1L1,3.3c0-0.5,0.3-0.9,0.8-0.9l1-0.1l0.1-0.7\n              c0-0.1,0-0.2,0.1-0.4L1.7,1.4c-1,0.1-1.8,1-1.7,2l0.9,10.9c0,0.5,0.3,0.9,0.7,1.3C1.9,15.8,2.3,16,2.8,16c0.1,0,0.1,0,0.2,0l0.5,0\n              C2.8,15.7,2.4,15.2,2.1,14.7z",fill:f},"bg"),b("React").jsx("path",{style:h,d:"M12.9,15.5l-8.3-0.7c-0.8-0.1-1.4-0.8-1.3-1.6l1-11.4C4.3,1,5.1,0.4,5.8,0.5l8.3,0.7C15,1.3,15.5,2,15.5,2.8 l-1,11.4C14.4,15,13.7,15.6,12.9,15.5z"},"frame"),b("React").jsx("polyline",{style:h,points:"3.5,11 6.9,8.6 9.2,11.3 "},"left-hill"),b("React").jsx("polyline",{style:h,points:"14.6,9 12.5,6.5 8.3,10 "},"right-hill")]},"outline"),b("React").jsx("circle",{cx:"7.5",cy:"4.5",fill:f,r:"1.5"},"sun")]})},g[9],g[10],g[11],g[12]]}a=b("ReasonReact.bs").wrapReasonForJs(g,function(a){return h(a.filled,a.color,[])});f.component=g;f.make=h;f.jsComponent=a}),null);
__d("M4IconPhoto.re",["M4IconPhoto.bs"],(function(a,b,c,d,e,f){a=b("M4IconPhoto.bs").jsComponent;f.jsComponent=a}),null);
__d("M4IconSend.bs",["React","M4IconSVG.bs","ReasonReact.bs"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("ReasonReact.bs").statelessComponent("M4IconSend");function h(a,c,d){var e=a!==void 0?a:!0,f=c!==void 0?c:"blue";return[g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],function(a){return b("React").jsx(b("M4IconSVG.bs").make,{children:e?b("React").jsx("path",{d:"M11,8.3L2.6,8.8C2.4,8.8,2.3,8.9,2.3,9l-1.2,4.1c-0.2,0.5,0,1.1,0.4,1.5C1.7,14.9,2,15,2.4,15c0.2,0,0.4,0,0.6-0.1l11.2-5.6 C14.8,9,15.1,8.4,15,7.8c-0.1-0.4-0.4-0.8-0.8-1L3,1.1C2.5,0.9,1.9,1,1.5,1.3C1,1.7,0.9,2.3,1.1,2.9L2.3,7c0,0.1,0.2,0.2,0.3,0.2 L11,7.7c0,0,0.3,0,0.3,0.3S11,8.3,11,8.3z",fill:f},"filled"):b("React").jsxs("g",{children:[b("React").jsx("path",{d:"M2.4,1.6l12,6c0.7,0.4,0.7,1.4,0,1.8l-12,6C1.7,15.8,0.8,15,1,14.2l1.7-5.4c0.1-0.2,0.1-0.4,0-0.6L1,2.8 C0.8,2,1.7,1.2,2.4,1.6z",fill:"none",stroke:f,strokeMiterlimit:"10"},"perimeter"),b("React").jsx("line",{fill:"none",stroke:f,strokeMiterlimit:"10",x1:"2.8",x2:"14.8",y1:"8.5",y2:"8.5"},"center-line")]},"outline")})},g[9],g[10],g[11],g[12]]}a=b("ReasonReact.bs").wrapReasonForJs(g,function(a){return h(a.filled,a.color,[])});f.component=g;f.make=h;f.jsComponent=a}),null);
__d("LazyWorkMultiCompanyChatTooltipReact.bs",["ReasonReact.bs","LazyWorkMultiCompanyChatTooltip.react"],(function(a,b,c,d,e,f){"use strict";function a(a){return b("ReasonReact.bs").wrapJsForReason(b("LazyWorkMultiCompanyChatTooltip.react"),{},a)}f.make=a}),null);
__d("WorkChatRedesignedMessageListCheck.bs",["gkx","CurrentUser","MessengerEnvironment"],(function(a,b,c,d,e,f){"use strict";a=b("gkx")("895574")&&b("CurrentUser").isWorkUser()&&b("MessengerEnvironment").messengerui;f.enabled=a}),null);
__d("WorkChatRedesignedMessageListCheck.re",["WorkChatRedesignedMessageListCheck.bs"],(function(a,b,c,d,e,f){a=b("WorkChatRedesignedMessageListCheck.bs").enabled;f.enabled=a}),null);
__d("messengerCustomColorUtils",["ChatConfig"],(function(a,b,c,d,e,f){"use strict";function a(a,c){c=c||{};b("ChatConfig").getBool("chat_tab_has_gradients")||(c.backgroundColor=a);return c}e.exports={customBubbleStyle:a}}),null);
__d("MessengerBotMenuDataFetcher",["AsyncRequest","Cache","MessengerBotComposerWebGraphQLQuery","XMessengerBotsMenuController"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(){this.$1=new(b("Cache"))(),this.$2=new(b("Cache"))()}var c=a.prototype;c.setMenuItemsCache=function(a,b){this.$1.set(a,b)};c.getMenuItems=function(a,c,d){__p&&__p();var e=this;if(this.$1.has(a)){c(this.$1.get(a));return}var f=b("XMessengerBotsMenuController").getURIBuilder().setString("page_id",a).getURI();new(b("AsyncRequest"))().setURI(f).setHandler(function(b){b=b.payload.menu;e.$1.set(a,b);c(b)}).setErrorHandler(function(a){d()}).send()};c.getHasPageSetting=function(a,c,d,e){__p&&__p();var f=this;if(!this.$2.has(a)){var g=b("MessengerBotComposerWebGraphQLQuery").getURI({node_id:a});new(b("AsyncRequest"))().setURI(g).setHandler(function(b){b=b.payload.data.node;b=b&&b.commerce_page_settings||[];f.$2.set(a,b);c(b.indexOf(e)!==-1)}).setErrorHandler(function(b){f.$2.set(a,[]),d()}).setAllowCrossPageTransition(!0).send()}g=this.$2.get(a)||[];c(g.indexOf(e)!==-1);return g.indexOf(e)!==-1};return a}();e.exports=new a()}),null);
__d("MessengerTabsThreadSearchLoader",["Promise","Bootloader","nullthrows"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={_store:null,_actions:null,_promise:null,getStoreEnforce:function(){b("nullthrows")(this._store,"Tab thread search store is not loaded");return this._store},getActionsEnforce:function(){b("nullthrows")(this._actions,"Tab thread search actions are not loaded");return this._actions},isLoaded:function(){return this._store&&this._actions},load:function(){var a=this;this._promise||(this._promise=new(b("Promise"))(function(c){b("Bootloader").loadModules(["MessengerThreadSearchActions","MessengerTabsThreadSearchStore"],function(b,d){a._store=d.get(),a._actions=b,c({store:d,actions:b})},"MessengerTabsThreadSearchLoader")}));return this._promise}};e.exports=a}),null);
__d("AutoFocusableLink.react",["Link.react","ReactDOM"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.componentDidMount=function(){this.props.autoFocus&&b("ReactDOM").findDOMNode(this).focus()};return c}(b("Link.react"));e.exports=a}),null);
__d("CustomColorHighlighting.react",["cssVar","csx","cx","React","UserAgent","guid","joinClasses"],(function(a,b,c,d,e,f,g,h,i){"use strict";__p&&__p();a=b("React").PropTypes;c="._fy2";d="._43by";f="._mh6";g=b("UserAgent").isEngine("Gecko")?"._mh6 *::-moz-selection":"._mh6 ::selection";h=b("UserAgent").isEngine("Gecko")?"._43by *::-moz-selection":"._43by ::selection";var j=c+c,k=d+d,l=f+g,m=f+f,n=d+h,o="rgba(255, 255, 255, 0.3)";i=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c){c=a.call(this,c)||this;c.state={id:"cch_"+b("guid")()};return c}var d=c.prototype;d.UNSAFE_componentWillMount=function(){this.$1()};d.componentWillUnmount=function(){this.$2(),this.state.styleTag&&document.head.removeChild(this.state.styleTag)};d.UNSAFE_componentWillReceiveProps=function(a){this.props.customColor&&!a.customColor?this.$2():a.customColor!==this.props.customColor&&this.$3(a.customColor)};d.render=function(){return b("React").jsx("span",{className:b("joinClasses")("_mh6",this.props.className),id:this.state.id,children:this.props.children})};d.$1=function(){var a=this,b=document.createElement("style");b.appendChild(document.createTextNode(""));document.head.appendChild(b);this.setState({styleSheet:b.sheet,styleTag:b},function(){return a.$3(a.props.customColor)})};d.$4=function(a,b,c){try{a.insertRule?a.insertRule(b+"{"+c+"}",0):a.addRule&&a.addRule(b,c,0)}catch(a){}};d.$5=function(a){"removeRule"in a?a.removeRule(0):"deleteRule"in a&&a.deleteRule(0)};d.$2=function(){if(this.state.styleSheet){if(this.state.styleSheet.rules)while(this.state.styleSheet.rules.length)this.$5(this.state.styleSheet);if(this.state.styleSheet.cssRules)while(this.state.styleSheet.cssRules.length)this.$5(this.state.styleSheet)}};d.$6=function(a){a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);var b=parseInt(a[1],16),c=parseInt(a[2],16);a=parseInt(a[3],16);return"rgba("+b+","+c+","+a+",0.2)"};d.$3=function(a){__p&&__p();this.$2();a=a||this.props.customColor;if(a){var b=this.$6(a);b="background: "+b;this.$4(this.state.styleSheet,"#"+this.state.id+l,b);this.$4(this.state.styleSheet,"#"+this.state.id+" "+j,"color: "+a);this.$4(this.state.styleSheet,"#"+this.state.id+" "+k,"background-color: "+a);this.$4(this.state.styleSheet,"#"+this.state.id+m+" "+n,"background-color: "+o)}};return c}(b("React").PureComponent);i.propTypes={className:a.string,customColor:a.string};e.exports=i}),null);
__d("EmojiOnlyMessage.react",["cx","EmojiImageURL","EmojiLikeConstants","FBEmojiResource","FBEmojiUtils","Image.react","MessengerHotlikeEmoji.bs","React"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();a=b("React").PropTypes;c=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){var a="_1ift _1ifu",c=0,d=this.props.contents.map(function(d){c++;var e=d.emojiKey;if(e){e=b("MessengerHotlikeEmoji.bs").isMessengerHotlike(e)?b("EmojiImageURL").getMessengerURL(e,b("EmojiLikeConstants").sizeMap.dp32):new(b("FBEmojiResource"))(b("FBEmojiUtils").resolveAliasFromKey(e)||e).getImageURL(b("EmojiLikeConstants").sizeMap.dp32);return b("React").jsx(b("Image.react"),{alt:d.text,className:a,src:e},c)}else return b("React").jsx("span",{children:d.text},c)});return b("React").jsx("div",{tabIndex:"0",children:d})};return c}(b("React").Component);c.propTypes={contents:a.arrayOf(a.shape({emojiKey:a.string,text:a.string.isRequired})).isRequired};e.exports=c}),null);
__d("HotLikeSound",["MercurySoundsConfig","SoundPlayer","StickerConstants"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=[(a=b("MercurySoundsConfig")).hot_like_grow_mp3_url,a.hot_like_grow_ogg_url],h=[a.hot_like_pop_mp3_url,a.hot_like_pop_ogg_url],i=[a.hot_like_outgoing_small_mp3_url,a.hot_like_outgoing_small_ogg_url],j=[a.hot_like_outgoing_medium_mp3_url,a.hot_like_outgoing_medium_ogg_url],k=[a.hot_like_outgoing_large_mp3_url,a.hot_like_outgoing_large_ogg_url],l=function(){return!1};c={setCheckSoundEnabledFunc:function(a){l=a},start:function(){this._play(g)},stop:function(){b("SoundPlayer").stop(g)},pop:function(){this.stop(),this._play(h)},snap:function(a){this.stop(),a===b("StickerConstants").HOT_LIKE_SMALL_STICKER_ID&&this._play(i),a===b("StickerConstants").HOT_LIKE_MEDIUM_STICKER_ID&&this._play(j),a===b("StickerConstants").HOT_LIKE_LARGE_STICKER_ID&&this._play(k)},_play:function(a){l()&&b("SoundPlayer").play(a)}};e.exports=c}),null);
__d("MessageReplyPermissions",["MercuryAttachmentLayoutTypeHelper","MercuryConfig","MessagingTag","MessengerBotMenuDataFetcher","MNCommercePageSetting","RepliedToMessageStatusForGraphQL","emptyFunction","getPageIDFromThreadID","isMessengerMessageRemoved"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={canReplyToMessage:function(a){var c=b("getPageIDFromThreadID")(a.thread_id);if(c!=null){c=b("MessengerBotMenuDataFetcher").getHasPageSetting(c,b("emptyFunction"),b("emptyFunction"),b("MNCommercePageSetting").COMPOSER_INPUT_DISABLED);if(c)return!1}if(a.folder===b("MessagingTag").PENDING||a.folder===b("MessagingTag").OTHER)return!1;return b("isMessengerMessageRemoved")(a)?!1:this.isRepliableMessage(a)||this._canRenderM3RedesignReply(a)},bubbleContainsRepliedToMessage:function(a,b){return!b&&this._canRenderM3RedesignReply(a)},isRepliableMessage:function(a){__p&&__p();var c,d=a.log_message_type==="log:video-call"||a.log_message_type==="log:phone-call";if(d)return!1;d=a.attachments&&a.attachments.length>0?a.attachments[0]:null;if(b("MercuryAttachmentLayoutTypeHelper").isAdminType(d))return!1;if(d!==null&&((c=d.share)==null?void 0:c.style_list[0])==="rtc_call_log")return!1;c=d==null?void 0:d.attach_type;return!!a.body||c==="photo"||c==="video"||c==="sticker"||c==="third_party_sticker"||c==="animated_image"||a.attachments&&a.attachments.length>=1},_canRenderM3RedesignReply:function(a){if(!b("MercuryConfig").SM3BD)return!1;if(a.status!==b("RepliedToMessageStatusForGraphQL").VALID)return!0;a=a.message;var c=a.attachments&&a.attachments.length===1&&a.attachments[0].attach_type;return!!a.body||b("MercuryConfig").RTPE&&c==="photo"||b("MercuryConfig").RTVE&&c==="video"||b("MercuryConfig").RTSE&&(c==="sticker"||c==="third_party_sticker")||b("MercuryConfig").RTGE&&c==="animated_image"||b("MercuryConfig").RTOAE&&a.attachments&&a.attachments.length>=1}};e.exports=a}),null);
__d("MessageThreadAssociatedObjectUtils",[],(function(a,b,c,d,e,f){"use strict";a={shouldRender:function(a){return a&&a.room_type==="GROUP"&&!a.is_workplace_community},isLinkedToGroupChat:function(a){return a&&a.room_type==="GROUP"&&!a.is_workplace_community}};e.exports=a}),null);
__d("MessengerMentionSource",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({REPLY:"reply",ATSIGN:"@",TYPEAHEAD:"typeahead"});e.exports=a}),null);
__d("MessengerSupportedEmojiUtils",["cx","EmojiImageURL","EmojiLikeConstants","EmojiRenderer","EmoticonEmojiList","FBEmojiAliases","FBEmojiResource","Image.react","MessengerEmojiTransitionMapping.bs","MessengerHotlikeEmoji.bs","MessengerSupportedEmoji","React","SupportedEmoji3","SupportedFacebookEmoji","Utf16","joinClasses"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=/_fe0f/g,i=new RegExp("(\r\n|[ \r\n]|\\s)");a={getSupportedEmojiKey:function(a){__p&&__p();if(!a)return null;var c=null,d=this.parse(a);if(d.length===1&&d[0].length===a.length){a=d[0].emoji.map(function(a){return b("Utf16").decode(a)});c=a.map(function(a){return a.toString(16)}).join("_").replace(h,"")}if(c){d=b("FBEmojiAliases")[c];d&&(c=d.replace(h,""))}return this.isSupportedEmojiKey(c)?c:null},isSupportedEmoji:function(a){return!!this.getSupportedEmojiKey(a)},isSupportedEmojiKey:function(a){if(!a)return!1;if(!b("MessengerHotlikeEmoji.bs").isMessengerHotlike(a)){var c=function(a){var c=b("FBEmojiAliases")[a];return c?c.replace(h,""):a}(a);return!!b("SupportedFacebookEmoji")[c]||!!b("SupportedEmoji3")[c]}return!!b("MessengerSupportedEmoji").emoji[a]},isMessengerSupportedEmojiKey:function(a){return!!(a&&b("MessengerSupportedEmoji").emoji[a])},getSupportedEmojiCodesArray:function(a){__p&&__p();if(!a)return null;var c=this.parse(a);if(c.length===1&&c[0].length===a.length){a=c[0].emoji.map(function(a){return b("Utf16").decode(a)});c=a.map(function(a){return a.toString(16)}).join("_").replace(h,"");if(this.isSupportedEmojiKey(c))return a}return null},getEmojiKeyFromCodes:function(a){a=a.map(function(a){return a.toString(16)}).join("_").replace(h,"");var c=b("FBEmojiAliases")[a];return c?c.replace(h,""):a},getClassSizeMap:function(){var a,c=b("EmojiLikeConstants").size;return a={},a[c.XSMALL]="_2560",a[c.SMALL]="_1ifu",a[c.MEDIUM]="_19_r",a[c.LARGE]="_19_s",a},getEmojiMatchObj:function(a){a=this.parse(a,1);if(a.length!==1)return null;var c=a[0].emoji,d=a[0].emoji.map(function(a){return b("Utf16").decode(a)});b("MessengerEmojiTransitionMapping.bs").hasGender(d)&&!b("MessengerEmojiTransitionMapping.bs").getGender(d)&&(d=b("MessengerEmojiTransitionMapping.bs").makeFemale(d));d=d.map(function(a){return a.toString(16)}).join("_").replace(h,"");return{emoji_key:d,emoji_str:c.join(""),is_supported:this.isSupportedEmojiKey(d),offset:a[0].offset,length:a[0].length}},getNewEmojiData:function(a,c){__p&&__p();if(!a)return null;a=this.getSupportedEmojiKey(a);if(!a)return null;var d=this.getClassSizeMap();c=this.transferSize(c);b("EmojiLikeConstants").sizeMap[c]||(c=b("EmojiLikeConstants").size.XSMALL);d=b("joinClasses")(d[c],"_1ift");c=b("EmojiLikeConstants").sizeMap[c];c=b("MessengerHotlikeEmoji.bs").isMessengerHotlike(a)?b("EmojiImageURL").getMessengerURL(a,c):new(b("FBEmojiResource"))(a).getImageURL(c);return c==null?null:{emoji:b("React").jsx(b("Image.react"),{className:d,src:c}),emoji_key:a,url:c}},getHotLikeEmojiDataTransition:function(a,c){__p&&__p();if(!a)return null;a=this.getSupportedEmojiKey(a,!0);if(!a)return null;var d=this.getClassSizeMap();c=this.transferSize(c);var e=c===b("EmojiLikeConstants").size.MEDIUM?b("EmojiLikeConstants").size.LARGE:c;b("EmojiLikeConstants").sizeMap[c]||(c=b("EmojiLikeConstants").size.XSMALL);d=b("joinClasses")(d[c],"_1ift");c=b("EmojiLikeConstants").sizeMap[e];e=b("MessengerHotlikeEmoji.bs").isMessengerHotlike(a)?b("EmojiImageURL").getMessengerURL(a,c):new(b("FBEmojiResource"))(a).getImageURL(c);return e==null?null:{emoji:b("React").jsx(b("Image.react"),{className:d,src:e}),emoji_key:a,url:e}},getHotLikeEmojiData:function(a,c){__p&&__p();if(!a)return null;a=this.getSupportedEmojiKey(a);if(!a)return null;var d=this.getClassSizeMap();c=this.transferSize(c);var e=c===b("EmojiLikeConstants").size.MEDIUM?b("EmojiLikeConstants").size.LARGE:c;b("EmojiLikeConstants").sizeMap[c]||(c=b("EmojiLikeConstants").size.XSMALL);d=b("joinClasses")(d[c],"_1ift");c=b("EmojiLikeConstants").sizeMap[e];e=b("MessengerHotlikeEmoji.bs").isMessengerHotlike(a)?b("EmojiImageURL").getMessengerURL(a,c):new(b("FBEmojiResource"))(a).getImageURL(c);return e==null?null:{emoji:b("React").jsx(b("Image.react"),{className:d,src:e}),emoji_key:a,url:e}},getEmojiOnlyContents:function(a){__p&&__p();a=a||"";var c=[],d=function(a){var b=i.exec(a),d="";while(b&&b.length&&b.index===0)d+=b[0],a=a.replace(i,""),b=i.exec(a);d.length>0&&c.push({text:d});return a};while(!0){a=d(a);var e=b("EmoticonEmojiList").noncapturingRegexp.exec(a);if(e&&e.index===0){var f=b("EmoticonEmojiList").names[e[1]];f=b("EmoticonEmojiList").emote2emojis[f];c.push({emojiKey:f,text:e[1]});a=a.replace(e[1],"")}else break}while(a.length>0&&a.trim().length>0){a=d(a);f=this.getEmojiMatchObj(a);if(f&&f.is_supported)c.push({emojiKey:f.emoji_key,text:f.emoji_str}),a=a.replace(f.emoji_str,"");else return null}return c},getUrl:function(a,c){a=a.replace(h,"");c=this.transferSize(c);if(!b("MessengerHotlikeEmoji.bs").isMessengerHotlike(a)){var d=b("FBEmojiAliases")[a];d&&(a=d.replace(h,""));return!this.isSupportedEmojiKey(a)?null:new(b("FBEmojiResource"))(a).getImageURL(b("EmojiLikeConstants").sizeMap[c])}return!b("MessengerSupportedEmoji").emoji[a]?null:b("EmojiImageURL").getMessengerURL(a,b("EmojiLikeConstants").sizeMap[c])},containsEmoji:function(a){return this.parse(a,1).length===1},parse:function(a,c){return b("EmojiRenderer").parse(a,c)},transferSize:function(a){return b("EmojiLikeConstants").sizeMapTransfer[a]||a}};e.exports=a}),null);